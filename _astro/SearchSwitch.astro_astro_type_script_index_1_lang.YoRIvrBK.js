import{t as g}from"./misc.De53EN5u.js";class b extends HTMLElement{#e=null;#b=null;#l=null;#m=null;#i=null;#p=null;#o=null;#c=null;#t=null;#v=this.dataset.filter==="true";#s=[];#h=0;#r=0;#a=[];#u=0;#L=this.dataset.maxItems?parseInt(this.dataset.maxItems||"10",10):void 0;#d=!1;#n=this.dataset.batchSize?parseInt(this.dataset.batchSize||"5",10):void 0;connectedCallback(){this.#e=this.querySelector("#search-input"),this.#b=this.querySelector("#search-label"),this.#l=this.querySelector("#search-results"),this.#m=this.querySelector("#search-feedback"),this.#i=this.querySelector("#search-content"),this.#P(),this.#_(),this.#e?.addEventListener("input",this.#y),this.#i?.addEventListener("click",this.#k),this.#i?.addEventListener("pointerover",this.#C),this.addEventListener("keydown",this.#x)}disconnectedCallback(){if(this.#e?.removeEventListener("input",this.#y),this.#i?.removeEventListener("click",this.#k),this.#i?.removeEventListener("pointerover",this.#C),this.removeEventListener("keydown",this.#x),this.#v)for(const t of this.#s)t.replaceWith(t.cloneNode(!0));this.#n&&(this.#o?.removeEventListener("click",this.#g),this.#c?.removeEventListener("click",this.#g)),this.#r++}#P=()=>{if(!this.#v){this.#w();return}const t=localStorage.getItem("search-tab");this.#h=t?parseInt(t,10):0,this.#s=Array.from(this.querySelectorAll('[role="tab"]'));for(let e=0;e<this.#s.length;e++){const i=e===this.#h;this.#s[e].setAttribute("aria-selected",i.toString()),i&&this.#w(this.#s[e].dataset.type||""),this.#s[e].addEventListener("click",()=>this.#D(e))}};#_=()=>{this.#n&&(this.#p=this.querySelector("#search-pagination"),this.#o=this.querySelector('[data-action="more"]'),this.#c=this.querySelector('[data-action="all"]'),this.#o?.addEventListener("click",this.#g),this.#c?.addEventListener("click",this.#g))};#y=async t=>{if(!this.#i)return;const e=t.target.value.trim();{const i=++this.#r;if(this.#I(),e.length===0)return;try{const r={};if(this.#v&&this.#s[this.#h]){const a=this.#s[this.#h].dataset.type;a&&(r.filters={collection:a})}this.#q(i);const n=await pagefind.debouncedSearch(e,r,300);if(n===null||i!==this.#r)return;if(n.results.length===0){this.#W(i);return}this.#a=n.results,this.#S({requestId:i})}catch{this.#A(i)}}};#k=t=>{this.#M(t)&&(window.matchMedia("(prefers-reduced-motion)").matches||this.classList.remove("fade-in"),this.classList.add("hidden"),g("backdrop",!1,"hidden"))};#C=t=>{const e=this.#M(t);e&&this.#T(e)};#x=t=>{if(!this.#t||document.activeElement!==this.#e)return;const e=t.key;if(e!=="ArrowDown"&&e!=="ArrowUp"&&e!=="Enter")return;if(t.preventDefault(),e==="Enter"){this.#t.click();return}let i=e==="ArrowDown"?this.#H(this.#t):this.#$(this.#t);i||(i=e==="ArrowDown"?this.#i?.querySelector("a")??null:this.#i?.querySelector("a:last-child")??null),i&&(this.#T(i),i.scrollIntoView({behavior:"smooth",block:"center"}))};#w=t=>{let e="Search";t&&(e=`Search ${t.charAt(0).toUpperCase()+t.slice(1)}`.trim()),this.#e&&(this.#e.placeholder=e),this.#b&&(this.#b.textContent=e)};#D=async t=>{if(t===this.#h)return;this.#s[this.#h]?.setAttribute("aria-selected","false"),this.#s[t]?.setAttribute("aria-selected","true"),this.#h=t,localStorage.setItem("search-tab",t.toString());const e=this.#s[t]?.dataset.type||"";this.#w(e),this.#e?.value&&(this.#I(),await this.#y({target:this.#e}),this.#e?.focus())};#g=async t=>{const e=t.currentTarget;if(!e||this.#d)return;const i=this.#r,r=e.dataset.action;r==="more"?(await this.#S({requestId:i,next:!0,all:!1}),this.#e?.focus()):r==="all"&&(await this.#S({requestId:i,next:!0,all:!0}),this.#e?.focus())};#S=async({requestId:t,next:e=!1,all:i=!1})=>{if(this.#i&&t===this.#r&&!(this.#n&&this.#d))try{const r=this.#u,n=!this.#n||i?this.#a.length:Math.min(r+this.#n,this.#a.length);e&&this.#q(t,!0);const a=this.#a.slice(r,n),d=await Promise.allSettled(a.map(s=>s.data()));if(t!==this.#r)return;const u=d.filter(s=>s.status==="fulfilled");if(u.length===0){this.#A(t);return}const l=document.createDocumentFragment();for(let s=0;s<u.length;s++){if(t!==this.#r)return;const m=u[s].value,f=document.createElement("div");f.className="search-result-h1",f.textContent=m.meta?.title??"",l.appendChild(f);let o=m.sub_results;this.#L&&(o=this.#N(o,this.#L));for(let c=0;c<o.length;c++){const h=document.createElement("a");h.href=o[c].url,h.className="search-result-item",h.setAttribute("role","option"),h.setAttribute("tabindex","-1"),s===0&&c===0?(h.setAttribute("aria-selected","true"),this.#t&&this.#t.setAttribute("aria-selected","false"),this.#t=h):h.setAttribute("aria-selected","false"),h.innerHTML=`
              <div class="search-result-title">${o[c].title}</div>
              <div class="search-result-excerpt">${o[c].excerpt}</div>`,l.appendChild(h)}}if(t!==this.#r)return;if(this.#f(""),this.#i.appendChild(l),this.#t?.scrollIntoView({behavior:"smooth",block:"center"}),this.#n){this.#u=n;const s=this.#u<this.#a.length;this.#E(s)}}catch{this.#A(t)}finally{this.#l?.removeAttribute("aria-busy"),this.#n&&(this.#d=!1)}};#N=(t,e)=>t.toSorted((i,r)=>{const n=i.weighted_locations.length,a=r.weighted_locations.length;if(n!==a)return a-n;const d=i.weighted_locations.reduce((l,s)=>l+s.weight,0)/(n||1);return r.weighted_locations.reduce((l,s)=>l+s.weight,0)/(a||1)-d}).slice(0,e);#I=()=>{this.#i?.replaceChildren(),this.#f(""),this.#e?.setAttribute("aria-expanded","false"),this.#l?.removeAttribute("aria-busy"),this.#a=[],this.#u=0,this.#t=null,this.#n&&(this.#d=!1,this.#E(!1))};#f=t=>{this.#m&&(t&&(this.#m.textContent=t),this.#m.classList.toggle("hidden",!t))};#q=(t,e=!1)=>{t===this.#r&&(e&&(this.#E(!1),this.#d=!0),this.#f("Loading..."),this.#l?.setAttribute("aria-busy","true"),e||this.#e?.setAttribute("aria-expanded","true"))};#A=t=>{t===this.#r&&(this.#f("Oops! Something went wrong. Try again."),this.#l?.removeAttribute("aria-busy"))};#W=t=>{t===this.#r&&(this.#f("No results found."),this.#l?.removeAttribute("aria-busy"))};#E=t=>{if(!this.#p||!this.#n)return;const e=this.#a.length,i=Math.min(this.#n,e-this.#u);this.#o&&(this.#o.querySelector("span").textContent=`More +${i}`),this.#c&&(this.#c.querySelector("span").textContent=`All ${e}`),this.#p.style.display=t?"flex":"none"};#M=t=>t.target instanceof HTMLElement&&t.target.closest("a");#T=t=>{!this.#t||this.#t===t||(this.#t.setAttribute("aria-selected","false"),this.#t=t,this.#t.setAttribute("aria-selected","true"))};#R=t=>t instanceof HTMLAnchorElement;#H=t=>{let e=t.nextElementSibling;for(;e;){if(this.#R(e))return e;e=e.nextElementSibling}return null};#$=t=>{let e=t.previousElementSibling;for(;e;){if(this.#R(e))return e;e=e.previousElementSibling}return null}}customElements.get("search-panel")||customElements.define("search-panel",b);
